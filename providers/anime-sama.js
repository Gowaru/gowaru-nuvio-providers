/**
 * anime-sama - Built from src/anime-sama/
 * Generated: 2026-02-25T16:19:27.948Z
 */
var B=Object.create;var D=Object.defineProperty,J=Object.defineProperties,K=Object.getOwnPropertyDescriptor,G=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertyNames,j=Object.getOwnPropertySymbols,Q=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var W=(t,e,s)=>e in t?D(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,l=(t,e)=>{for(var s in e||(e={}))F.call(e,s)&&W(t,s,e[s]);if(j)for(var s of j(e))X.call(e,s)&&W(t,s,e[s]);return t},m=(t,e)=>J(t,G(e));var Y=(t,e,s,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of O(e))!F.call(t,a)&&a!==s&&D(t,a,{get:()=>e[a],enumerable:!(r=K(e,a))||r.enumerable});return t};var Z=(t,e,s)=>(s=t!=null?B(Q(t)):{},Y(e||!t||!t.__esModule?D(s,"default",{value:t,enumerable:!0}):s,t));var h=(t,e,s)=>new Promise((r,a)=>{var n=o=>{try{i(s.next(o))}catch(c){a(c)}},u=o=>{try{i(s.throw(o))}catch(c){a(c)}},i=o=>o.done?r(o.value):Promise.resolve(o.value).then(n,u);i((s=s.apply(t,e)).next())});var ee={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0","Sec-Ch-Ua":'"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1"};function S(s){return h(this,arguments,function*(t,e={}){console.log(`[Anime-Sama] Fetching: ${t}`);let r=yield fetch(t,l({headers:l(l({},ee),e.headers)},e));if(!r.ok)throw new Error(`HTTP error ${r.status} for ${t}`);return yield r.text()})}var q=Z(require("cheerio"));var I={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"};function p(s){return h(this,arguments,function*(t,e={}){try{let r=yield fetch(t,m(l({},e),{headers:l(l({},I),e.headers),redirect:"follow"}));if(!r.ok)return null;let a=yield r.text(),n={};r.headers&&r.headers.forEach((i,o)=>{n[o.toLowerCase()]=i});let u=a.match(/window\.location\.(?:replace|href)\s*\(['"]([^'"]+)['"]\)/i);if(u){let i=u[1];i.startsWith("/")&&(i=t.match(/https?:\/\/[^\/]+/)[0]+i);let o=n["set-cookie"]||"",c=yield fetch(i,m(l({},e),{headers:l(m(l({},I),{Referer:t,Cookie:o}),e.headers)}));if(c.ok){let g=yield c.text(),d={};return c.headers&&c.headers.forEach((y,x)=>d[x.toLowerCase()]=y),{text:()=>Promise.resolve(g),ok:!0,url:c.url,headers:l(l({},n),d)}}}return{text:()=>Promise.resolve(a),ok:!0,url:r.url,headers:n}}catch(r){return null}})}function f(t){if(!t)return"";let e=t["set-cookie"];return e?Array.isArray(e)?e.map(s=>s.split(";")[0]).join("; "):e.split(";")[0]:""}function L(t){try{if(!t.includes("p,a,c,k,e,d"))return t;let e=t.match(/}\s*\((.*)\)\s*$/);if(!e)return t;let s=e[1].match(/(".+"|\d+)/g);if(s.length<4)return t;let[r,a,n,u]=[s[0].replace(/^"|"$/g,""),parseInt(s[1]),parseInt(s[2]),s[3].replace(/^"|"$/g,"").split("|")],i=c=>(c<a?"":i(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36)),o={};for(;n--;)o[i(n)]=u[n]||i(n);return r.replace(/\b\w+\b/g,c=>o[c]||c)}catch(e){return t}}function te(s){return h(this,arguments,function*(t,e={}){try{let r=yield fetch(t,{method:"GET",headers:m(l({},e),{Range:"bytes=0-1"})});if(r.status===200||r.status===206){let a=r.headers.get("content-type")||"";return a.includes("video")||a.includes("mpegurl")||a.includes("application/octet-stream")}return!1}catch(r){return!1}})}function se(t){return h(this,null,function*(){try{let e=yield p(t,{headers:{Referer:"https://video.sibnet.ru/"}});if(!e)return{url:t};let s=yield e.text(),r=f(e.headers),a=s.match(/src\s*:\s*["']([^"']+\.mp4)["']/)||s.match(/"url"\s*:\s*"([^"]+\.mp4)"/)||s.match(/video_url\s*:\s*'([^']+)'/);if(a){let n=a[1];return n.startsWith("//")?n="https:"+n:n.startsWith("/")&&(n="https://video.sibnet.ru"+n),{url:n,headers:{Cookie:r}}}}catch(e){}return{url:t}})}function re(t){return h(this,null,function*(){try{let e=yield p(t,{headers:{Referer:"https://vidmoly.to/"}});if(!e)return{url:t};let s=yield e.text(),r=f(e.headers);s.includes("eval(function(p,a,c,k,e,d)")&&(s=L(s));let a=s.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/)||s.match(/sources\s*:\s*\[\s*\{\s*file\s*:\s*["']([^"']+)["']/)||s.match(/["']?file["']?\s*:\s*["']([^"']+)["']/);if(a)return{url:a[1],headers:{Cookie:r}}}catch(e){}return{url:t}})}function ae(t){return h(this,null,function*(){try{let e=yield p(t,{headers:{Referer:"https://uqload.com/"}});if(!e)return{url:t};let s=yield e.text(),r=f(e.headers),a=s.match(/sources\s*:\s*\[["']([^"']+\.(?:mp4|m3u8))["']\]/)||s.match(/src\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/)||s.match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/)||s.match(/vurl\s*=\s*["']([^"']+)["']/);if(a)return{url:a[1],headers:{Cookie:r}}}catch(e){}return{url:t}})}function N(t){return h(this,null,function*(){try{let e=yield p(t);if(!e)return{url:t};let s=yield e.text(),r=f(e.headers),a=s.match(/window\.location\.href\s*=\s*['"]([^'"]+)['"]/);if(a)return N(a[1]);let n=s.match(/'hls'\s*:\s*'([^']+)'/)||s.match(/"hls"\s*:\s*"([^"]+)"/)||s.match(/file\s*:\s*['"]([^'"]+\.m3u8[^'"]*)['"]/);if(n){let i=n[1];if(i.includes("base64"))try{let o=i.split(",")[1]||i;i=atob(o)}catch(o){}return{url:i,headers:{Cookie:r}}}let u=s.match(/https?:\/\/[^"']+\.m3u8[^"']*/);if(u)return{url:u[0],headers:{Cookie:r}}}catch(e){}return{url:t}})}function ne(t){return h(this,null,function*(){try{let e=yield p(t);if(!e)return{url:t};let s=yield e.text(),r=f(e.headers),a=s.match(/document\.getElementById\(['"]robotlink['"]\)\.innerHTML\s*=\s*['"]([^'"]+)['"]\s*\+\s*(?:['"]([^'"]+)['"]|['"]([^'"]+)['"]\.substring\(\d+\))/);if(a){let i=a[1],o=a[2]||"";if(a[3]){let c=s.match(/substring\((\d+)\)/),g=c?parseInt(c[1]):0;o=a[3].substring(g)}return{url:"https:"+i+o,headers:{Cookie:r}}}let n=s.match(/id=['"]robotlink['"]>([^<]+)/);if(n)return{url:"https:"+n[1],headers:{Cookie:r}};let u=s.match(/get_video\?id=[^&'"]+/);if(u)return{url:"https://streamtape.com/"+u[0],headers:{Cookie:r}}}catch(e){}return{url:t}})}function oe(t){return h(this,null,function*(){try{let e=t.match(/https?:\/\/([^\/]+)/);if(!e)return{url:t};let s=e[1],r=yield p(t);if(!r)return{url:t};let a=yield r.text(),n=f(r.headers);a.includes("eval(function(p,a,c,k,e,d)")&&(a=L(a));let u=a.match(/\$\.get\(['"]\/pass_md5\/([^'"]+)['"]/);if(u){let i=u[1],o=`https://${s}/pass_md5/${i}`,c=yield fetch(o,{headers:{Referer:t,Cookie:n}});if(c.ok){let g=yield c.text(),d=f({"set-cookie":c.headers.get("set-cookie")}),y=[n,d].filter(Boolean).join("; ");return{url:g+"z762vpz?token="+i+"&expiry="+Date.now(),headers:{Cookie:y}}}}}catch(e){}return{url:t}})}function ie(t){return h(this,null,function*(){try{let e=yield p(t);if(!e)return{url:t};let s=yield e.text(),r=f(e.headers),a=s.match(/source\s*src=['"]([^'"]+\.mp4)['"]/)||s.match(/content=['"]([^'"]+\.mp4)['"]/)||s.match(/video_url\s*:\s*['"]([^'"]+)['"]/);if(a)return{url:a[1],headers:{Cookie:r}}}catch(e){}return{url:t}})}function ce(t){return h(this,null,function*(){try{let e=yield p(t);if(!e)return{url:t};let s=yield e.text(),r=f(e.headers),a=s.match(/vurl=["']([^"']+)["']/)||s.match(/file\s*:\s*["']([^"']+)["']/)||s.match(/["']?url["']?\s*:\s*["']([^"']+)["']/);if(a){let n=a[1];return n.startsWith("//")&&(n="https:"+n),{url:n,headers:{Cookie:r}}}}catch(e){}return{url:t}})}function le(t){return h(this,null,function*(){try{let e=yield p(t);if(!e)return{url:t};let s=yield e.text(),r=f(e.headers),a=s.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*["']([^"']+)["']/)||s.match(/file\s*:\s*["']([^"']+\.mp4[^"']*)["']/);if(a)return{url:a[1],headers:{Cookie:r}}}catch(e){}return{url:t}})}function M(t){return h(this,null,function*(){let e=t.url,s=e.toLowerCase();if(s.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/))return m(l({},t),{isDirect:!0});try{let r={url:e,headers:l({},t.headers)};if(s.includes("sibnet.ru"))r=yield se(e),r.headers=m(l({},r.headers),{Referer:"https://video.sibnet.ru/"});else if(s.includes("vidmoly."))r=yield re(e),r.headers=m(l({},r.headers),{Referer:"https://vidmoly.to/"});else if(s.includes("uqload.")||s.includes("oneupload."))r=yield ae(e),r.headers=m(l({},r.headers),{Referer:"https://uqload.com/"});else if(s.includes("voe."))r=yield N(e);else if(s.includes("streamtape.com")||s.includes("stape"))r=yield ne(e);else if(s.includes("dood")||s.includes("ds2play"))r=yield oe(e);else if(s.includes("sendvid.com"))r=yield ie(e);else if(s.includes("myvi.")||s.includes("mytv"))r=yield ce(e);else if(s.includes("moonplayer")||s.includes("moon."))r=yield le(e);else{let a=yield p(e);if(a){let n=yield a.text(),u=f(a.headers),i=n.match(/https?:\/\/[^"']+\.m3u8[^"']*/)||n.match(/https?:\/\/[^"']+\.mp4[^"']*/);i&&(r={url:i[0],headers:{Cookie:u}})}}if(r.url!==e&&r.url.startsWith("http"))return console.log("[Resolver] Successfully resolved: "+e.substring(0,30)+"..."),(yield te(r.url,l(l({},t.headers),r.headers)))?m(l({},t),{url:r.url,isDirect:!0,headers:l(l({},t.headers),r.headers),originalUrl:e}):(console.log("[Resolver] Stream validation failed for: "+r.url.substring(0,30)),m(l({},t),{isDirect:!1,error:"Link expired or invalid"}))}catch(r){console.error("[Resolver] Failed for "+e+":",r.message)}return m(l({},t),{isDirect:!1})})}var ue="https://arm.haglund.dev/api/v2";var he="https://v3-cinemeta.strem.io";function H(s){return h(this,arguments,function*(t,e={}){try{let r=new AbortController,a=setTimeout(()=>r.abort(),8e3),n=yield fetch(t,m(l({},e),{signal:r.signal}));return clearTimeout(a),n}catch(r){return console.error(`[ArmSync] Fetch failed: ${t}`,r.message),null}})}function P(t,e){return h(this,null,function*(){if(!t)return null;let s=yield H(`${ue}/themoviedb?id=${t}`);if(s){let r=yield s.json(),a=Array.isArray(r)?r[0]:r;if(a&&a.imdb)return a.imdb}return null})}function _(t,e,s){return h(this,null,function*(){var i;if(!t||e===0)return null;let r=yield H(`${he}/meta/series/${t}.json`);if(!r)return null;let a=yield r.json();if(!((i=a==null?void 0:a.meta)!=null&&i.videos))return null;let u=a.meta.videos.filter(o=>o.season>0).sort((o,c)=>o.season-c.season||o.episode-c.episode).findIndex(o=>o.season==e&&o.episode==s);if(u!==-1){let o=u+1;return console.log(`[ArmSync] Resolved: S${e}E${s} -> Absolute ${o}`),o}return null})}var A="https://anime-sama.tv";function me(t,e){return h(this,null,function*(){try{let s=`https://www.themoviedb.org/${e==="movie"?"movie":"tv"}/${t}?language=en-US`,r=yield S(s),a=q.default.load(r),n=a('meta[property="og:title"]').attr("content")||a("h1").first().text()||a("h2").first().text();return n&&n.includes(" (")&&(n=n.split(" (")[0]),n&&n.includes(" - ")&&(n=n.split(" - ")[0]),n=n?n.trim():null,console.log(`[Anime-Sama] TMDB Title found: ${n}`),n}catch(s){return console.error(`[Anime-Sama] Failed to get title from TMDB: ${s.message}`),null}})}function de(t){return h(this,null,function*(){try{let e=`${A}/?s=${encodeURIComponent(t)}`,s=yield S(e),a=q.default.load(s)('a[href*="/catalogue/"]').first();if(a.length){let u=a.attr("href").match(/\/catalogue\/([^/]+)\/?/);if(u)return console.log(`[Anime-Sama] Search found slug: ${u[1]}`),u[1]}return null}catch(e){return console.error(`[Anime-Sama] Search Error: ${e.message}`),null}})}function fe(t){return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function z(t,e){return e.includes("sibnet")?"Sibnet":e.includes("sendvid")?"Sendvid":e.includes("mycloud")?"MyCloud":e.includes("vidmoly")?"Vidmoly":e.includes("vido")?"Vido":e.includes("voe")?"Voe":e.includes("stape")||e.includes("streamtape")?"Streamtape":e.includes("dood")||e.includes("ds2play")?"Doodstream":e.includes("uqload")||e.includes("oneupload")?"Uqload":`Player ${t.toUpperCase()}`}function V(t,e,s,r){return h(this,null,function*(){var c,g;let a=yield me(t,e);if(!a)return[];let n=r;try{let d=yield P(t,e);if(d){let y=yield _(d,s,r);y&&(console.log(`[Anime-Sama] ArmSync: Resolved S${s}E${r} -> Absolute Ep ${y}`),n=y)}}catch(d){console.warn(`[Anime-Sama] ArmSync resolution failed, falling back to episode ${r}`)}let u=fe(a),i=["vostfr","vf"],o=[];for(let d of i){let y=`${A}/catalogue/${u}/saison${s}/${d}/episodes.js`;try{let x=yield S(y),$=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),v;for(;(v=$.exec(x))!==null;){let R=v[1],b=((c=v[2].match(/'(.*?)'/g))==null?void 0:c.map(k=>k.slice(1,-1)))||[],w=b[r-1]||b[n-1];if(w&&w.startsWith("http")){let k=yield M({name:`Anime-Sama (${d.toUpperCase()})`,title:`${z(R,w)} - Ep ${r}`,url:w,quality:"HD",headers:{Referer:A}});o.push(k)}}}catch(x){if(console.warn(`[Anime-Sama] episodes.js not found or error for ${d}: ${x.message}`),d===i[0]&&o.length===0){let $=yield de(a);if($&&$!==u){for(let v of i){let R=`${A}/catalogue/${$}/saison${s}/${v}/episodes.js`;try{let E=yield S(R),b=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),w;for(;(w=b.exec(E))!==null;){let k=w[1],T=((g=w[2].match(/'(.*?)'/g))==null?void 0:g.map(U=>U.slice(1,-1)))||[],C=T[r-1]||T[n-1];if(C&&C.startsWith("http")){let U=yield M({name:`Anime-Sama (${v.toUpperCase()})`,title:`${z(k,C)} - Ep ${r}`,url:C,quality:"HD",headers:{Referer:A}});o.push(U)}}}catch(E){}}if(o.length>0)return o}}}}return o})}function pe(t,e,s,r){return h(this,null,function*(){try{return console.log(`[Anime-Sama] Request: ${e} ${t} S${s}E${r}`),yield V(t,e,s,r)}catch(a){return console.error(`[Anime-Sama] Error: ${a.message}`),[]}})}module.exports={getStreams:pe};
