/**
 * anime-sama - Built from src/anime-sama/
 * Generated: 2026-02-25T10:09:14.912Z
 */
var L=Object.create;var C=Object.defineProperty,H=Object.defineProperties,z=Object.getOwnPropertyDescriptor,j=Object.getOwnPropertyDescriptors,k=Object.getOwnPropertyNames,q=Object.getOwnPropertySymbols,J=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var F=(t,e,n)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,u=(t,e)=>{for(var n in e||(e={}))D.call(e,n)&&F(t,n,e[n]);if(q)for(var n of q(e))P.call(e,n)&&F(t,n,e[n]);return t},b=(t,e)=>H(t,j(e));var B=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of k(e))!D.call(t,s)&&s!==n&&C(t,s,{get:()=>e[s],enumerable:!(r=z(e,s))||r.enumerable});return t};var K=(t,e,n)=>(n=t!=null?L(J(t)):{},B(e||!t||!t.__esModule?C(n,"default",{value:t,enumerable:!0}):n,t));var a=(t,e,n)=>new Promise((r,s)=>{var o=i=>{try{c(n.next(i))}catch(h){s(h)}},l=i=>{try{c(n.throw(i))}catch(h){s(h)}},c=i=>i.done?r(i.value):Promise.resolve(i.value).then(o,l);c((n=n.apply(t,e)).next())});var V={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0","Sec-Ch-Ua":'"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1"};function w(n){return a(this,arguments,function*(t,e={}){console.log(`[Anime-Sama] Fetching: ${t}`);let r=yield fetch(t,u({headers:u(u({},V),e.headers)},e));if(!r.ok)throw new Error(`HTTP error ${r.status} for ${t}`);return yield r.text()})}var T=K(require("cheerio"));var G={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"*/*"};function p(n){return a(this,arguments,function*(t,e={}){try{let r=new AbortController,s=setTimeout(()=>r.abort(),1e4),o=yield fetch(t,b(u({},e),{headers:u(u({},G),e.headers),signal:r.signal}));return clearTimeout(s),o}catch(r){return console.error(`[Resolver] Fetch failed for ${t}: ${r.message}`),null}})}function O(t){return a(this,null,function*(){let e=yield p(t,{headers:{Referer:"https://video.sibnet.ru/"}});if(!e)return t;let r=(yield e.text()).match(/"url"\s*:\s*"([^"]+\.mp4)"/);if(r){let s=r[1];return s.startsWith("/")&&(s=`https://video.sibnet.ru${s}`),s}return t})}function I(t){return a(this,null,function*(){let e=yield p(t);if(!e)return t;let r=(yield e.text()).match(/file\s*:\s*"([^"]+)"/);return r?r[1]:t})}function _(t){return a(this,null,function*(){let e=yield p(t);if(!e)return t;let r=(yield e.text()).match(/sources\s*:\s*\["([^"]+)"\]/);return r?r[1]:t})}function Q(t){return a(this,null,function*(){let e=yield p(t);if(!e)return t;let n=yield e.text(),r=n.match(/'hls'\s*:\s*'([^']+)'/)||n.match(/"hls"\s*:\s*"([^"]+)"/);return r?r[1]:t})}function X(t){return a(this,null,function*(){let e=yield p(t);if(!e)return t;let r=(yield e.text()).match(/source\s+src="([^"]+\.mp4)"/i);return r?r[1]:t})}function Y(t){return a(this,null,function*(){let e=yield p(t.replace("/e/","/d/"));if(!e)return t;let r=(yield e.text()).match(/window\.open\('([^']+)'\)/);return r?r[1]:t})}function R(t){return a(this,null,function*(){let e=t.url,n=e.toLowerCase();try{let r=e;if(n.includes("sibnet.ru")?r=yield O(e):n.includes("vidmoly.")?r=yield I(e):n.includes("uqload.")?r=yield _(e):n.includes("voe.sx")||n.includes("christopheruntilpoint")?r=yield Q(e):n.includes("sendvid.com")?r=yield X(e):(n.includes("dood")||n.includes("ds2play")||n.includes("viddood"))&&(r=yield Y(e)),r!==e)return console.log(`[Resolver] Success: ${e.substring(0,30)}... -> ${r.substring(0,30)}...`),b(u({},t),{url:r,isDirect:!0,originalUrl:e})}catch(r){console.error(`[Resolver] Failed for ${e}:`,r)}return t})}var y="https://anime-sama.tv";function Z(t,e){return a(this,null,function*(){try{let n=`https://www.themoviedb.org/${e==="movie"?"movie":"tv"}/${t}?language=en-US`,r=yield w(n),s=T.default.load(r),o=s('meta[property="og:title"]').attr("content")||s("h1").first().text()||s("h2").first().text();return o&&o.includes(" (")&&(o=o.split(" (")[0]),o&&o.includes(" - ")&&(o=o.split(" - ")[0]),o=o?o.trim():null,console.log(`[Anime-Sama] TMDB Title found: ${o}`),o}catch(n){return console.error(`[Anime-Sama] Failed to get title from TMDB: ${n.message}`),null}})}function ee(t){return a(this,null,function*(){try{let e=`${y}/?s=${encodeURIComponent(t)}`,n=yield w(e),s=T.default.load(n)('a[href*="/catalogue/"]').first();if(s.length){let l=s.attr("href").match(/\/catalogue\/([^/]+)\/?/);if(l)return console.log(`[Anime-Sama] Search found slug: ${l[1]}`),l[1]}return null}catch(e){return console.error(`[Anime-Sama] Search Error: ${e.message}`),null}})}function te(t){return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function M(t,e){return e.includes("sibnet")?"Sibnet":e.includes("sendvid")?"Sendvid":e.includes("mycloud")?"MyCloud":e.includes("vidmoly")?"Vidmoly":e.includes("vido")?"Vido":`Player ${t.toUpperCase()}`}function W(t,e,n,r){return a(this,null,function*(){var i,h;let s=yield Z(t,e);if(!s)return[];let o=te(s),l=["vostfr","vf"],c=[];for(let S of l){let N=`${y}/catalogue/${o}/saison${n}/${S}/episodes.js`;try{let v=yield w(N),d=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),f;for(;(f=d.exec(v))!==null;){let x=f[1],m=(((i=f[2].match(/'(.*?)'/g))==null?void 0:i.map(g=>g.slice(1,-1)))||[])[r-1];if(m&&m.startsWith("http")){let g=yield R({name:`Anime-Sama (${S.toUpperCase()})`,title:`${M(x,m)} - Ep ${r}`,url:m,quality:"HD",headers:{Referer:y}});c.push(g)}}}catch(v){if(console.warn(`[Anime-Sama] episodes.js not found or error for ${S}: ${v.message}`),S===l[0]&&c.length===0){let d=yield ee(s);if(d&&d!==o){for(let f of l){let x=`${y}/catalogue/${d}/saison${n}/${f}/episodes.js`;try{let U=yield w(x),E=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),m;for(;(m=E.exec(U))!==null;){let g=m[1],$=(((h=m[2].match(/'(.*?)'/g))==null?void 0:h.map(A=>A.slice(1,-1)))||[])[r-1];if($&&$.startsWith("http")){let A=yield R({name:`Anime-Sama (${f.toUpperCase()})`,title:`${M(g,$)} - Ep ${r}`,url:$,quality:"HD",headers:{Referer:y}});c.push(A)}}}catch(U){}}if(c.length>0)return c}}}}return c})}function re(t,e,n,r){return a(this,null,function*(){try{return console.log(`[Anime-Sama] Request: ${e} ${t} S${n}E${r}`),yield W(t,e,n,r)}catch(s){return console.error(`[Anime-Sama] Error: ${s.message}`),[]}})}module.exports={getStreams:re};
