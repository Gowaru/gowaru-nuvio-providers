/**
 * anime-sama - Built from src/anime-sama/
 * Generated: 2026-02-25T16:30:00.186Z
 */
var _=Object.create;var R=Object.defineProperty,B=Object.defineProperties,J=Object.getOwnPropertyDescriptor,K=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertyNames,j=Object.getOwnPropertySymbols,G=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var I=(e,t,r)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,m=(e,t)=>{for(var r in t||(t={}))q.call(t,r)&&I(e,r,t[r]);if(j)for(var r of j(t))O.call(t,r)&&I(e,r,t[r]);return e},d=(e,t)=>B(e,K(t));var Q=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of V(t))!q.call(e,a)&&a!==r&&R(e,a,{get:()=>t[a],enumerable:!(n=J(t,a))||n.enumerable});return e};var X=(e,t,r)=>(r=e!=null?_(G(e)):{},Q(t||!e||!e.__esModule?R(r,"default",{value:e,enumerable:!0}):r,e));var c=(e,t,r)=>new Promise((n,a)=>{var s=o=>{try{u(r.next(o))}catch(l){a(l)}},i=o=>{try{u(r.throw(o))}catch(l){a(l)}},u=o=>o.done?n(o.value):Promise.resolve(o.value).then(s,i);u((r=r.apply(e,t)).next())});var Y={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0","Sec-Ch-Ua":'"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1"};function v(r){return c(this,arguments,function*(e,t={}){console.log(`[Anime-Sama] Fetching: ${e}`);let n=yield fetch(e,m({headers:m(m({},Y),t.headers)},t));if(!n.ok)throw new Error(`HTTP error ${n.status} for ${e}`);return yield n.text()})}var U=X(require("cheerio"));var Z={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36"},tt=e=>{try{return typeof atob=="function"?atob(e):Buffer.from(e,"base64").toString("binary")}catch(t){return e}};function g(r){return c(this,arguments,function*(e,t={}){try{let n=yield fetch(e,d(m({},t),{headers:m(m({},Z),t.headers)}));if(!n.ok)return null;let a=yield n.text(),s=n.headers.get("set-cookie")||"";return{text:()=>Promise.resolve(a),ok:!0,url:n.url,headers:{"set-cookie":s}}}catch(n){return null}})}function F(e){try{if(!e.includes("p,a,c,k,e,d"))return e;let t=e.match(/}\s*\((.*)\)\s*$/);if(!t)return e;let r=t[1].match(/(".+"|\d+)/g);if(r.length<4)return e;let[n,a,s,i]=[r[0].replace(/^"|"$/g,""),parseInt(r[1]),parseInt(r[2]),r[3].replace(/^"|"$/g,"").split("|")],u=l=>(l<a?"":u(parseInt(l/a)))+((l=l%a)>35?String.fromCharCode(l+29):l.toString(36)),o={};for(;s--;)o[u(s)]=i[s]||u(s);return n.replace(/\b\w+\b/g,l=>o[l]||l)}catch(t){return e}}function et(e){return c(this,null,function*(){try{let t=yield g(e,{headers:{Referer:"https://video.sibnet.ru/"}});if(!t)return{url:e};let r=yield t.text(),n=r.match(/src\s*:\s*["']([^"']+\.mp4)["']/)||r.match(/"url"\s*:\s*"([^"]+\.mp4)"/);if(n){let a=n[1];return a.startsWith("//")&&(a="https:"+a),{url:a,headers:{Referer:"https://video.sibnet.ru/"}}}}catch(t){}return{url:e}})}function rt(e){return c(this,null,function*(){try{let t=yield g(e,{headers:{Referer:"https://vidmoly.to/"}});if(!t)return{url:e};let r=yield t.text();r.includes("eval(function(p,a,c,k,e,d)")&&(r=F(r));let n=r.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/);if(n)return{url:n[1],headers:{Referer:"https://vidmoly.to/"}}}catch(t){}return{url:e}})}function N(e){return c(this,null,function*(){try{let t=yield g(e);if(!t)return{url:e};let r=yield t.text(),n=r.match(/window\.location\.href\s*=\s*['"]([^'"]+)['"]/);if(n)return N(n[1]);let a=r.match(/'hls'\s*:\s*'([^']+)'/)||r.match(/file\s*:\s*['"]([^'"]+\.m3u8[^'"]*)['"]/);if(a){let s=a[1];return s.includes("base64")&&(s=tt(s.split(",")[1]||s)),{url:s}}}catch(t){}return{url:e}})}function nt(e){return c(this,null,function*(){try{let t=yield g(e);if(!t)return{url:e};let r=yield t.text(),n=r.match(/document\.getElementById\(['"]robotlink['"]\)\.innerHTML\s*=\s*['"]([^'"]+)['"]\s*\+\s*(?:['"]([^'"]+)['"]|['"]([^'"]+)['"]\.substring\(\d+\))/);if(n){let a=n[1],s=n[2]||"";if(n[3]){let i=r.match(/substring\((\d+)\)/);s=n[3].substring(i?parseInt(i[1]):0)}return{url:"https:"+a+s}}}catch(t){}return{url:e}})}function at(e){return c(this,null,function*(){var t;try{let r=(t=e.match(/https?:\/\/([^\/]+)/))==null?void 0:t[1],n=yield g(e);if(!n||!r)return{url:e};let a=yield n.text();a.includes("eval(function(p,a,c,k,e,d)")&&(a=F(a));let s=a.match(/\$\.get\(['"]\/pass_md5\/([^'"]+)['"]/);if(s){let i=s[1],u=yield fetch(`https://${r}/pass_md5/${i}`,{headers:{Referer:e}});if(u.ok)return{url:(yield u.text())+"z762vpz?token="+i+"&expiry="+Date.now()}}}catch(r){}return{url:e}})}function k(e){return c(this,null,function*(){let t=e.url,r=t.toLowerCase();if(r.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/))return d(m({},e),{isDirect:!0});try{let n={url:t};if(r.includes("sibnet.ru"))n=yield et(t);else if(r.includes("vidmoly."))n=yield rt(t);else if(r.includes("voe."))n=yield N(t);else if(r.includes("streamtape.com")||r.includes("stape"))n=yield nt(t);else if(r.includes("dood")||r.includes("ds2play"))n=yield at(t);else{let a=yield g(t);if(a){let s=yield a.text(),i=s.match(/https?:\/\/[^"']+\.m3u8[^"']*/)||s.match(/https?:\/\/[^"']+\.mp4[^"']*/);i&&(n={url:i[0]})}}if(n.url!==t&&n.url.startsWith("http"))return d(m({},e),{url:n.url,isDirect:!0,headers:m(m({},e.headers),n.headers||{}),originalUrl:t})}catch(n){}return d(m({},e),{isDirect:!1})})}var st="https://arm.haglund.dev/api/v2";var ot="https://v3-cinemeta.strem.io";function W(r){return c(this,arguments,function*(e,t={}){try{let n=new AbortController,a=setTimeout(()=>n.abort(),8e3),s=yield fetch(e,d(m({},t),{signal:n.signal}));return clearTimeout(a),s}catch(n){return console.error(`[ArmSync] Fetch failed: ${e}`,n.message),null}})}function L(e,t){return c(this,null,function*(){if(!e)return null;let r=yield W(`${st}/themoviedb?id=${e}`);if(r){let n=yield r.json(),a=Array.isArray(n)?n[0]:n;if(a&&a.imdb)return a.imdb}return null})}function P(e,t,r){return c(this,null,function*(){var u;if(!e||t===0)return null;let n=yield W(`${ot}/meta/series/${e}.json`);if(!n)return null;let a=yield n.json();if(!((u=a==null?void 0:a.meta)!=null&&u.videos))return null;let i=a.meta.videos.filter(o=>o.season>0).sort((o,l)=>o.season-l.season||o.episode-l.episode).findIndex(o=>o.season==t&&o.episode==r);if(i!==-1){let o=i+1;return console.log(`[ArmSync] Resolved: S${t}E${r} -> Absolute ${o}`),o}return null})}var S="https://anime-sama.tv";function it(e,t){return c(this,null,function*(){try{let r=`https://www.themoviedb.org/${t==="movie"?"movie":"tv"}/${e}?language=en-US`,n=yield v(r),a=U.default.load(n),s=a('meta[property="og:title"]').attr("content")||a("h1").first().text()||a("h2").first().text();return s&&s.includes(" (")&&(s=s.split(" (")[0]),s&&s.includes(" - ")&&(s=s.split(" - ")[0]),s=s?s.trim():null,console.log(`[Anime-Sama] TMDB Title found: ${s}`),s}catch(r){return console.error(`[Anime-Sama] Failed to get title from TMDB: ${r.message}`),null}})}function ct(e){return c(this,null,function*(){try{let t=`${S}/?s=${encodeURIComponent(e)}`,r=yield v(t),a=U.default.load(r)('a[href*="/catalogue/"]').first();if(a.length){let i=a.attr("href").match(/\/catalogue\/([^/]+)\/?/);if(i)return console.log(`[Anime-Sama] Search found slug: ${i[1]}`),i[1]}return null}catch(t){return console.error(`[Anime-Sama] Search Error: ${t.message}`),null}})}function lt(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function z(e,t){return t.includes("sibnet")?"Sibnet":t.includes("sendvid")?"Sendvid":t.includes("mycloud")?"MyCloud":t.includes("vidmoly")?"Vidmoly":t.includes("vido")?"Vido":t.includes("voe")?"Voe":t.includes("stape")||t.includes("streamtape")?"Streamtape":t.includes("dood")||t.includes("ds2play")?"Doodstream":t.includes("uqload")||t.includes("oneupload")?"Uqload":`Player ${e.toUpperCase()}`}function H(e,t,r,n){return c(this,null,function*(){var l,M;let a=yield it(e,t);if(!a)return[];let s=n;try{let f=yield L(e,t);if(f){let y=yield P(f,r,n);y&&(console.log(`[Anime-Sama] ArmSync: Resolved S${r}E${n} -> Absolute Ep ${y}`),s=y)}}catch(f){console.warn(`[Anime-Sama] ArmSync resolution failed, falling back to episode ${n}`)}let i=lt(a),u=["vostfr","vf"],o=[];for(let f of u){let y=`${S}/catalogue/${i}/saison${r}/${f}/episodes.js`;try{let b=yield v(y),w=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),p;for(;(p=w.exec(b))!==null;){let C=p[1],x=((l=p[2].match(/'(.*?)'/g))==null?void 0:l.map($=>$.slice(1,-1)))||[],h=x[n-1]||x[s-1];if(h&&h.startsWith("http")){let $=yield k({name:`Anime-Sama (${f.toUpperCase()})`,title:`${z(C,h)} - Ep ${n}`,url:h,quality:"HD",headers:{Referer:S}});o.push($)}}}catch(b){if(console.warn(`[Anime-Sama] episodes.js not found or error for ${f}: ${b.message}`),f===u[0]&&o.length===0){let w=yield ct(a);if(w&&w!==i){for(let p of u){let C=`${S}/catalogue/${w}/saison${r}/${p}/episodes.js`;try{let D=yield v(C),x=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),h;for(;(h=x.exec(D))!==null;){let $=h[1],T=((M=h[2].match(/'(.*?)'/g))==null?void 0:M.map(E=>E.slice(1,-1)))||[],A=T[n-1]||T[s-1];if(A&&A.startsWith("http")){let E=yield k({name:`Anime-Sama (${p.toUpperCase()})`,title:`${z($,A)} - Ep ${n}`,url:A,quality:"HD",headers:{Referer:S}});o.push(E)}}}catch(D){}}if(o.length>0)return o}}}}return o})}function ut(e,t,r,n){return c(this,null,function*(){try{return console.log(`[Anime-Sama] Request: ${t} ${e} S${r}E${n}`),yield H(e,t,r,n)}catch(a){return console.error(`[Anime-Sama] Error: ${a.message}`),[]}})}module.exports={getStreams:ut};
