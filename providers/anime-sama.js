/**
 * anime-sama - Built from src/anime-sama/
 * Generated: 2026-02-25T23:09:39.601Z
 */
var V=Object.create;var _=Object.defineProperty,Y=Object.defineProperties,Q=Object.getOwnPropertyDescriptor,X=Object.getOwnPropertyDescriptors,Z=Object.getOwnPropertyNames,F=Object.getOwnPropertySymbols,tt=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable;var W=(t,s,e)=>s in t?_(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e,d=(t,s)=>{for(var e in s||(s={}))P.call(s,e)&&W(t,e,s[e]);if(F)for(var e of F(s))et.call(s,e)&&W(t,e,s[e]);return t},v=(t,s)=>Y(t,X(s));var st=(t,s,e,a)=>{if(s&&typeof s=="object"||typeof s=="function")for(let r of Z(s))!P.call(t,r)&&r!==e&&_(t,r,{get:()=>s[r],enumerable:!(a=Q(s,r))||a.enumerable});return t};var at=(t,s,e)=>(e=t!=null?V(tt(t)):{},st(s||!t||!t.__esModule?_(e,"default",{value:t,enumerable:!0}):e,t));var h=(t,s,e)=>new Promise((a,r)=>{var n=l=>{try{o(e.next(l))}catch(u){r(u)}},c=l=>{try{o(e.throw(l))}catch(u){r(u)}},o=l=>l.done?a(l.value):Promise.resolve(l.value).then(n,c);o((e=e.apply(t,s)).next())});var nt={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0","Sec-Ch-Ua":'"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1"};function j(e){return h(this,arguments,function*(t,s={}){console.log(`[Anime-Sama] Fetching: ${t}`);let a=yield fetch(t,d({headers:d(d({},nt),s.headers)},s));if(!a.ok)throw new Error(`HTTP error ${a.status} for ${t}`);return yield a.text()})}var G=at(require("cheerio-without-node-native"));var rt={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/145.0.0.0 Safari/537.36"},N=t=>{try{return typeof atob=="function"?atob(t):Buffer.from(t,"base64").toString("binary")}catch(s){return t}};function y(e){return h(this,arguments,function*(t,s={}){try{let a=yield fetch(t,v(d({},s),{headers:d(d({},rt),s.headers),redirect:"follow"}));if(!a.ok)return null;let r=yield a.text();return{text:()=>Promise.resolve(r),ok:!0,url:a.url,headers:a.headers}}catch(a){return null}})}function k(t){try{if(!t.includes("p,a,c,k,e,d"))return t;let s=new RegExp("eval\\s*\\(\\s*function\\s*\\(\\s*p\\s*,\\s*a\\s*,\\s*c\\s*,\\s*k\\s*,\\s*e\\s*,\\s*d\\s*\\).*?\\}\\s*\\((.*?)\\)\\s*\\)","gs"),e=t,a;for(;(a=s.exec(t))!==null;)try{let n=a[1].match(new RegExp("^'(.*?)',\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*'(.*?)'\\.split\\('\\|'\\)","s"));if(!n)continue;let c=n[1].replace(/\\'/g,"'"),o=parseInt(n[2]),l=parseInt(n[3]),u=n[4].split("|"),i=f=>(f<o?"":i(parseInt(f/o)))+((f=f%o)>35?String.fromCharCode(f+29):f.toString(36)),p={};for(;l--;)p[i(l)]=u[l]||i(l);let R=c.replace(/\b\w+\b/g,f=>p[f]||f);e=e.replace(a[0],R)}catch(r){}return e}catch(s){return t}}function it(t){return h(this,null,function*(){try{let s=yield y(t,{headers:{Referer:"https://video.sibnet.ru/"}});if(!s)return{url:t};let e=yield s.text(),a=e.match(/src\s*:\s*["']([^"']+\.mp4)["']/)||e.match(/"url"\s*:\s*"([^"]+\.mp4)"/);if(a){let r=a[1];return r.startsWith("//")?r="https:"+r:r.startsWith("/")&&(r="https://video.sibnet.ru"+r),{url:r,headers:{Referer:"https://video.sibnet.ru/"}}}}catch(s){}return{url:t}})}function ot(t){return h(this,null,function*(){try{let s=yield y(t,{headers:{Referer:"https://vidmoly.to/"}});if(!s)return{url:t};let e=yield s.text();e.includes("eval(function(p,a,c,k,e,d)")&&(e=k(e));let a=e.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/);if(a)return{url:a[1],headers:{Referer:"https://vidmoly.to/"}}}catch(s){}return{url:t}})}function ct(t){return h(this,null,function*(){try{let s=yield y(t,{headers:{Referer:"https://uqload.com/"}});if(!s)return{url:t};let e=yield s.text(),a=e.match(/sources\s*:\s*\[["']([^"']+\.(?:mp4|m3u8))["']\]/)||e.match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/);if(a)return{url:a[1],headers:{Referer:"https://uqload.com/"}}}catch(s){}return{url:t}})}function lt(t){return h(this,null,function*(){try{let s=yield y(t);if(!s)return{url:t};let e=yield s.text(),a=e.match(/window\.location\.href\s*=\s*['"]([^'"]+)['"]/);if(a){let n=yield y(a[1]);n&&(e=yield n.text())}let r=e.match(/'hls'\s*:\s*'([^']+)'/)||e.match(/"hls"\s*:\s*"([^"]+)"/)||e.match(/https?:\/\/[^"']+\.m3u8[^"']*/);if(r){let n=r[1]||r[0];return n.includes("base64")&&(n=N(n.split(",")[1]||n)),{url:n,headers:{Referer:t}}}}catch(s){}return{url:t}})}function ut(t){return h(this,null,function*(){try{let s=yield y(t);if(!s)return{url:t};let e=yield s.text();e.includes("p,a,c,k,e,d")&&(e=k(e));let a=e.match(/robotlink['"]\)\.innerHTML\s*=\s*['"]([^'"]+)['"]\s*\+\s*([^;]+)/);if(a){let r="https:"+a[1],n=a[2].split("+");for(let c of n){let o=c.match(/['"]([^'"]+)['"]/);if(o){let l=o[1],u=c.match(/substring\((\d+)\)/);u&&(l=l.substring(parseInt(u[1]))),r+=l}}return{url:r,headers:{Referer:"https://streamtape.com/"}}}}catch(s){}return{url:t}})}function ft(t){return h(this,null,function*(){try{let s=yield y(t);if(!s)return{url:t};let e=yield s.text(),a=e.match(/video_source\s*:\s*["']([^"']+\.mp4[^"']*)["']/)||e.match(/source\s+src=["']([^"']+\.mp4[^"']*)["']/);if(a)return{url:a[1]}}catch(s){}return{url:t}})}function ht(t){return h(this,null,function*(){try{let s=yield y(t);if(!s)return{url:t};let e=yield s.text();e.includes("p,a,c,k,e,d")&&(e=k(e));let a=e.match(/sources\s*:\s*\[["']([^"']+\.(?:m3u8|mp4)[^"']*)["']\]/)||e.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/);if(a){let r=a[1];return r.includes("base64")&&(r=N(r.split(",")[1]||r)),{url:r,headers:{Referer:t}}}}catch(s){}return{url:t}})}function mt(t){return h(this,null,function*(){try{let s=yield y(t);if(!s)return{url:t};let a=(yield s.text()).match(/["'](https?:\/\/[^"']+\.m3u8[^"']*)["']/);if(a)return{url:a[1],headers:{Referer:t}}}catch(s){}return{url:t}})}function dt(t){return h(this,null,function*(){var s;try{let e=((s=t.match(/https?:\/\/([^\/]+)/))==null?void 0:s[1])||"dood.to",a=yield y(t);if(!a)return{url:t};let r=yield a.text();r.includes("eval(function(p,a,c,k,e,d)")&&(r=k(r));let n=r.match(/\$\.get\(['"]\/pass_md5\/([^'"]+)['"]/);if(n){let c=n[1],o=`https://${e}/pass_md5/${c}`,l=yield fetch(o,{headers:{Referer:t}});if(l.ok){let u=yield l.text(),i=Math.random().toString(36).substring(2,12);return{url:u+i+"?token="+c+"&expiry="+Date.now(),headers:{Referer:`https://${e}/`}}}}}catch(e){}return{url:t}})}function pt(t){return h(this,null,function*(){try{let s=yield y(t);if(!s)return{url:t};let a=(yield s.text()).match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8)[^"']*)["']/);if(a)return{url:a[1],headers:{Referer:t}}}catch(s){}return{url:t}})}function C(t,s=0){return h(this,null,function*(){var r;if(s>3)return v(d({},t),{isDirect:!1});let e=t.url,a=e.toLowerCase();if(!e||e.includes("google-analytics")||e.includes("doubleclick"))return null;if(a.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/)&&!a.includes("html"))return v(d({},t),{isDirect:!0});try{let n=null;if(a.includes("sibnet.ru")?n=yield it(e):a.includes("vidmoly.")?n=yield ot(e):a.includes("uqload.")||a.includes("oneupload.")?n=yield ct(e):a.includes("voe.")?n=yield lt(e):a.includes("streamtape.com")||a.includes("stape")?n=yield ut(e):a.includes("dood")||a.includes("ds2play")?n=yield dt(e):a.includes("moonplayer")||a.includes("moon.")?n=yield pt(e):a.includes("sendvid.")?n=yield ft(e):a.includes("luluvid.")||a.includes("lulu.")?n=yield ht(e):(a.includes("hgcloud.")||a.includes("savefiles."))&&(n=yield mt(e)),n&&n.url!==e)return v(d({},t),{url:n.url,headers:d(d({},t.headers),n.headers||{}),isDirect:!0,originalUrl:e});if(!n||n.url===e){let c=yield y(e,{headers:t.headers});if(c){let o=yield c.text();o.includes("p,a,c,k,e,d")&&(o=k(o));let l=o.match(/https?:\/\/[^"']+\.m3u8[^"']*/)||o.match(/https?:\/\/[^"']+\.mp4[^"']*/)||o.match(/file\s*:\s*["']([^"']+)["']/);if(l){let u=l[1]||l[0];u.startsWith("//")&&(u="https:"+u),u.startsWith("http")&&!u.includes(gt)&&(n={url:u})}if(!n){let u=o.match(/<iframe\s+[^>]*src=["']([^"']+)["']/i);if(u){let i=u[1];if(i.startsWith("//")&&(i="https:"+i),i.startsWith("/")){let p=(r=e.match(/^https?:\/\/[^\/]+/))==null?void 0:r[0];p&&(i=p+i)}if(i.startsWith("http")&&i!==e)return console.log(`[Resolver] Peeling: Found nested iframe -> ${i}`),yield C(v(d({},t),{url:i}),s+1)}}}}if(n&&n.url!==e&&n.url.startsWith("http"))return v(d({},t),{url:n.url,headers:d(d({},t.headers),n.headers||{}),isDirect:!0,originalUrl:e})}catch(n){}return v(d({},t),{isDirect:!1})})}var gt="googletagmanager";var wt="https://arm.haglund.dev/api/v2";var yt="https://v3-cinemeta.strem.io";function q(e){return h(this,arguments,function*(t,s={}){try{let a=new AbortController,r=setTimeout(()=>a.abort(),8e3),n=yield fetch(t,v(d({},s),{signal:a.signal}));return clearTimeout(r),n}catch(a){return console.error(`[ArmSync] Fetch failed: ${t}`,a.message),null}})}function I(t,s){return h(this,null,function*(){if(!t)return null;let e=yield q(`${wt}/themoviedb?id=${t}`);if(e)try{let n=yield e.json(),c=Array.isArray(n)?n[0]:n;if(c&&c.imdb)return c.imdb}catch(n){}let a=`https://www.themoviedb.org/${s==="movie"?"movie":"tv"}/${t}`,r=yield q(a);if(r){let c=(yield r.text()).match(/imdb\.com\/title\/(tt\d+)/);if(c)return c[1]}return null})}function L(t,s,e){return h(this,null,function*(){var u;if(!t||s===0)return null;let a=yield q(`${yt}/meta/series/${t}.json`);if(!a)return null;let r=yield a.json();if(!((u=r==null?void 0:r.meta)!=null&&u.videos))return null;let n=r.meta.videos.filter(i=>i.season>0&&i.episode>0).sort((i,p)=>i.season-p.season||i.episode-p.episode),c=[],o=new Set;for(let i of n){let p=`${i.season}-${i.episode}`;o.has(p)||(o.add(p),c.push(i))}let l=c.findIndex(i=>i.season==s&&i.episode==e);if(l!==-1){let i=l+1;return console.log(`[ArmSync] Resolved: S${s}E${e} -> Absolute ${i}`),i}return null})}var B="8265bd1679663a7ea12ac168da84d2e8",H="https://api.themoviedb.org/3";function z(t){return h(this,null,function*(){try{let s=new AbortController,e=setTimeout(()=>s.abort(),8e3),a=yield fetch(t,{headers:{"User-Agent":"Mozilla/5.0",Accept:"application/json"},signal:s.signal});return clearTimeout(e),a.ok?a:null}catch(s){return null}})}function K(t,s){return h(this,null,function*(){var r,n,c,o,l,u;let e=s==="movie"?"movie":"tv",a=[];try{let i=`${H}/${e}/${t}?api_key=${B}&language=en-US`,p=yield z(i);if(p){let w=yield p.json(),m=(r=e==="movie"?w.title:w.name)==null?void 0:r.trim(),g=(n=e==="movie"?w.original_title:w.original_name)==null?void 0:n.trim();m&&a.push(m),g&&g!==m&&/^[\x00-\x7F\u00C0-\u024F\s]+$/.test(g)&&a.push(g)}let R=`${H}/${e}/${t}/translations?api_key=${B}`,f=yield z(R);if(f){let m=((yield f.json()).translations||[]).find(S=>S.iso_639_1==="fr"),g=((o=(c=m==null?void 0:m.data)==null?void 0:c.name)==null?void 0:o.trim())||((u=(l=m==null?void 0:m.data)==null?void 0:l.title)==null?void 0:u.trim());g&&!a.includes(g)&&a.push(g)}}catch(i){console.error(`[Metadata] TMDB API error: ${i.message}`)}return console.log(`[Metadata] Titles for ${t}: ${a.join(" | ")}`),a})}var x="https://anime-sama.tv";function $t(t){return h(this,null,function*(){try{let s=yield j(`${x}/template-php/defaut/fetch.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Referer:x},body:`query=${encodeURIComponent(t)}`}),e=G.load(s),a=[];return e('a[href*="/catalogue/"]').each((r,n)=>{let o=e(n).attr("href").match(/\/catalogue\/([^/]+)\/?/);o&&!a.includes(o[1])&&a.push(o[1])}),a}catch(s){return[]}})}function vt(t){return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function O(t,s){return s.includes("sibnet")?"Sibnet":s.includes("vidmoly")?"Vidmoly":s.includes("sendvid")?"Sendvid":s.includes("voe")?"Voe":s.includes("stape")||s.includes("streamtape")?"Streamtape":s.includes("dood")?"Doodstream":s.includes("uqload")||s.includes("oneupload")?"Uqload":"Player"}function J(t,s,e,a){return h(this,null,function*(){var p,R;let r=yield K(t,s);if(r.length===0)return[];let n=r[0],c=a;try{let f=yield I(t,s);if(f){let w=yield L(f,e,a);w&&(c=w)}}catch(f){}let o=vt(n),l=["vostfr","vf"],u=[];for(let f of l){let w=[`${x}/catalogue/${o}/saison${e}/${f}/episodes.js`,`${x}/catalogue/${o}/${f}/episodes.js`];e>1&&c&&w.push(`${x}/catalogue/${o}/saison1/${f}/episodes.js`);for(let m of w)try{let g=yield j(m),S=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),b;for(;(b=S.exec(g))!==null;){let E=b[1],U=((p=b[2].match(/['"](.*?)['"]/g))==null?void 0:p.map(D=>D.slice(1,-1)))||[],$=null;if(m.includes(`saison${e}`)?$=U[a-1]:(m.includes("saison1")||!m.includes("saison"))&&(e>1&&c!==a?$=U[c-1]:$=U[a-1]),$&&$.startsWith("http")){let D=yield C({name:`Anime-Sama (${f.toUpperCase()})`,title:`${O(E,$)} - Ep ${a}`,url:$,quality:"HD",headers:{Referer:x}});u.push(D)}}}catch(g){}}if(u.length===0){let f=[];for(let m of r)(yield $t(m)).forEach(S=>{f.includes(S)||f.push(S)});let w=new Set([o]);for(let m of f)if(!w.has(m)){w.add(m);for(let g of l){let S=[`${x}/catalogue/${m}/saison${e}/${g}/episodes.js`,`${x}/catalogue/${m}/${g}/episodes.js`];e>1&&c&&S.push(`${x}/catalogue/${m}/saison1/${g}/episodes.js`);for(let b of S)try{let E=yield j(b),U=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),$;for(;($=U.exec(E))!==null;){let D=$[1],T=((R=$[2].match(/['"](.*?)['"]/g))==null?void 0:R.map(M=>M.slice(1,-1)))||[],A=null;if(b.includes(`saison${e}`)?A=T[a-1]:(b.includes("saison1")||!b.includes("saison"))&&(e>1&&c!==a?A=T[c-1]:A=T[a-1]),A&&A.startsWith("http")){let M=yield C({name:`Anime-Sama (${g.toUpperCase()})`,title:`${O(D,A)} - Ep ${a}`,url:A,quality:"HD",headers:{Referer:x}});M&&u.push(M)}}}catch(E){}}}}let i=u.filter(f=>f&&f.isDirect);return console.log(`[Anime-Sama] Total streams found: ${i.length}`),i})}function xt(t,s,e,a){return h(this,null,function*(){try{return console.log(`[Anime-Sama] Request: ${s} ${t} S${e}E${a}`),yield J(t,s,e,a)}catch(r){return console.error(`[Anime-Sama] Error: ${r.message}`),[]}})}module.exports={getStreams:xt};
