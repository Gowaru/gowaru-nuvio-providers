/**
 * anime-sama - Built from src/anime-sama/
 * Generated: 2026-02-25T22:30:07.600Z
 */
var B=Object.create;var T=Object.defineProperty,K=Object.defineProperties,G=Object.getOwnPropertyDescriptor,J=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertyNames,N=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var F=(t,s,e)=>s in t?T(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e,h=(t,s)=>{for(var e in s||(s={}))P.call(s,e)&&F(t,e,s[e]);if(N)for(var e of N(s))Q.call(s,e)&&F(t,e,s[e]);return t},v=(t,s)=>K(t,J(s));var X=(t,s,e,r)=>{if(s&&typeof s=="object"||typeof s=="function")for(let n of O(s))!P.call(t,n)&&n!==e&&T(t,n,{get:()=>s[n],enumerable:!(r=G(s,n))||r.enumerable});return t};var Y=(t,s,e)=>(e=t!=null?B(V(t)):{},X(s||!t||!t.__esModule?T(e,"default",{value:t,enumerable:!0}):e,t));var f=(t,s,e)=>new Promise((r,n)=>{var a=o=>{try{c(e.next(o))}catch(u){n(u)}},l=o=>{try{c(e.throw(o))}catch(u){n(u)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(a,l);c((e=e.apply(t,s)).next())});var Z={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0","Sec-Ch-Ua":'"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1"};function U(e){return f(this,arguments,function*(t,s={}){console.log(`[Anime-Sama] Fetching: ${t}`);let r=yield fetch(t,h({headers:h(h({},Z),s.headers)},s));if(!r.ok)throw new Error(`HTTP error ${r.status} for ${t}`);return yield r.text()})}var W=Y(require("cheerio"));var tt={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/145.0.0.0 Safari/537.36"},I=t=>{try{return typeof atob=="function"?atob(t):Buffer.from(t,"base64").toString("binary")}catch(s){return t}};function w(e){return f(this,arguments,function*(t,s={}){try{let r=yield fetch(t,v(h({},s),{headers:h(h({},tt),s.headers),redirect:"follow"}));if(!r.ok)return null;let n=yield r.text();return{text:()=>Promise.resolve(n),ok:!0,url:r.url,headers:r.headers}}catch(r){return null}})}function k(t){try{if(!t.includes("p,a,c,k,e,d"))return t;let s=new RegExp("eval\\s*\\(\\s*function\\s*\\(\\s*p\\s*,\\s*a\\s*,\\s*c\\s*,\\s*k\\s*,\\s*e\\s*,\\s*d\\s*\\).*?\\}\\s*\\((.*?)\\)\\s*\\)","gs"),e=t,r;for(;(r=s.exec(t))!==null;)try{let a=r[1].match(new RegExp("^'(.*?)',\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*'(.*?)'\\.split\\('\\|'\\)","s"));if(!a)continue;let l=a[1].replace(/\\'/g,"'"),c=parseInt(a[2]),o=parseInt(a[3]),u=a[4].split("|"),i=m=>(m<c?"":i(parseInt(m/c)))+((m=m%c)>35?String.fromCharCode(m+29):m.toString(36)),p={};for(;o--;)p[i(o)]=u[o]||i(o);let d=l.replace(/\b\w+\b/g,m=>p[m]||m);e=e.replace(r[0],d)}catch(n){}return e}catch(s){return t}}function et(t){return f(this,null,function*(){try{let s=yield w(t,{headers:{Referer:"https://video.sibnet.ru/"}});if(!s)return{url:t};let e=yield s.text(),r=e.match(/src\s*:\s*["']([^"']+\.mp4)["']/)||e.match(/"url"\s*:\s*"([^"]+\.mp4)"/);if(r){let n=r[1];return n.startsWith("//")?n="https:"+n:n.startsWith("/")&&(n="https://video.sibnet.ru"+n),{url:n,headers:{Referer:"https://video.sibnet.ru/"}}}}catch(s){}return{url:t}})}function st(t){return f(this,null,function*(){try{let s=yield w(t,{headers:{Referer:"https://vidmoly.to/"}});if(!s)return{url:t};let e=yield s.text();e.includes("eval(function(p,a,c,k,e,d)")&&(e=k(e));let r=e.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/);if(r)return{url:r[1],headers:{Referer:"https://vidmoly.to/"}}}catch(s){}return{url:t}})}function rt(t){return f(this,null,function*(){try{let s=yield w(t,{headers:{Referer:"https://uqload.com/"}});if(!s)return{url:t};let e=yield s.text(),r=e.match(/sources\s*:\s*\[["']([^"']+\.(?:mp4|m3u8))["']\]/)||e.match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/);if(r)return{url:r[1],headers:{Referer:"https://uqload.com/"}}}catch(s){}return{url:t}})}function at(t){return f(this,null,function*(){try{let s=yield w(t);if(!s)return{url:t};let e=yield s.text(),r=e.match(/window\.location\.href\s*=\s*['"]([^'"]+)['"]/);if(r){let a=yield w(r[1]);a&&(e=yield a.text())}let n=e.match(/'hls'\s*:\s*'([^']+)'/)||e.match(/"hls"\s*:\s*"([^"]+)"/)||e.match(/https?:\/\/[^"']+\.m3u8[^"']*/);if(n){let a=n[1]||n[0];return a.includes("base64")&&(a=I(a.split(",")[1]||a)),{url:a,headers:{Referer:t}}}}catch(s){}return{url:t}})}function nt(t){return f(this,null,function*(){try{let s=yield w(t);if(!s)return{url:t};let e=yield s.text();e.includes("p,a,c,k,e,d")&&(e=k(e));let r=e.match(/robotlink['"]\)\.innerHTML\s*=\s*['"]([^'"]+)['"]\s*\+\s*([^;]+)/);if(r){let n="https:"+r[1],a=r[2].split("+");for(let l of a){let c=l.match(/['"]([^'"]+)['"]/);if(c){let o=c[1],u=l.match(/substring\((\d+)\)/);u&&(o=o.substring(parseInt(u[1]))),n+=o}}return{url:n,headers:{Referer:"https://streamtape.com/"}}}}catch(s){}return{url:t}})}function it(t){return f(this,null,function*(){try{let s=yield w(t);if(!s)return{url:t};let e=yield s.text(),r=e.match(/video_source\s*:\s*["']([^"']+\.mp4[^"']*)["']/)||e.match(/source\s+src=["']([^"']+\.mp4[^"']*)["']/);if(r)return{url:r[1]}}catch(s){}return{url:t}})}function ot(t){return f(this,null,function*(){try{let s=yield w(t);if(!s)return{url:t};let e=yield s.text();e.includes("p,a,c,k,e,d")&&(e=k(e));let r=e.match(/sources\s*:\s*\[["']([^"']+\.(?:m3u8|mp4)[^"']*)["']\]/)||e.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/);if(r){let n=r[1];return n.includes("base64")&&(n=I(n.split(",")[1]||n)),{url:n,headers:{Referer:t}}}}catch(s){}return{url:t}})}function ct(t){return f(this,null,function*(){try{let s=yield w(t);if(!s)return{url:t};let r=(yield s.text()).match(/["'](https?:\/\/[^"']+\.m3u8[^"']*)["']/);if(r)return{url:r[1],headers:{Referer:t}}}catch(s){}return{url:t}})}function lt(t){return f(this,null,function*(){var s;try{let e=((s=t.match(/https?:\/\/([^\/]+)/))==null?void 0:s[1])||"dood.to",r=yield w(t);if(!r)return{url:t};let n=yield r.text();n.includes("eval(function(p,a,c,k,e,d)")&&(n=k(n));let a=n.match(/\$\.get\(['"]\/pass_md5\/([^'"]+)['"]/);if(a){let l=a[1],c=`https://${e}/pass_md5/${l}`,o=yield fetch(c,{headers:{Referer:t}});if(o.ok){let u=yield o.text(),i=Math.random().toString(36).substring(2,12);return{url:u+i+"?token="+l+"&expiry="+Date.now(),headers:{Referer:`https://${e}/`}}}}}catch(e){}return{url:t}})}function ut(t){return f(this,null,function*(){try{let s=yield w(t);if(!s)return{url:t};let r=(yield s.text()).match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8)[^"']*)["']/);if(r)return{url:r[1],headers:{Referer:t}}}catch(s){}return{url:t}})}function M(t,s=0){return f(this,null,function*(){var n;if(s>3)return v(h({},t),{isDirect:!1});let e=t.url,r=e.toLowerCase();if(!e||e.includes("google-analytics")||e.includes("doubleclick"))return null;if(r.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/)&&!r.includes("html"))return v(h({},t),{isDirect:!0});try{let a=null;if(r.includes("sibnet.ru")?a=yield et(e):r.includes("vidmoly.")?a=yield st(e):r.includes("uqload.")||r.includes("oneupload.")?a=yield rt(e):r.includes("voe.")?a=yield at(e):r.includes("streamtape.com")||r.includes("stape")?a=yield nt(e):r.includes("dood")||r.includes("ds2play")?a=yield lt(e):r.includes("moonplayer")||r.includes("moon.")?a=yield ut(e):r.includes("sendvid.")?a=yield it(e):r.includes("luluvid.")||r.includes("lulu.")?a=yield ot(e):(r.includes("hgcloud.")||r.includes("savefiles."))&&(a=yield ct(e)),a&&a.url!==e)return v(h({},t),{url:a.url,headers:h(h({},t.headers),a.headers||{}),isDirect:!0,originalUrl:e});if(!a||a.url===e){let l=yield w(e,{headers:t.headers});if(l){let c=yield l.text();c.includes("p,a,c,k,e,d")&&(c=k(c));let o=c.match(/https?:\/\/[^"']+\.m3u8[^"']*/)||c.match(/https?:\/\/[^"']+\.mp4[^"']*/)||c.match(/file\s*:\s*["']([^"']+)["']/);if(o){let u=o[1]||o[0];u.startsWith("//")&&(u="https:"+u),u.startsWith("http")&&!u.includes(ft)&&(a={url:u})}if(!a){let u=c.match(/<iframe\s+[^>]*src=["']([^"']+)["']/i);if(u){let i=u[1];if(i.startsWith("//")&&(i="https:"+i),i.startsWith("/")){let p=(n=e.match(/^https?:\/\/[^\/]+/))==null?void 0:n[0];p&&(i=p+i)}if(i.startsWith("http")&&i!==e)return console.log(`[Resolver] Peeling: Found nested iframe -> ${i}`),yield M(v(h({},t),{url:i}),s+1)}}}}if(a&&a.url!==e&&a.url.startsWith("http"))return v(h({},t),{url:a.url,headers:h(h({},t.headers),a.headers||{}),isDirect:!0,originalUrl:e})}catch(a){}return v(h({},t),{isDirect:!1})})}var ft="googletagmanager";var ht="https://arm.haglund.dev/api/v2";var mt="https://v3-cinemeta.strem.io";function q(e){return f(this,arguments,function*(t,s={}){try{let r=new AbortController,n=setTimeout(()=>r.abort(),8e3),a=yield fetch(t,v(h({},s),{signal:r.signal}));return clearTimeout(n),a}catch(r){return console.error(`[ArmSync] Fetch failed: ${t}`,r.message),null}})}function _(t,s){return f(this,null,function*(){if(!t)return null;let e=yield q(`${ht}/themoviedb?id=${t}`);if(e)try{let a=yield e.json(),l=Array.isArray(a)?a[0]:a;if(l&&l.imdb)return l.imdb}catch(a){}let r=`https://www.themoviedb.org/${s==="movie"?"movie":"tv"}/${t}`,n=yield q(r);if(n){let l=(yield n.text()).match(/imdb\.com\/title\/(tt\d+)/);if(l)return l[1]}return null})}function L(t,s,e){return f(this,null,function*(){var u;if(!t||s===0)return null;let r=yield q(`${mt}/meta/series/${t}.json`);if(!r)return null;let n=yield r.json();if(!((u=n==null?void 0:n.meta)!=null&&u.videos))return null;let a=n.meta.videos.filter(i=>i.season>0&&i.episode>0).sort((i,p)=>i.season-p.season||i.episode-p.episode),l=[],c=new Set;for(let i of a){let p=`${i.season}-${i.episode}`;c.has(p)||(c.add(p),l.push(i))}let o=l.findIndex(i=>i.season==s&&i.episode==e);if(o!==-1){let i=o+1;return console.log(`[ArmSync] Resolved: S${s}E${e} -> Absolute ${i}`),i}return null})}var $="https://anime-sama.tv";function dt(t,s){return f(this,null,function*(){try{let e=`https://www.themoviedb.org/${s==="movie"?"movie":"tv"}/${t}?language=en-US`,r=yield U(e),n=W.load(r),a=n('meta[property="og:title"]').attr("content")||n("h1").first().text();return a&&a.includes(" (")&&(a=a.split(" (")[0]),a&&a.includes(" - ")&&(a=a.split(" - ")[0]),a?a.trim():null}catch(e){return null}})}function pt(t){return f(this,null,function*(){try{let s=yield U(`${$}/template-php/defaut/fetch.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Referer:$},body:`query=${encodeURIComponent(t)}`}),e=W.load(s),r=[];return e('a[href*="/catalogue/"]').each((n,a)=>{let c=e(a).attr("href").match(/\/catalogue\/([^/]+)\/?/);c&&!r.includes(c[1])&&r.push(c[1])}),r}catch(s){return[]}})}function wt(t){return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function H(t,s){return s.includes("sibnet")?"Sibnet":s.includes("vidmoly")?"Vidmoly":s.includes("sendvid")?"Sendvid":s.includes("voe")?"Voe":s.includes("stape")||s.includes("streamtape")?"Streamtape":s.includes("dood")?"Doodstream":s.includes("uqload")||s.includes("oneupload")?"Uqload":"Player"}function z(t,s,e,r){return f(this,null,function*(){var i,p;let n=yield dt(t,s);if(!n)return[];let a=r;try{let d=yield _(t,s);if(d){let m=yield L(d,e,r);m&&(a=m)}}catch(d){}let l=wt(n),c=["vostfr","vf"],o=[];for(let d of c){let m=[`${$}/catalogue/${l}/saison${e}/${d}/episodes.js`,`${$}/catalogue/${l}/${d}/episodes.js`];e>1&&a&&m.push(`${$}/catalogue/${l}/saison1/${d}/episodes.js`);for(let y of m)try{let S=yield U(y),D=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),x;for(;(x=D.exec(S))!==null;){let E=x[1],A=((i=x[2].match(/['"](.*?)['"]/g))==null?void 0:i.map(R=>R.slice(1,-1)))||[],g=null;if(y.includes(`saison${e}`)?g=A[r-1]:(y.includes("saison1")||!y.includes("saison"))&&(e>1&&a!==r?g=A[a-1]:g=A[r-1]),g&&g.startsWith("http")){let R=yield M({name:`Anime-Sama (${d.toUpperCase()})`,title:`${H(E,g)} - Ep ${r}`,url:g,quality:"HD",headers:{Referer:$}});o.push(R)}}}catch(S){}}if(o.length===0){let d=yield pt(n),m=new Set([l]);for(let y of d)if(!m.has(y)){m.add(y);for(let S of c){let D=[`${$}/catalogue/${y}/saison${e}/${S}/episodes.js`,`${$}/catalogue/${y}/${S}/episodes.js`];e>1&&a&&D.push(`${$}/catalogue/${y}/saison1/${S}/episodes.js`);for(let x of D)try{let E=yield U(x),A=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),g;for(;(g=A.exec(E))!==null;){let R=g[1],j=((p=g[2].match(/['"](.*?)['"]/g))==null?void 0:p.map(C=>C.slice(1,-1)))||[],b=null;if(x.includes(`saison${e}`)?b=j[r-1]:(x.includes("saison1")||!x.includes("saison"))&&(e>1&&a!==r?b=j[a-1]:b=j[r-1]),b&&b.startsWith("http")){let C=yield M({name:`Anime-Sama (${S.toUpperCase()})`,title:`${H(R,b)} - Ep ${r}`,url:b,quality:"HD",headers:{Referer:$}});C&&o.push(C)}}}catch(E){}}}}let u=o.filter(d=>d&&d.isDirect);return console.log(`[Anime-Sama] Total streams found: ${u.length}`),u})}function gt(t,s,e,r){return f(this,null,function*(){try{return console.log(`[Anime-Sama] Request: ${s} ${t} S${e}E${r}`),yield z(t,s,e,r)}catch(n){return console.error(`[Anime-Sama] Error: ${n.message}`),[]}})}module.exports={getStreams:gt};
