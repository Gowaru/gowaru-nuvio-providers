/**
 * anime-sama - Built from src/anime-sama/
 * Generated: 2026-02-25T18:32:18.129Z
 */
var z=Object.create;var M=Object.defineProperty,B=Object.defineProperties,K=Object.getOwnPropertyDescriptor,G=Object.getOwnPropertyDescriptors,J=Object.getOwnPropertyNames,W=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var N=(t,e,s)=>e in t?M(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,h=(t,e)=>{for(var s in e||(e={}))F.call(e,s)&&N(t,s,e[s]);if(W)for(var s of W(e))O.call(e,s)&&N(t,s,e[s]);return t},p=(t,e)=>B(t,G(e));var Q=(t,e,s,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of J(e))!F.call(t,a)&&a!==s&&M(t,a,{get:()=>e[a],enumerable:!(n=K(e,a))||n.enumerable});return t};var X=(t,e,s)=>(s=t!=null?z(V(t)):{},Q(e||!t||!t.__esModule?M(s,"default",{value:t,enumerable:!0}):s,t));var f=(t,e,s)=>new Promise((n,a)=>{var r=o=>{try{u(s.next(o))}catch(i){a(i)}},c=o=>{try{u(s.throw(o))}catch(i){a(i)}},u=o=>o.done?n(o.value):Promise.resolve(o.value).then(r,c);u((s=s.apply(t,e)).next())});var Y={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0","Sec-Ch-Ua":'"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1"};function A(s){return f(this,arguments,function*(t,e={}){console.log(`[Anime-Sama] Fetching: ${t}`);let n=yield fetch(t,h({headers:h(h({},Y),e.headers)},e));if(!n.ok)throw new Error(`HTTP error ${n.status} for ${t}`);return yield n.text()})}var T=X(require("cheerio"));var Z={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36"},I=t=>{try{return typeof atob=="function"?atob(t):Buffer.from(t,"base64").toString("binary")}catch(e){return t}};function d(s){return f(this,arguments,function*(t,e={}){try{let n=yield fetch(t,p(h({},e),{headers:h(h({},Z),e.headers),redirect:"follow"}));if(!n.ok)return null;let a=yield n.text();return{text:()=>Promise.resolve(a),ok:!0,url:n.url,headers:n.headers}}catch(n){return null}})}function U(t){try{if(!t.includes("p,a,c,k,e,d"))return t;let e=t.match(/}\s*\((.*)\)\s*$/);if(!e)return t;let s=e[1].match(/(".+"|\d+)/g);if(s.length<4)return t;let[n,a,r,c]=[s[0].replace(/^"|"$/g,""),parseInt(s[1]),parseInt(s[2]),s[3].replace(/^"|"$/g,"").split("|")],u=i=>(i<a?"":u(parseInt(i/a)))+((i=i%a)>35?String.fromCharCode(i+29):i.toString(36)),o={};for(;r--;)o[u(r)]=c[r]||u(r);return n.replace(/\b\w+\b/g,i=>o[i]||i)}catch(e){return t}}function tt(t){return f(this,null,function*(){try{let e=yield d(t,{headers:{Referer:"https://video.sibnet.ru/"}});if(!e)return{url:t};let s=yield e.text(),n=s.match(/src\s*:\s*["']([^"']+\.mp4)["']/)||s.match(/"url"\s*:\s*"([^"]+\.mp4)"/);if(n){let a=n[1];return a.startsWith("//")&&(a="https:"+a),{url:a,headers:{Referer:"https://video.sibnet.ru/"}}}}catch(e){}return{url:t}})}function et(t){return f(this,null,function*(){try{let e=yield d(t,{headers:{Referer:"https://vidmoly.to/"}});if(!e)return{url:t};let s=yield e.text();s.includes("eval(function(p,a,c,k,e,d)")&&(s=U(s));let n=s.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/);if(n)return{url:n[1],headers:{Referer:"https://vidmoly.to/"}}}catch(e){}return{url:t}})}function st(t){return f(this,null,function*(){try{let e=yield d(t,{headers:{Referer:"https://uqload.com/"}});if(!e)return{url:t};let s=yield e.text(),n=s.match(/sources\s*:\s*\[["']([^"']+\.(?:mp4|m3u8))["']\]/)||s.match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/);if(n)return{url:n[1],headers:{Referer:"https://uqload.com/"}}}catch(e){}return{url:t}})}function nt(t){return f(this,null,function*(){try{let e=yield d(t);if(!e)return{url:t};let s=yield e.text(),n=s.match(/window\.location\.href\s*=\s*['"]([^'"]+)['"]/);if(n){let r=yield d(n[1]);r&&(s=yield r.text())}let a=s.match(/'hls'\s*:\s*'([^']+)'/)||s.match(/"hls"\s*:\s*"([^"]+)"/)||s.match(/https?:\/\/[^"']+\.m3u8[^"']*/);if(a){let r=a[1]||a[0];return r.includes("base64")&&(r=I(r.split(",")[1]||r)),{url:r}}}catch(e){}return{url:t}})}function rt(t){return f(this,null,function*(){try{let e=yield d(t);if(!e)return{url:t};let s=yield e.text();s.includes("p,a,c,k,e,d")&&(s=U(s));let n=s.match(/robotlink['"]\)\.innerHTML\s*=\s*['"]([^'"]+)['"]\s*\+\s*([^;]+)/);if(n){let a="https:"+n[1],r=n[2].split("+");for(let c of r){let u=c.match(/['"]([^'"]+)['"]/);if(u){let o=u[1],i=c.match(/substring\((\d+)\)/);i&&(o=o.substring(parseInt(i[1]))),a+=o}}return{url:a,headers:{Referer:"https://streamtape.com/"}}}}catch(e){}return{url:t}})}function at(t){return f(this,null,function*(){try{let e=yield d(t);if(!e)return{url:t};let s=yield e.text(),n=s.match(/video_source\s*:\s*["']([^"']+\.mp4[^"']*)["']/)||s.match(/source\s+src=["']([^"']+\.mp4[^"']*)["']/);if(n)return{url:n[1]}}catch(e){}return{url:t}})}function it(t){return f(this,null,function*(){try{let e=yield d(t);if(!e)return{url:t};let s=yield e.text();s.includes("p,a,c,k,e,d")&&(s=U(s));let n=s.match(/sources\s*:\s*\[["']([^"']+\.(?:m3u8|mp4)[^"']*)["']\]/)||s.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/);if(n){let a=n[1];return a.includes("base64")&&(a=I(a.split(",")[1]||a)),{url:a}}}catch(e){}return{url:t}})}function ot(t){return f(this,null,function*(){try{let e=yield d(t);if(!e)return{url:t};let n=(yield e.text()).match(/["'](https?:\/\/[^"']+\.m3u8[^"']*)["']/);if(n)return{url:n[1]}}catch(e){}return{url:t}})}function ct(t){return f(this,null,function*(){var e;try{let s=((e=t.match(/https?:\/\/([^\/]+)/))==null?void 0:e[1])||"dood.to",n=yield d(t);if(!n)return{url:t};let a=yield n.text();a.includes("eval(function(p,a,c,k,e,d)")&&(a=U(a));let r=a.match(/\$\.get\(['"]\/pass_md5\/([^'"]+)['"]/);if(r){let c=r[1],u=`https://${s}/pass_md5/${c}`,o=yield fetch(u,{headers:{Referer:t}});if(o.ok){let i=yield o.text(),l=Math.random().toString(36).substring(2,12);return{url:i+l+"?token="+c+"&expiry="+Date.now()}}}}catch(s){}return{url:t}})}function lt(t){return f(this,null,function*(){try{let e=yield d(t);if(!e)return{url:t};let n=(yield e.text()).match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8)[^"']*)["']/);if(n)return{url:n[1]}}catch(e){}return{url:t}})}function R(t,e=0){return f(this,null,function*(){var a;if(e>3)return p(h({},t),{isDirect:!1});let s=t.url,n=s.toLowerCase();if(!s||s.includes("google-analytics")||s.includes("doubleclick"))return null;if(n.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/)&&!n.includes("html"))return p(h({},t),{isDirect:!0});try{let r=null;if(n.includes("sibnet.ru")?r=yield tt(s):n.includes("vidmoly.")?r=yield et(s):n.includes("uqload.")||n.includes("oneupload.")?r=yield st(s):n.includes("voe.")?r=yield nt(s):n.includes("streamtape.com")||n.includes("stape")?r=yield rt(s):n.includes("dood")||n.includes("ds2play")?r=yield ct(s):n.includes("moonplayer")||n.includes("moon.")?r=yield lt(s):n.includes("sendvid.")?r=yield at(s):n.includes("luluvid.")||n.includes("lulu.")?r=yield it(s):(n.includes("hgcloud.")||n.includes("savefiles."))&&(r=yield ot(s)),!r||r.url===s){let c=yield d(s,{headers:t.headers});if(c){let u=yield c.text();u.includes("p,a,c,k,e,d")&&(u=U(u));let o=u.match(/https?:\/\/[^"']+\.m3u8[^"']*/)||u.match(/https?:\/\/[^"']+\.mp4[^"']*/)||u.match(/file\s*:\s*["']([^"']+)["']/);if(o){let i=o[1]||o[0];i.startsWith("//")&&(i="https:"+i),i.startsWith("http")&&!i.includes(ut)&&(r={url:i})}if(!r){let i=u.match(/<iframe\s+[^>]*src=["']([^"']+)["']/i);if(i){let l=i[1];if(l.startsWith("//")&&(l="https:"+l),l.startsWith("/")){let m=(a=s.match(/^https?:\/\/[^\/]+/))==null?void 0:a[0];m&&(l=m+l)}if(l.startsWith("http")&&l!==s)return console.log(`[Resolver] Peeling: Found nested iframe -> ${l}`),yield R(p(h({},t),{url:l}),e+1)}}}}if(r&&r.url!==s&&r.url.startsWith("http")){let c=yield R(p(h({},t),{url:r.url,headers:h(h({},t.headers),r.headers||{})}),e+1);return p(h({},c),{isDirect:!0,originalUrl:s})}}catch(r){}return p(h({},t),{isDirect:!1})})}var ut="googletagmanager";var ft="https://arm.haglund.dev/api/v2";var mt="https://v3-cinemeta.strem.io";function q(s){return f(this,arguments,function*(t,e={}){try{let n=new AbortController,a=setTimeout(()=>n.abort(),8e3),r=yield fetch(t,p(h({},e),{signal:n.signal}));return clearTimeout(a),r}catch(n){return console.error(`[ArmSync] Fetch failed: ${t}`,n.message),null}})}function P(t,e){return f(this,null,function*(){if(!t)return null;let s=yield q(`${ft}/themoviedb?id=${t}`);if(s)try{let r=yield s.json(),c=Array.isArray(r)?r[0]:r;if(c&&c.imdb)return c.imdb}catch(r){}let n=`https://www.themoviedb.org/${e==="movie"?"movie":"tv"}/${t}`,a=yield q(n);if(a){let c=(yield a.text()).match(/imdb\.com\/title\/(tt\d+)/);if(c)return c[1]}return null})}function _(t,e,s){return f(this,null,function*(){var i;if(!t||e===0)return null;let n=yield q(`${mt}/meta/series/${t}.json`);if(!n)return null;let a=yield n.json();if(!((i=a==null?void 0:a.meta)!=null&&i.videos))return null;let r=a.meta.videos.filter(l=>l.season>0&&l.episode>0).sort((l,m)=>l.season-m.season||l.episode-m.episode),c=[],u=new Set;for(let l of r){let m=`${l.season}-${l.episode}`;u.has(m)||(u.add(m),c.push(l))}let o=c.findIndex(l=>l.season==e&&l.episode==s);if(o!==-1){let l=o+1;return console.log(`[ArmSync] Resolved: S${e}E${s} -> Absolute ${l}`),l}return null})}var w="https://anime-sama.tv";function ht(t,e){return f(this,null,function*(){try{let s=`https://www.themoviedb.org/${e==="movie"?"movie":"tv"}/${t}?language=en-US`,n=yield A(s),a=T.default.load(n),r=a('meta[property="og:title"]').attr("content")||a("h1").first().text();return r&&r.includes(" (")&&(r=r.split(" (")[0]),r&&r.includes(" - ")&&(r=r.split(" - ")[0]),r?r.trim():null}catch(s){return null}})}function dt(t){return f(this,null,function*(){try{let e=`${w}/?s=${encodeURIComponent(t)}`,s=yield A(e),n=T.default.load(s),a=[];return n('a[href*="/catalogue/"]').each((r,c)=>{let o=n(c).attr("href").match(/\/catalogue\/([^/]+)\/?/);o&&!a.includes(o[1])&&a.push(o[1])}),a}catch(e){return[]}})}function pt(t){return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function L(t,e){return e.includes("sibnet")?"Sibnet":e.includes("vidmoly")?"Vidmoly":e.includes("sendvid")?"Sendvid":e.includes("voe")?"Voe":e.includes("stape")||e.includes("streamtape")?"Streamtape":e.includes("dood")?"Doodstream":e.includes("uqload")||e.includes("oneupload")?"Uqload":"Player"}function H(t,e,s,n){return f(this,null,function*(){var i,l;let a=yield ht(t,e);if(!a)return[];let r=n;try{let m=yield P(t,e);if(m){let g=yield _(m,s,n);g&&(r=g)}}catch(m){}let c=pt(a),u=["vostfr","vf"],o=[];for(let m of u){let g=[`${w}/catalogue/${c}/saison${s}/${m}/episodes.js`,`${w}/catalogue/${c}/${m}/episodes.js`];s>1&&r&&g.push(`${w}/catalogue/${c}/saison1/${m}/episodes.js`);for(let y of g)try{let $=yield A(y),k=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),x;for(;(x=k.exec($))!==null;){let D=x[1],S=((i=x[2].match(/['"](.*?)['"]/g))==null?void 0:i.map(b=>b.slice(1,-1)))||[],v=y.includes(`saison${s}`)?S[n-1]:S[r-1]||S[n-1];if(v&&v.startsWith("http")){let b=yield R({name:`Anime-Sama (${m.toUpperCase()})`,title:`${L(D,v)} - Ep ${n}`,url:v,quality:"HD",headers:{Referer:w}});o.push(b)}}}catch($){}}if(o.length===0){let m=yield dt(a),g=new Set([c]);for(let y of m)if(!g.has(y)){g.add(y);for(let $ of u){let k=[`${w}/catalogue/${y}/saison${s}/${$}/episodes.js`,`${w}/catalogue/${y}/${$}/episodes.js`];s>1&&r&&k.push(`${w}/catalogue/${y}/saison1/${$}/episodes.js`);for(let x of k)try{let D=yield A(x),S=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),v;for(;(v=S.exec(D))!==null;){let b=v[1],j=((l=v[2].match(/['"](.*?)['"]/g))==null?void 0:l.map(C=>C.slice(1,-1)))||[],E=x.includes(`saison${s}`)?j[n-1]:j[r-1]||j[n-1];if(E&&E.startsWith("http")){let C=yield R({name:`Anime-Sama (${$.toUpperCase()})`,title:`${L(b,E)} - Ep ${n}`,url:E,quality:"HD",headers:{Referer:w}});C&&o.push(C)}}}catch(D){}}}}return o})}function wt(t,e,s,n){return f(this,null,function*(){try{return console.log(`[Anime-Sama] Request: ${e} ${t} S${s}E${n}`),yield H(t,e,s,n)}catch(a){return console.error(`[Anime-Sama] Error: ${a.message}`),[]}})}module.exports={getStreams:wt};
