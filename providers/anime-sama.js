/**
 * anime-sama - Built from src/anime-sama/
 * Generated: 2026-02-25T11:06:32.861Z
 */
var K=Object.create;var T=Object.defineProperty,B=Object.defineProperties,G=Object.getOwnPropertyDescriptor,O=Object.getOwnPropertyDescriptors,Q=Object.getOwnPropertyNames,W=Object.getOwnPropertySymbols,X=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var N=(e,t,s)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,u=(e,t)=>{for(var s in t||(t={}))L.call(t,s)&&N(e,s,t[s]);if(W)for(var s of W(t))Y.call(t,s)&&N(e,s,t[s]);return e},A=(e,t)=>B(e,O(t));var Z=(e,t,s,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Q(t))!L.call(e,r)&&r!==s&&T(e,r,{get:()=>t[r],enumerable:!(n=G(t,r))||n.enumerable});return e};var tt=(e,t,s)=>(s=e!=null?K(X(e)):{},Z(t||!e||!e.__esModule?T(s,"default",{value:e,enumerable:!0}):s,e));var o=(e,t,s)=>new Promise((n,r)=>{var a=i=>{try{l(s.next(i))}catch(d){r(d)}},c=i=>{try{l(s.throw(i))}catch(d){r(d)}},l=i=>i.done?n(i.value):Promise.resolve(i.value).then(a,c);l((s=s.apply(e,t)).next())});var et={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0","Sec-Ch-Ua":'"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1"};function R(s){return o(this,arguments,function*(e,t={}){console.log(`[Anime-Sama] Fetching: ${e}`);let n=yield fetch(e,u({headers:u(u({},et),t.headers)},t));if(!n.ok)throw new Error(`HTTP error ${n.status} for ${e}`);return yield n.text()})}var k=tt(require("cheerio"));var st={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7"};function g(s){return o(this,arguments,function*(e,t={}){try{let n=new AbortController,r=setTimeout(()=>n.abort(),12e3),a=yield fetch(e,A(u({},t),{headers:u(u({},st),t.headers),signal:n.signal}));return clearTimeout(r),a}catch(n){return console.error(`[Resolver] Fetch failed for ${e}: ${n.message}`),null}})}function nt(e){return o(this,null,function*(){let t=yield g(e,{headers:{Referer:"https://video.sibnet.ru/"}});if(!t)return e;let s=yield t.text(),n=s.match(/"url"\s*:\s*"([^"]+\.mp4)"/)||s.match(/src\s*:\s*"([^"]+\.mp4)"/)||s.match(/player\.setVideo\(\s*\{\s*"url"\s*:\s*"([^"]+)"/);if(n){let r=n[1];return r.startsWith("//")?r=`https:${r}`:r.startsWith("/")&&(r=`https://video.sibnet.ru${r}`),r}return e})}function q(e){return o(this,null,function*(){let t=yield g(e,{headers:{Referer:"https://vidmoly.to/"}});if(!t)return e;let s=yield t.text(),n=s.match(/file\s*:\s*"([^"]+\.m3u8)"/)||s.match(/file\s*:\s*"([^"]+\.mp4)"/)||s.match(/sources\s*:\s*\[\s*\{\s*file\s*:\s*"([^"]+)"/);return n?n[1]:e})}function rt(e){return o(this,null,function*(){let t=yield g(e,{headers:{Referer:"https://uqload.com/"}});if(!t)return e;let s=yield t.text(),n=s.match(/sources\s*:\s*\["([^"]+\.(?:mp4|m3u8))"\]/)||s.match(/src\s*:\s*"([^"]+\.(?:mp4|m3u8))"/)||s.match(/file\s*:\s*"([^"]+\.(?:mp4|m3u8))"/);return n?n[1]:e})}function at(e){return o(this,null,function*(){let t=yield g(e);if(!t)return e;let s=yield t.text(),n=s.match(/'hls'\s*:\s*'([^']+)'/)||s.match(/"hls"\s*:\s*"([^"]+)"/)||s.match(/window\.location\.href\s*=\s*'([^']+)'/);if(n){let r=n[1];if(r.includes("base64"))try{let a=r.split(",")[1]||r;typeof atob=="function"&&(r=atob(a))}catch(a){}return r}return e})}function ot(e){return o(this,null,function*(){let t=yield g(e);if(!t)return e;let s=yield t.text(),n=s.match(/sources\s*:\s*\[\s*\{\s*"file"\s*:\s*"([^"]+)"/i)||s.match(/file\s*:\s*"([^"]+)"/i)||s.match(/src\s*:\s*"([^"]+\.m3u8)"/i);return n?n[1]:e})}function it(e){return o(this,null,function*(){let t=yield g(e);if(!t)return e;let s=yield t.text(),n=s.match(/file\s*:\s*"([^"]+)"/i)||s.match(/source\s*:\s*"([^"]+)"/i)||s.match(/video\s+src="([^"]+)"/i);return n?n[1]:e})}function ct(e){return o(this,null,function*(){let t=yield g(e);if(!t)return e;let s=yield t.text(),n=s.match(/file\s*:\s*"([^"]+)"/i)||s.match(/src\s*:\s*"([^"]+\.(?:mp4|m3u8|mkv))"/i);return n?n[1]:e})}function lt(e){return o(this,null,function*(){let t=yield g(e);if(!t)return e;let s=yield t.text(),n=s.match(/robotlink\.innerHTML\s*=\s*'([^']+)'\s*\+\s*'([^']+)'/);if(n)return`https:${n[1]}${n[2].substring(3)}`;let r=s.match(/id="robotlink">([^<]+)/);return r?`https:${r[1]}`:e})}function mt(e){return o(this,null,function*(){let t=yield g(e);if(!t)return e;let s=yield t.text(),n=s.match(/source\s+src="([^"]+\.mp4)"/i)||s.match(/video_source\s*:\s*"([^"]+)"/);return n?n[1]:e})}function ut(e){return o(this,null,function*(){let t="https://dood.to",s=yield g(e,{headers:{Referer:t}});if(!s)return e;let n=yield s.text(),r=n.match(/\$.get\('\/pass_md5\/([^']+)'/);if(r){let c=`${t}/pass_md5/${r[1]}`,l=yield g(c,{headers:{Referer:e}});if(l)return`${yield l.text()}z72899?token=${r[1]}&expiry=${Date.now()}`}let a=n.match(/window\.open\('([^']+)'\)/);return a?a[1]:e})}function F(e){return o(this,null,function*(){let t=e.url,s=t.toLowerCase();if(s.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/))return A(u({},e),{isDirect:!0});try{let n=t,r=u({},e.headers);if(s.includes("sibnet.ru")?(n=yield nt(t),r.Referer="https://video.sibnet.ru/"):s.includes("vidmoly.")?(n=yield q(t),r.Referer="https://vidmoly.to/"):s.includes("uqload.")?(n=yield rt(t),r.Referer="https://uqload.com/"):s.includes("voe.sx")||s.includes("christopheruntilpoint")?n=yield at(t):s.includes("moonplayer")||s.includes("moonembed")?n=yield ot(t):s.includes("mytv")||s.includes("mycloud")||s.includes("mclls.net")?(n=yield it(t),r.Referer="https://mycloud.cc/"):s.includes("fhd")||s.includes("fhd1")?n=yield ct(t):s.includes("upstream.")?n=yield q(t):s.includes("vido.")||s.includes("vidlo.")?n=yield q(t):s.includes("streamtape.com")?n=yield lt(t):s.includes("sendvid.com")?n=yield mt(t):(s.includes("dood")||s.includes("ds2play")||s.includes("viddood"))&&(n=yield ut(t)),n!==t&&n.startsWith("http"))return console.log(`[Resolver] Success: ${t.substring(0,30)}... -> ${n.substring(0,30)}...`),A(u({},e),{url:n,isDirect:!0,headers:r,originalUrl:t})}catch(n){console.error(`[Resolver] Failed for ${t}:`,n)}return A(u({},e),{isDirect:!1})})}var H="https://arm.haglund.dev/api/v2",P="https://api.jikan.moe/v4",ft="https://v3-cinemeta.strem.io";function D(s){return o(this,arguments,function*(e,t={}){try{let n=new AbortController,r=setTimeout(()=>n.abort(),8e3),a=yield fetch(e,A(u({},t),{signal:n.signal}));return clearTimeout(r),a}catch(n){return console.error(`[ArmSync] Fetch failed: ${e}`,n.message),null}})}function I(e,t){return o(this,null,function*(){if(!e)return null;let s=yield D(`${H}/themoviedb?id=${e}`);if(s){let n=yield s.json(),r=Array.isArray(n)?n[0]:n;if(r&&r.imdb)return r.imdb}return null})}function _(e,t,s){return o(this,null,function*(){var l,i,d;if(!e)return null;let n=t===0||t===void 0?"movie":"series",r=yield D(`${ft}/meta/${n}/${e}.json`);if(!r)return null;let a=yield r.json();if(n==="movie")return((i=(l=a==null?void 0:a.meta)==null?void 0:l.released)==null?void 0:i.split("T")[0])||null;if(!((d=a==null?void 0:a.meta)!=null&&d.videos))return null;let c=a.meta.videos.find(f=>f.season==t&&f.episode==s);return c&&c.released?c.released.split("T")[0]:null})}function z(e,t){return o(this,null,function*(){var a,c,l,i;if(!e||!t)return null;let s=yield D(`${H}/imdb?id=${e}`);if(!s)return null;let n=yield s.json();if(!Array.isArray(n))return null;let r=new Date(t);for(let d of n){let f=d.myanimelist;if(!f)continue;let h=yield D(`${P}/anime/${f}`);if(!h)continue;let m=(a=yield h.json())==null?void 0:a.data;if(!m)continue;let p=(c=m.aired)!=null&&c.from?new Date(m.aired.from):null,v=(l=m.aired)!=null&&l.to?new Date(m.aired.to):null;if(p){let y=new Date(p);y.setDate(y.getDate()-2);let x=v?new Date(v):new Date;if(x.setDate(x.getDate()+2),r>=y&&r<=x){if(m.type==="Movie"||m.episodes===1)return{malId:f,absoluteEpisode:1,type:m.type};let b=yield D(`${P}/anime/${f}/episodes`);if(b){let S=(i=yield b.json())==null?void 0:i.data;if(Array.isArray(S)){let w=S.find($=>{if(!$.aired)return!1;let j=new Date($.aired);return Math.abs(r-j)/(1e3*60*60*24)<=2});if(w)return{malId:f,absoluteEpisode:w.mal_id,title:m.title,animeType:m.type}}}return{malId:f,absoluteEpisode:null,potentialMatch:!0}}}}return null})}var U="https://anime-sama.tv";function ht(e,t){return o(this,null,function*(){try{let s=`https://www.themoviedb.org/${t==="movie"?"movie":"tv"}/${e}?language=en-US`,n=yield R(s),r=k.default.load(n),a=r('meta[property="og:title"]').attr("content")||r("h1").first().text()||r("h2").first().text();return a&&a.includes(" (")&&(a=a.split(" (")[0]),a&&a.includes(" - ")&&(a=a.split(" - ")[0]),a=a?a.trim():null,console.log(`[Anime-Sama] TMDB Title found: ${a}`),a}catch(s){return console.error(`[Anime-Sama] Failed to get title from TMDB: ${s.message}`),null}})}function dt(e){return o(this,null,function*(){try{let t=`${U}/?s=${encodeURIComponent(e)}`,s=yield R(t),r=k.default.load(s)('a[href*="/catalogue/"]').first();if(r.length){let c=r.attr("href").match(/\/catalogue\/([^/]+)\/?/);if(c)return console.log(`[Anime-Sama] Search found slug: ${c[1]}`),c[1]}return null}catch(t){return console.error(`[Anime-Sama] Search Error: ${t.message}`),null}})}function pt(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function J(e,t){return t.includes("sibnet")?"Sibnet":t.includes("sendvid")?"Sendvid":t.includes("mycloud")?"MyCloud":t.includes("vidmoly")?"Vidmoly":t.includes("vido")?"Vido":`Player ${e.toUpperCase()}`}function V(e,t,s,n){return o(this,null,function*(){var d,f;let r=yield ht(e,t);if(!r)return[];let a=n;try{let h=yield I(e,t);if(h){let m=yield _(h,s,n);if(m){let p=yield z(h,m);p&&p.absoluteEpisode&&(console.log(`[Anime-Sama] ArmSync: Resolved S${s}E${n} -> Absolute Ep ${p.absoluteEpisode}`),a=p.absoluteEpisode)}}}catch(h){console.warn(`[Anime-Sama] ArmSync resolution failed, falling back to episode ${n}`)}let c=pt(r),l=["vostfr","vf"],i=[];for(let h of l){let m=`${U}/catalogue/${c}/saison${s}/${h}/episodes.js`;try{let p=yield R(m),v=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),y;for(;(y=v.exec(p))!==null;){let x=y[1],S=((d=y[2].match(/'(.*?)'/g))==null?void 0:d.map($=>$.slice(1,-1)))||[],w=S[n-1]||S[a-1];if(w&&w.startsWith("http")){let $=yield F({name:`Anime-Sama (${h.toUpperCase()})`,title:`${J(x,w)} - Ep ${n}`,url:w,quality:"HD",headers:{Referer:U}});i.push($)}}}catch(p){if(console.warn(`[Anime-Sama] episodes.js not found or error for ${h}: ${p.message}`),h===l[0]&&i.length===0){let v=yield dt(r);if(v&&v!==c){for(let y of l){let x=`${U}/catalogue/${v}/saison${s}/${y}/episodes.js`;try{let b=yield R(x),S=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),w;for(;(w=S.exec(b))!==null;){let $=w[1],E=((f=w[2].match(/'(.*?)'/g))==null?void 0:f.map(M=>M.slice(1,-1)))||[],C=E[n-1]||E[a-1];if(C&&C.startsWith("http")){let M=yield F({name:`Anime-Sama (${y.toUpperCase()})`,title:`${J($,C)} - Ep ${n}`,url:C,quality:"HD",headers:{Referer:U}});i.push(M)}}}catch(b){}}if(i.length>0)return i}}}}return i})}function wt(e,t,s,n){return o(this,null,function*(){try{return console.log(`[Anime-Sama] Request: ${t} ${e} S${s}E${n}`),yield V(e,t,s,n)}catch(r){return console.error(`[Anime-Sama] Error: ${r.message}`),[]}})}module.exports={getStreams:wt};
