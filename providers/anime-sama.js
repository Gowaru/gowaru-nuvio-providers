/**
 * anime-sama - Built from src/anime-sama/
 * Generated: 2026-02-25T17:10:18.070Z
 */
var P=Object.create;var D=Object.defineProperty,L=Object.defineProperties,_=Object.getOwnPropertyDescriptor,H=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertyNames,M=Object.getOwnPropertySymbols,K=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var j=(e,t,r)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,h=(e,t)=>{for(var r in t||(t={}))q.call(t,r)&&j(e,r,t[r]);if(M)for(var r of M(t))J.call(t,r)&&j(e,r,t[r]);return e},$=(e,t)=>L(e,H(t));var V=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of z(t))!q.call(e,s)&&s!==r&&D(e,s,{get:()=>t[s],enumerable:!(n=_(t,s))||n.enumerable});return e};var B=(e,t,r)=>(r=e!=null?P(K(e)):{},V(t||!e||!e.__esModule?D(r,"default",{value:e,enumerable:!0}):r,e));var l=(e,t,r)=>new Promise((n,s)=>{var a=i=>{try{m(r.next(i))}catch(c){s(c)}},o=i=>{try{m(r.throw(i))}catch(c){s(c)}},m=i=>i.done?n(i.value):Promise.resolve(i.value).then(a,o);m((r=r.apply(e,t)).next())});var G={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0","Sec-Ch-Ua":'"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1"};function b(r){return l(this,arguments,function*(e,t={}){console.log(`[Anime-Sama] Fetching: ${e}`);let n=yield fetch(e,h({headers:h(h({},G),t.headers)},t));if(!n.ok)throw new Error(`HTTP error ${n.status} for ${e}`);return yield n.text()})}var C=B(require("cheerio"));var O={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36"},Q=e=>{try{return typeof atob=="function"?atob(e):Buffer.from(e,"base64").toString("binary")}catch(t){return e}};function d(r){return l(this,arguments,function*(e,t={}){try{let n=yield fetch(e,$(h({},t),{headers:h(h({},O),t.headers),redirect:"follow"}));if(!n.ok)return null;let s=yield n.text();return{text:()=>Promise.resolve(s),ok:!0,url:n.url,headers:n.headers}}catch(n){return null}})}function T(e){try{if(!e.includes("p,a,c,k,e,d"))return e;let t=e.match(/}\s*\((.*)\)\s*$/);if(!t)return e;let r=t[1].match(/(".+"|\d+)/g);if(r.length<4)return e;let[n,s,a,o]=[r[0].replace(/^"|"$/g,""),parseInt(r[1]),parseInt(r[2]),r[3].replace(/^"|"$/g,"").split("|")],m=c=>(c<s?"":m(parseInt(c/s)))+((c=c%s)>35?String.fromCharCode(c+29):c.toString(36)),i={};for(;a--;)i[m(a)]=o[a]||m(a);return n.replace(/\b\w+\b/g,c=>i[c]||c)}catch(t){return e}}function X(e){return l(this,null,function*(){try{let t=yield d(e,{headers:{Referer:"https://video.sibnet.ru/"}});if(!t)return{url:e};let r=yield t.text(),n=r.match(/src\s*:\s*["']([^"']+\.mp4)["']/)||r.match(/"url"\s*:\s*"([^"]+\.mp4)"/);if(n){let s=n[1];return s.startsWith("//")&&(s="https:"+s),{url:s,headers:{Referer:"https://video.sibnet.ru/"}}}}catch(t){}return{url:e}})}function Y(e){return l(this,null,function*(){try{let t=yield d(e,{headers:{Referer:"https://vidmoly.to/"}});if(!t)return{url:e};let r=yield t.text();r.includes("eval(function(p,a,c,k,e,d)")&&(r=T(r));let n=r.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/);if(n)return{url:n[1],headers:{Referer:"https://vidmoly.to/"}}}catch(t){}return{url:e}})}function Z(e){return l(this,null,function*(){try{let t=yield d(e,{headers:{Referer:"https://uqload.com/"}});if(!t)return{url:e};let r=yield t.text(),n=r.match(/sources\s*:\s*\[["']([^"']+\.(?:mp4|m3u8))["']\]/)||r.match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/);if(n)return{url:n[1],headers:{Referer:"https://uqload.com/"}}}catch(t){}return{url:e}})}function tt(e){return l(this,null,function*(){try{let t=yield d(e);if(!t)return{url:e};let r=yield t.text(),n=r.match(/window\.location\.href\s*=\s*['"]([^'"]+)['"]/);if(n){let a=yield d(n[1]);a&&(r=yield a.text())}let s=r.match(/'hls'\s*:\s*'([^']+)'/)||r.match(/"hls"\s*:\s*"([^"]+)"/)||r.match(/https?:\/\/[^"']+\.m3u8[^"']*/);if(s){let a=s[1]||s[0];return a.includes("base64")&&(a=Q(a.split(",")[1]||a)),{url:a}}}catch(t){}return{url:e}})}function et(e){return l(this,null,function*(){try{let t=yield d(e);if(!t)return{url:e};let n=(yield t.text()).match(/robotlink['"]\)\.innerHTML\s*=\s*['"]([^'"]+)['"]\s*\+\s*([^;]+)/);if(n){let s="https:"+n[1],a=n[2].split("+");for(let o of a){let m=o.match(/['"]([^'"]+)['"]/);if(m){let i=m[1],c=o.match(/substring\((\d+)\)/);c&&(i=i.substring(parseInt(c[1]))),s+=i}}return{url:s}}}catch(t){}return{url:e}})}function rt(e){return l(this,null,function*(){var t;try{let r=((t=e.match(/https?:\/\/([^\/]+)/))==null?void 0:t[1])||"dood.to",n=yield d(e);if(!n)return{url:e};let s=yield n.text();s.includes("eval(function(p,a,c,k,e,d)")&&(s=T(s));let a=s.match(/\$\.get\(['"]\/pass_md5\/([^'"]+)['"]/);if(a){let o=a[1],m=`https://${r}/pass_md5/${o}`,i=yield fetch(m,{headers:{Referer:e}});if(i.ok){let c=yield i.text(),u=Math.random().toString(36).substring(2,12);return{url:c+u+"?token="+o+"&expiry="+Date.now()}}}}catch(r){}return{url:e}})}function nt(e){return l(this,null,function*(){try{let t=yield d(e);if(!t)return{url:e};let n=(yield t.text()).match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8)[^"']*)["']/);if(n)return{url:n[1]}}catch(t){}return{url:e}})}function k(e){return l(this,null,function*(){let t=e.url,r=t.toLowerCase();if(r.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/))return $(h({},e),{isDirect:!0});try{let n=null;if(r.includes("sibnet.ru"))n=yield X(t);else if(r.includes("vidmoly."))n=yield Y(t);else if(r.includes("uqload.")||r.includes("oneupload."))n=yield Z(t);else if(r.includes("voe."))n=yield tt(t);else if(r.includes("streamtape.com")||r.includes("stape"))n=yield et(t);else if(r.includes("dood")||r.includes("ds2play"))n=yield rt(t);else if(r.includes("moonplayer")||r.includes("moon."))n=yield nt(t);else{let s=yield d(t);if(s){let a=yield s.text(),o=a.match(/https?:\/\/[^"']+\.m3u8[^"']*/)||a.match(/https?:\/\/[^"']+\.mp4[^"']*/);o&&(n={url:o[0]})}}if(n&&n.url!==t&&n.url.startsWith("http"))return $(h({},e),{url:n.url,isDirect:!0,headers:h(h({},e.headers),n.headers||{}),originalUrl:t})}catch(n){}return $(h({},e),{isDirect:!1})})}var st="https://arm.haglund.dev/api/v2";var at="https://v3-cinemeta.strem.io";function E(r){return l(this,arguments,function*(e,t={}){try{let n=new AbortController,s=setTimeout(()=>n.abort(),8e3),a=yield fetch(e,$(h({},t),{signal:n.signal}));return clearTimeout(s),a}catch(n){return console.error(`[ArmSync] Fetch failed: ${e}`,n.message),null}})}function N(e,t){return l(this,null,function*(){if(!e)return null;let r=yield E(`${st}/themoviedb?id=${e}`);if(r)try{let a=yield r.json(),o=Array.isArray(a)?a[0]:a;if(o&&o.imdb)return o.imdb}catch(a){}let n=`https://www.themoviedb.org/${t==="movie"?"movie":"tv"}/${e}`,s=yield E(n);if(s){let o=(yield s.text()).match(/imdb\.com\/title\/(tt\d+)/);if(o)return o[1]}return null})}function F(e,t,r){return l(this,null,function*(){var c;if(!e||t===0)return null;let n=yield E(`${at}/meta/series/${e}.json`);if(!n)return null;let s=yield n.json();if(!((c=s==null?void 0:s.meta)!=null&&c.videos))return null;let a=s.meta.videos.filter(u=>u.season>0&&u.episode>0).sort((u,f)=>u.season-f.season||u.episode-f.episode),o=[],m=new Set;for(let u of a){let f=`${u.season}-${u.episode}`;m.has(f)||(m.add(f),o.push(u))}let i=o.findIndex(u=>u.season==t&&u.episode==r);if(i!==-1){let u=i+1;return console.log(`[ArmSync] Resolved: S${t}E${r} -> Absolute ${u}`),u}return null})}var v="https://anime-sama.tv";function ot(e,t){return l(this,null,function*(){try{let r=`https://www.themoviedb.org/${t==="movie"?"movie":"tv"}/${e}?language=en-US`,n=yield b(r),s=C.default.load(n),a=s('meta[property="og:title"]').attr("content")||s("h1").first().text();return a&&a.includes(" (")&&(a=a.split(" (")[0]),a&&a.includes(" - ")&&(a=a.split(" - ")[0]),a?a.trim():null}catch(r){return null}})}function it(e){return l(this,null,function*(){try{let t=`${v}/?s=${encodeURIComponent(e)}`,r=yield b(t),s=C.default.load(r)('a[href*="/catalogue/"]').first();if(s.length){let a=s.attr("href").match(/\/catalogue\/([^/]+)\/?/);if(a)return a[1]}return null}catch(t){return null}})}function ct(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function I(e,t){return t.includes("sibnet")?"Sibnet":t.includes("vidmoly")?"Vidmoly":t.includes("sendvid")?"Sendvid":t.includes("voe")?"Voe":t.includes("stape")||t.includes("streamtape")?"Streamtape":t.includes("dood")?"Doodstream":t.includes("uqload")||t.includes("oneupload")?"Uqload":"Player"}function W(e,t,r,n){return l(this,null,function*(){var c,u;let s=yield ot(e,t);if(!s)return[];let a=n;try{let f=yield N(e,t);if(f){let w=yield F(f,r,n);w&&(a=w)}}catch(f){}let o=ct(s),m=["vostfr","vf"],i=[];for(let f of m){let w=[`${v}/catalogue/${o}/saison${r}/${f}/episodes.js`,`${v}/catalogue/${o}/${f}/episodes.js`];r>1&&a&&w.push(`${v}/catalogue/${o}/saison1/${f}/episodes.js`);for(let A of w)try{let S=yield b(A),R=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),g;for(;(g=R.exec(S))!==null;){let U=g[1],x=((c=g[2].match(/['"](.*?)['"]/g))==null?void 0:c.map(y=>y.slice(1,-1)))||[],p=A.includes(`saison${r}`)?x[n-1]:x[a-1]||x[n-1];if(p&&p.startsWith("http")){let y=yield k({name:`Anime-Sama (${f.toUpperCase()})`,title:`${I(U,p)} - Ep ${n}`,url:p,quality:"HD",headers:{Referer:v}});i.push(y)}}}catch(S){}}if(i.length===0){let f=yield it(s);if(f&&f!==o)for(let w of m){let A=`${v}/catalogue/${f}/saison${r}/${w}/episodes.js`;try{let S=yield b(A),R=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),g;for(;(g=R.exec(S))!==null;){let U=g[1],x=((u=g[2].match(/['"](.*?)['"]/g))==null?void 0:u.map(y=>y.slice(1,-1)))||[],p=x[n-1]||x[a-1];if(p&&p.startsWith("http")){let y=yield k({name:`Anime-Sama (${w.toUpperCase()})`,title:`${I(U,p)} - Ep ${n}`,url:p,headers:{Referer:v}});i.push(y)}}}catch(S){}}}return i})}function lt(e,t,r,n){return l(this,null,function*(){try{return console.log(`[Anime-Sama] Request: ${t} ${e} S${r}E${n}`),yield W(e,t,r,n)}catch(s){return console.error(`[Anime-Sama] Error: ${s.message}`),[]}})}module.exports={getStreams:lt};
