/**
 * anime-sama - Built from src/anime-sama/
 * Generated: 2026-02-25T15:40:09.509Z
 */
var z=Object.create;var E=Object.defineProperty,_=Object.defineProperties,J=Object.getOwnPropertyDescriptor,V=Object.getOwnPropertyDescriptors,B=Object.getOwnPropertyNames,T=Object.getOwnPropertySymbols,K=Object.getPrototypeOf,W=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var j=(e,t,s)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,l=(e,t)=>{for(var s in t||(t={}))W.call(t,s)&&j(e,s,t[s]);if(T)for(var s of T(t))G.call(t,s)&&j(e,s,t[s]);return e},f=(e,t)=>_(e,V(t));var O=(e,t,s,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of B(t))!W.call(e,r)&&r!==s&&E(e,r,{get:()=>t[r],enumerable:!(n=J(t,r))||n.enumerable});return e};var Q=(e,t,s)=>(s=e!=null?z(K(e)):{},O(t||!e||!e.__esModule?E(s,"default",{value:e,enumerable:!0}):s,e));var c=(e,t,s)=>new Promise((n,r)=>{var a=o=>{try{m(s.next(o))}catch(u){r(u)}},i=o=>{try{m(s.throw(o))}catch(u){r(u)}},m=o=>o.done?n(o.value):Promise.resolve(o.value).then(a,i);m((s=s.apply(e,t)).next())});var X={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0","Sec-Ch-Ua":'"Chromium";v="122", "Not(A:Brand";v="24", "Google Chrome";v="122"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1"};function $(s){return c(this,arguments,function*(e,t={}){console.log(`[Anime-Sama] Fetching: ${e}`);let n=yield fetch(e,l({headers:l(l({},X),t.headers)},t));if(!n.ok)throw new Error(`HTTP error ${n.status} for ${e}`);return yield n.text()})}var M=Q(require("cheerio"));var F={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"};function h(s){return c(this,arguments,function*(e,t={}){try{let n=yield fetch(e,f(l({},t),{headers:l(l({},F),t.headers),redirect:"follow"}));if(!n.ok)return null;let r=yield n.text(),a=r.match(/window\.location\.(?:replace|href)\s*\(['"]([^'"]+)['"]\)/i);if(a){let i=a[1];i.startsWith("/")&&(i=e.match(/https?:\/\/[^\/]+/)[0]+i);let m=yield fetch(i,f(l({},t),{headers:l(f(l({},F),{Referer:e}),t.headers)}));if(m.ok){let o=yield m.text();return{text:()=>Promise.resolve(o),ok:!0,url:m.url}}}return{text:()=>Promise.resolve(r),ok:!0,url:n.url}}catch(n){return null}})}function Y(e){return c(this,null,function*(){let t=yield h(e,{headers:{Referer:"https://video.sibnet.ru/"}});if(!t)return e;let s=yield t.text(),n=s.match(/src\s*:\s*["']([^"']+\.mp4)["']/)||s.match(/"url"\s*:\s*"([^"]+\.mp4)"/)||s.match(/video_url\s*:\s*'([^']+)'/);if(n){let r=n[1];return r.startsWith("//")?r="https:"+r:r.startsWith("/")&&(r="https://video.sibnet.ru"+r),r}return e})}function Z(e){return c(this,null,function*(){let t=yield h(e,{headers:{Referer:"https://vidmoly.to/"}});if(!t)return e;let s=yield t.text(),n=s.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/)||s.match(/sources\s*:\s*\[\s*\{\s*file\s*:\s*["']([^"']+)["']/)||s.match(/["']?file["']?\s*:\s*["']([^"']+)["']/);return n?n[1]:e})}function tt(e){return c(this,null,function*(){let t=yield h(e,{headers:{Referer:"https://uqload.com/"}});if(!t)return e;let s=yield t.text(),n=s.match(/sources\s*:\s*\[["']([^"']+\.(?:mp4|m3u8))["']\]/)||s.match(/src\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/)||s.match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/);return n?n[1]:e})}function et(e){return c(this,null,function*(){let t=yield h(e);if(!t)return e;let s=yield t.text(),n=s.match(/'hls'\s*:\s*'([^']+)'/)||s.match(/"hls"\s*:\s*"([^"]+)"/);if(n){let a=n[1];if(a.includes("base64"))try{let i=a.split(",")[1]||a;a=atob(i)}catch(i){}return a}let r=s.match(/https?:\/\/[^"']+\.m3u8[^"']*/);return r?r[0]:e})}function st(e){return c(this,null,function*(){let t=yield h(e);if(!t)return e;let s=yield t.text(),n=s.match(/document\.getElementById\(['"]robotlink['"]\)\.innerHTML\s*=\s*['"]([^'"]+)['"]\s*\+\s*(?:['"]([^'"]+)['"]|(\w+))/);if(n){let a=n[1],i=n[2]||"";return"https:"+a+i}let r=s.match(/id=['"]robotlink['"]>([^<]+)/);return r?"https:"+r[1]:e})}function nt(e){return c(this,null,function*(){try{let t=e.match(/https?:\/\/([^\/]+)/)[1],s=yield h(e);if(!s)return e;let r=(yield s.text()).match(/\$\.get\(['"]\/pass_md5\/([^'"]+)['"]/);if(r){let a=`https://${t}/pass_md5/${r[1]}`,i=yield fetch(a,{headers:{Referer:e}});if(i.ok)return(yield i.text())+"z762vpz?token="+r[1]+"&expiry="+Date.now()}}catch(t){}return e})}function rt(e){return c(this,null,function*(){let t=yield h(e);if(!t)return e;let s=yield t.text(),n=s.match(/source\s*src=['"]([^'"]+\.mp4)['"]/)||s.match(/content=['"]([^'"]+\.mp4)['"]/);return n?n[1]:e})}function at(e){return c(this,null,function*(){let t=yield h(e);if(!t)return e;let s=yield t.text(),n=s.match(/vurl=["']([^"']+)["']/)||s.match(/file\s*:\s*["']([^"']+)["']/);if(n){let r=n[1];return r.startsWith("//")&&(r="https:"+r),r}return e})}function ot(e){return c(this,null,function*(){let t=yield h(e);if(!t)return e;let n=(yield t.text()).match(/sources\s*:\s*\[\s*{\s*file\s*:\s*["']([^"']+)["']/);return n?n[1]:e})}function C(e){return c(this,null,function*(){let t=e.url,s=t.toLowerCase();if(s.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/))return f(l({},e),{isDirect:!0});try{let n=t,r=l({},e.headers);if(s.includes("sibnet.ru")?(n=yield Y(t),r.Referer="https://video.sibnet.ru/"):s.includes("vidmoly.")?(n=yield Z(t),r.Referer="https://vidmoly.to/"):s.includes("uqload.")||s.includes("oneupload.")?(n=yield tt(t),r.Referer="https://uqload.com/"):s.includes("voe.")?n=yield et(t):s.includes("streamtape.com")||s.includes("stape")?n=yield st(t):s.includes("dood")||s.includes("ds2play")?n=yield nt(t):s.includes("sendvid.com")?n=yield rt(t):s.includes("myvi.")||s.includes("mytv")?n=yield at(t):(s.includes("moonplayer")||s.includes("moon."))&&(n=yield ot(t)),n!==t&&n.startsWith("http"))return f(l({},e),{url:n,isDirect:!0,headers:r})}catch(n){}return f(l({},e),{isDirect:!1})})}var it="https://arm.haglund.dev/api/v2";var ct="https://v3-cinemeta.strem.io";function N(s){return c(this,arguments,function*(e,t={}){try{let n=new AbortController,r=setTimeout(()=>n.abort(),8e3),a=yield fetch(e,f(l({},t),{signal:n.signal}));return clearTimeout(r),a}catch(n){return console.error(`[ArmSync] Fetch failed: ${e}`,n.message),null}})}function H(e,t){return c(this,null,function*(){if(!e)return null;let s=yield N(`${it}/themoviedb?id=${e}`);if(s){let n=yield s.json(),r=Array.isArray(n)?n[0]:n;if(r&&r.imdb)return r.imdb}return null})}function P(e,t,s){return c(this,null,function*(){var m;if(!e||t===0)return null;let n=yield N(`${ct}/meta/series/${e}.json`);if(!n)return null;let r=yield n.json();if(!((m=r==null?void 0:r.meta)!=null&&m.videos))return null;let i=r.meta.videos.filter(o=>o.season>0).sort((o,u)=>o.season-u.season||o.episode-u.episode).findIndex(o=>o.season==t&&o.episode==s);if(i!==-1){let o=i+1;return console.log(`[ArmSync] Resolved: S${t}E${s} -> Absolute ${o}`),o}return null})}var x="https://anime-sama.tv";function lt(e,t){return c(this,null,function*(){try{let s=`https://www.themoviedb.org/${t==="movie"?"movie":"tv"}/${e}?language=en-US`,n=yield $(s),r=M.default.load(n),a=r('meta[property="og:title"]').attr("content")||r("h1").first().text()||r("h2").first().text();return a&&a.includes(" (")&&(a=a.split(" (")[0]),a&&a.includes(" - ")&&(a=a.split(" - ")[0]),a=a?a.trim():null,console.log(`[Anime-Sama] TMDB Title found: ${a}`),a}catch(s){return console.error(`[Anime-Sama] Failed to get title from TMDB: ${s.message}`),null}})}function mt(e){return c(this,null,function*(){try{let t=`${x}/?s=${encodeURIComponent(e)}`,s=yield $(t),r=M.default.load(s)('a[href*="/catalogue/"]').first();if(r.length){let i=r.attr("href").match(/\/catalogue\/([^/]+)\/?/);if(i)return console.log(`[Anime-Sama] Search found slug: ${i[1]}`),i[1]}return null}catch(t){return console.error(`[Anime-Sama] Search Error: ${t.message}`),null}})}function ut(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function I(e,t){return t.includes("sibnet")?"Sibnet":t.includes("sendvid")?"Sendvid":t.includes("mycloud")?"MyCloud":t.includes("vidmoly")?"Vidmoly":t.includes("vido")?"Vido":t.includes("voe")?"Voe":t.includes("stape")||t.includes("streamtape")?"Streamtape":t.includes("dood")||t.includes("ds2play")?"Doodstream":t.includes("uqload")||t.includes("oneupload")?"Uqload":`Player ${e.toUpperCase()}`}function L(e,t,s,n){return c(this,null,function*(){var u,q;let r=yield lt(e,t);if(!r)return[];let a=n;try{let d=yield H(e,t);if(d){let y=yield P(d,s,n);y&&(console.log(`[Anime-Sama] ArmSync: Resolved S${s}E${n} -> Absolute Ep ${y}`),a=y)}}catch(d){console.warn(`[Anime-Sama] ArmSync resolution failed, falling back to episode ${n}`)}let i=ut(r),m=["vostfr","vf"],o=[];for(let d of m){let y=`${x}/catalogue/${i}/saison${s}/${d}/episodes.js`;try{let b=yield $(y),g=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),w;for(;(w=g.exec(b))!==null;){let R=w[1],S=((u=w[2].match(/'(.*?)'/g))==null?void 0:u.map(v=>v.slice(1,-1)))||[],p=S[n-1]||S[a-1];if(p&&p.startsWith("http")){let v=yield C({name:`Anime-Sama (${d.toUpperCase()})`,title:`${I(R,p)} - Ep ${n}`,url:p,quality:"HD",headers:{Referer:x}});o.push(v)}}}catch(b){if(console.warn(`[Anime-Sama] episodes.js not found or error for ${d}: ${b.message}`),d===m[0]&&o.length===0){let g=yield mt(r);if(g&&g!==i){for(let w of m){let R=`${x}/catalogue/${g}/saison${s}/${w}/episodes.js`;try{let U=yield $(R),S=new RegExp("var\\s+([a-z0-9]+)\\s*=\\s*\\[(.*?)\\s*\\]","gs"),p;for(;(p=S.exec(U))!==null;){let v=p[1],k=((q=p[2].match(/'(.*?)'/g))==null?void 0:q.map(D=>D.slice(1,-1)))||[],A=k[n-1]||k[a-1];if(A&&A.startsWith("http")){let D=yield C({name:`Anime-Sama (${w.toUpperCase()})`,title:`${I(v,A)} - Ep ${n}`,url:A,quality:"HD",headers:{Referer:x}});o.push(D)}}}catch(U){}}if(o.length>0)return o}}}}return o})}function ft(e,t,s,n){return c(this,null,function*(){try{return console.log(`[Anime-Sama] Request: ${t} ${e} S${s}E${n}`),yield L(e,t,s,n)}catch(r){return console.error(`[Anime-Sama] Error: ${r.message}`),[]}})}module.exports={getStreams:ft};
