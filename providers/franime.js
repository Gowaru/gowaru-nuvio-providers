/**
 * franime - Built from src/franime/
 * Generated: 2026-02-25T16:30:00.220Z
 */
var O=Object.create;var x=Object.defineProperty,P=Object.defineProperties,z=Object.getOwnPropertyDescriptor,J=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertyNames,R=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var S=(t,e,n)=>e in t?x(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,f=(t,e)=>{for(var n in e||(e={}))F.call(e,n)&&S(t,n,e[n]);if(R)for(var n of R(e))G.call(e,n)&&S(t,n,e[n]);return t},h=(t,e)=>P(t,J(e));var Q=(t,e)=>{for(var n in e)x(t,n,{get:e[n],enumerable:!0})},k=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of K(e))!F.call(t,s)&&s!==n&&x(t,s,{get:()=>e[s],enumerable:!(r=z(e,s))||r.enumerable});return t};var X=(t,e,n)=>(n=t!=null?O(V(t)):{},k(e||!t||!t.__esModule?x(n,"default",{value:t,enumerable:!0}):n,t)),Y=t=>k(x({},"__esModule",{value:!0}),t);var c=(t,e,n)=>new Promise((r,s)=>{var i=a=>{try{l(n.next(a))}catch(u){s(u)}},o=a=>{try{l(n.throw(a))}catch(u){s(u)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(i,o);l((n=n.apply(t,e)).next())});var mt={};Q(mt,{getStreams:()=>ft});module.exports=Y(mt);var Z={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0",Connection:"keep-alive"};function v(n){return c(this,arguments,function*(t,e={}){console.log(`[FRAnime] Fetching: ${t}`);let r=yield fetch(t,f({headers:f(f({},Z),e.headers)},e));if(!r.ok)throw new Error(`HTTP error ${r.status} for ${t}`);return yield r.text()})}function D(n){return c(this,arguments,function*(t,e={}){let r=yield v(t,e);try{return JSON.parse(r)}catch(s){throw console.error(`[FRAnime] Failed to parse JSON from ${t}`),s}})}var N=X(require("cheerio"));var tt={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36"},et=t=>{try{return typeof atob=="function"?atob(t):Buffer.from(t,"base64").toString("binary")}catch(e){return t}};function y(n){return c(this,arguments,function*(t,e={}){try{let r=yield fetch(t,h(f({},e),{headers:f(f({},tt),e.headers)}));if(!r.ok)return null;let s=yield r.text(),i=r.headers.get("set-cookie")||"";return{text:()=>Promise.resolve(s),ok:!0,url:r.url,headers:{"set-cookie":i}}}catch(r){return null}})}function E(t){try{if(!t.includes("p,a,c,k,e,d"))return t;let e=t.match(/}\s*\((.*)\)\s*$/);if(!e)return t;let n=e[1].match(/(".+"|\d+)/g);if(n.length<4)return t;let[r,s,i,o]=[n[0].replace(/^"|"$/g,""),parseInt(n[1]),parseInt(n[2]),n[3].replace(/^"|"$/g,"").split("|")],l=u=>(u<s?"":l(parseInt(u/s)))+((u=u%s)>35?String.fromCharCode(u+29):u.toString(36)),a={};for(;i--;)a[l(i)]=o[i]||l(i);return r.replace(/\b\w+\b/g,u=>a[u]||u)}catch(e){return t}}function nt(t){return c(this,null,function*(){try{let e=yield y(t,{headers:{Referer:"https://video.sibnet.ru/"}});if(!e)return{url:t};let n=yield e.text(),r=n.match(/src\s*:\s*["']([^"']+\.mp4)["']/)||n.match(/"url"\s*:\s*"([^"]+\.mp4)"/);if(r){let s=r[1];return s.startsWith("//")&&(s="https:"+s),{url:s,headers:{Referer:"https://video.sibnet.ru/"}}}}catch(e){}return{url:t}})}function rt(t){return c(this,null,function*(){try{let e=yield y(t,{headers:{Referer:"https://vidmoly.to/"}});if(!e)return{url:t};let n=yield e.text();n.includes("eval(function(p,a,c,k,e,d)")&&(n=E(n));let r=n.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/);if(r)return{url:r[1],headers:{Referer:"https://vidmoly.to/"}}}catch(e){}return{url:t}})}function T(t){return c(this,null,function*(){try{let e=yield y(t);if(!e)return{url:t};let n=yield e.text(),r=n.match(/window\.location\.href\s*=\s*['"]([^'"]+)['"]/);if(r)return T(r[1]);let s=n.match(/'hls'\s*:\s*'([^']+)'/)||n.match(/file\s*:\s*['"]([^'"]+\.m3u8[^'"]*)['"]/);if(s){let i=s[1];return i.includes("base64")&&(i=et(i.split(",")[1]||i)),{url:i}}}catch(e){}return{url:t}})}function st(t){return c(this,null,function*(){try{let e=yield y(t);if(!e)return{url:t};let n=yield e.text(),r=n.match(/document\.getElementById\(['"]robotlink['"]\)\.innerHTML\s*=\s*['"]([^'"]+)['"]\s*\+\s*(?:['"]([^'"]+)['"]|['"]([^'"]+)['"]\.substring\(\d+\))/);if(r){let s=r[1],i=r[2]||"";if(r[3]){let o=n.match(/substring\((\d+)\)/);i=r[3].substring(o?parseInt(o[1]):0)}return{url:"https:"+s+i}}}catch(e){}return{url:t}})}function it(t){return c(this,null,function*(){var e;try{let n=(e=t.match(/https?:\/\/([^\/]+)/))==null?void 0:e[1],r=yield y(t);if(!r||!n)return{url:t};let s=yield r.text();s.includes("eval(function(p,a,c,k,e,d)")&&(s=E(s));let i=s.match(/\$\.get\(['"]\/pass_md5\/([^'"]+)['"]/);if(i){let o=i[1],l=yield fetch(`https://${n}/pass_md5/${o}`,{headers:{Referer:t}});if(l.ok)return{url:(yield l.text())+"z762vpz?token="+o+"&expiry="+Date.now()}}}catch(n){}return{url:t}})}function I(t){return c(this,null,function*(){let e=t.url,n=e.toLowerCase();if(n.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/))return h(f({},t),{isDirect:!0});try{let r={url:e};if(n.includes("sibnet.ru"))r=yield nt(e);else if(n.includes("vidmoly."))r=yield rt(e);else if(n.includes("voe."))r=yield T(e);else if(n.includes("streamtape.com")||n.includes("stape"))r=yield st(e);else if(n.includes("dood")||n.includes("ds2play"))r=yield it(e);else{let s=yield y(e);if(s){let i=yield s.text(),o=i.match(/https?:\/\/[^"']+\.m3u8[^"']*/)||i.match(/https?:\/\/[^"']+\.mp4[^"']*/);o&&(r={url:o[0]})}}if(r.url!==e&&r.url.startsWith("http"))return h(f({},t),{url:r.url,isDirect:!0,headers:f(f({},t.headers),r.headers||{}),originalUrl:e})}catch(r){}return h(f({},t),{isDirect:!1})})}var at="https://arm.haglund.dev/api/v2";var ot="https://v3-cinemeta.strem.io";function M(n){return c(this,arguments,function*(t,e={}){try{let r=new AbortController,s=setTimeout(()=>r.abort(),8e3),i=yield fetch(t,h(f({},e),{signal:r.signal}));return clearTimeout(s),i}catch(r){return console.error(`[ArmSync] Fetch failed: ${t}`,r.message),null}})}function C(t,e){return c(this,null,function*(){if(!t)return null;let n=yield M(`${at}/themoviedb?id=${t}`);if(n){let r=yield n.json(),s=Array.isArray(r)?r[0]:r;if(s&&s.imdb)return s.imdb}return null})}function L(t,e,n){return c(this,null,function*(){var l;if(!t||e===0)return null;let r=yield M(`${ot}/meta/series/${t}.json`);if(!r)return null;let s=yield r.json();if(!((l=s==null?void 0:s.meta)!=null&&l.videos))return null;let o=s.meta.videos.filter(a=>a.season>0).sort((a,u)=>a.season-u.season||a.episode-u.episode).findIndex(a=>a.season==e&&a.episode==n);if(o!==-1){let a=o+1;return console.log(`[ArmSync] Resolved: S${e}E${n} -> Absolute ${a}`),a}return null})}var U="https://api.franime.fr/api",b=null;function ct(t,e){return c(this,null,function*(){try{let n=`https://www.themoviedb.org/${e==="movie"?"movie":"tv"}/${t}?language=en-US`,r=yield v(n),s=N.default.load(r),i=s('meta[property="og:title"]').attr("content")||s("h1").first().text()||s("h2").first().text();return i&&i.includes(" (")&&(i=i.split(" (")[0]),i&&i.includes(" - ")&&(i=i.split(" - ")[0]),i=i?i.trim():null,console.log(`[FRAnime] TMDB Title found: ${i}`),i}catch(n){return console.error(`[FRAnime] Failed to get title from TMDB: ${n.message}`),null}})}function lt(){return c(this,null,function*(){if(b)return b;try{return console.log("[FRAnime] Loading full anime list..."),b=yield D(`${U}/animes/`),console.log(`[FRAnime] Loaded ${b.length} animes.`),b}catch(t){return console.error(`[FRAnime] Failed to load anime list: ${t.message}`),[]}})}function ut(t,e){let n=i=>i.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[':!.,?]/g,"").replace(/\bthe\s+/g,"").replace(/\s+/g," ").trim(),r=n(e),s=t.find(i=>n(i.title)===r||n(i.titleO||"")===r);return s||(s=t.find(i=>n(i.title).includes(r)||n(i.titleO||"").includes(r))),s}function j(t,e,n,r){return c(this,null,function*(){let s=yield ct(t,e);if(!s)return[];let i=yield lt(),o=ut(i,s);if(!o)return console.warn(`[FRAnime] No match found for "${s}" in anime list.`),[];let l=null;try{let m=yield C(t,e);m&&(l=yield L(m,n,r))}catch(m){console.warn(`[FRAnime] ArmSync failed: ${m.message}`)}let a=[],u=n-1,W=r-1,$=o.saisons[u],g=$?$.episodes[W]:null;if(!g&&l&&o.saisons){let m=0;for(let d=0;d<o.saisons.length;d++){let w=o.saisons[d];if(w.episodes){for(let p=0;p<w.episodes.length;p++)if(m++,m===l){$=w,g=w.episodes[p],console.log(`[FRAnime] ArmSync match: Found absolute episode ${l} at S${d+1}E${p+1}`);break}}if(g)break}}if(!g)return console.warn(`[FRAnime] Episode S${n}E${r} (or Abs ${l}) not found for ${o.title}`),[];let _=["vo","vf"];for(let m of _){let d=g.lang[m];if(!d||!d.lecteurs)continue;let w=m==="vo"?"VOSTFR":"VF";for(let p=0;p<d.lecteurs.length;p++){let q=d.lecteurs[p],B=`${U}/anime/${o.id}/${o.saisons.indexOf($)}/${$.episodes.indexOf(g)}/${m}/${p}`;try{let A=yield v(B,{headers:{Referer:"https://franime.fr/"}});if(A&&A.startsWith("http")){let H=yield I({name:`FRAnime (${w})`,title:`${q} Player`,url:A,quality:"HD",headers:{Referer:"https://franime.fr/"}});a.push(H)}}catch(A){console.error(`[FRAnime] Failed to fetch player ${p} for ${m}: ${A.message}`)}}}return a})}function ft(t,e,n,r){return c(this,null,function*(){console.log(`[FRAnime] Request: ${e} ${t} S${n}E${r}`);try{return yield j(t,e,n,r)}catch(s){return console.error("[FRAnime] Error:",s),[]}})}
