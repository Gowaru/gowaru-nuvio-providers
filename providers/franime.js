/**
 * franime - Built from src/franime/
 * Generated: 2026-02-25T15:40:09.548Z
 */
var P=Object.create;var v=Object.defineProperty,O=Object.defineProperties,z=Object.getOwnPropertyDescriptor,B=Object.getOwnPropertyDescriptors,J=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,K=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var F=(t,e,n)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,m=(t,e)=>{for(var n in e||(e={}))S.call(e,n)&&F(t,n,e[n]);if(b)for(var n of b(e))V.call(e,n)&&F(t,n,e[n]);return t},p=(t,e)=>O(t,B(e));var G=(t,e)=>{for(var n in e)v(t,n,{get:e[n],enumerable:!0})},D=(t,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of J(e))!S.call(t,r)&&r!==n&&v(t,r,{get:()=>e[r],enumerable:!(s=z(e,r))||s.enumerable});return t};var Q=(t,e,n)=>(n=t!=null?P(K(t)):{},D(e||!t||!t.__esModule?v(n,"default",{value:t,enumerable:!0}):n,t)),X=t=>D(v({},"__esModule",{value:!0}),t);var a=(t,e,n)=>new Promise((s,r)=>{var o=c=>{try{l(n.next(c))}catch(w){r(w)}},i=c=>{try{l(n.throw(c))}catch(w){r(w)}},l=c=>c.done?s(c.value):Promise.resolve(c.value).then(o,i);l((n=n.apply(t,e)).next())});var pt={};G(pt,{getStreams:()=>ht});module.exports=X(pt);var Y={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0",Connection:"keep-alive"};function R(n){return a(this,arguments,function*(t,e={}){console.log(`[FRAnime] Fetching: ${t}`);let s=yield fetch(t,m({headers:m(m({},Y),e.headers)},e));if(!s.ok)throw new Error(`HTTP error ${s.status} for ${t}`);return yield s.text()})}function E(n){return a(this,arguments,function*(t,e={}){let s=yield R(t,e);try{return JSON.parse(s)}catch(r){throw console.error(`[FRAnime] Failed to parse JSON from ${t}`),r}})}var L=Q(require("cheerio"));var k={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"};function d(n){return a(this,arguments,function*(t,e={}){try{let s=yield fetch(t,p(m({},e),{headers:m(m({},k),e.headers),redirect:"follow"}));if(!s.ok)return null;let r=yield s.text(),o=r.match(/window\.location\.(?:replace|href)\s*\(['"]([^'"]+)['"]\)/i);if(o){let i=o[1];i.startsWith("/")&&(i=t.match(/https?:\/\/[^\/]+/)[0]+i);let l=yield fetch(i,p(m({},e),{headers:m(p(m({},k),{Referer:t}),e.headers)}));if(l.ok){let c=yield l.text();return{text:()=>Promise.resolve(c),ok:!0,url:l.url}}}return{text:()=>Promise.resolve(r),ok:!0,url:s.url}}catch(s){return null}})}function Z(t){return a(this,null,function*(){let e=yield d(t,{headers:{Referer:"https://video.sibnet.ru/"}});if(!e)return t;let n=yield e.text(),s=n.match(/src\s*:\s*["']([^"']+\.mp4)["']/)||n.match(/"url"\s*:\s*"([^"]+\.mp4)"/)||n.match(/video_url\s*:\s*'([^']+)'/);if(s){let r=s[1];return r.startsWith("//")?r="https:"+r:r.startsWith("/")&&(r="https://video.sibnet.ru"+r),r}return t})}function tt(t){return a(this,null,function*(){let e=yield d(t,{headers:{Referer:"https://vidmoly.to/"}});if(!e)return t;let n=yield e.text(),s=n.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/)||n.match(/sources\s*:\s*\[\s*\{\s*file\s*:\s*["']([^"']+)["']/)||n.match(/["']?file["']?\s*:\s*["']([^"']+)["']/);return s?s[1]:t})}function et(t){return a(this,null,function*(){let e=yield d(t,{headers:{Referer:"https://uqload.com/"}});if(!e)return t;let n=yield e.text(),s=n.match(/sources\s*:\s*\[["']([^"']+\.(?:mp4|m3u8))["']\]/)||n.match(/src\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/)||n.match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/);return s?s[1]:t})}function nt(t){return a(this,null,function*(){let e=yield d(t);if(!e)return t;let n=yield e.text(),s=n.match(/'hls'\s*:\s*'([^']+)'/)||n.match(/"hls"\s*:\s*"([^"]+)"/);if(s){let o=s[1];if(o.includes("base64"))try{let i=o.split(",")[1]||o;o=atob(i)}catch(i){}return o}let r=n.match(/https?:\/\/[^"']+\.m3u8[^"']*/);return r?r[0]:t})}function st(t){return a(this,null,function*(){let e=yield d(t);if(!e)return t;let n=yield e.text(),s=n.match(/document\.getElementById\(['"]robotlink['"]\)\.innerHTML\s*=\s*['"]([^'"]+)['"]\s*\+\s*(?:['"]([^'"]+)['"]|(\w+))/);if(s){let o=s[1],i=s[2]||"";return"https:"+o+i}let r=n.match(/id=['"]robotlink['"]>([^<]+)/);return r?"https:"+r[1]:t})}function rt(t){return a(this,null,function*(){try{let e=t.match(/https?:\/\/([^\/]+)/)[1],n=yield d(t);if(!n)return t;let r=(yield n.text()).match(/\$\.get\(['"]\/pass_md5\/([^'"]+)['"]/);if(r){let o=`https://${e}/pass_md5/${r[1]}`,i=yield fetch(o,{headers:{Referer:t}});if(i.ok)return(yield i.text())+"z762vpz?token="+r[1]+"&expiry="+Date.now()}}catch(e){}return t})}function ot(t){return a(this,null,function*(){let e=yield d(t);if(!e)return t;let n=yield e.text(),s=n.match(/source\s*src=['"]([^'"]+\.mp4)['"]/)||n.match(/content=['"]([^'"]+\.mp4)['"]/);return s?s[1]:t})}function it(t){return a(this,null,function*(){let e=yield d(t);if(!e)return t;let n=yield e.text(),s=n.match(/vurl=["']([^"']+)["']/)||n.match(/file\s*:\s*["']([^"']+)["']/);if(s){let r=s[1];return r.startsWith("//")&&(r="https:"+r),r}return t})}function at(t){return a(this,null,function*(){let e=yield d(t);if(!e)return t;let s=(yield e.text()).match(/sources\s*:\s*\[\s*{\s*file\s*:\s*["']([^"']+)["']/);return s?s[1]:t})}function T(t){return a(this,null,function*(){let e=t.url,n=e.toLowerCase();if(n.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/))return p(m({},t),{isDirect:!0});try{let s=e,r=m({},t.headers);if(n.includes("sibnet.ru")?(s=yield Z(e),r.Referer="https://video.sibnet.ru/"):n.includes("vidmoly.")?(s=yield tt(e),r.Referer="https://vidmoly.to/"):n.includes("uqload.")||n.includes("oneupload.")?(s=yield et(e),r.Referer="https://uqload.com/"):n.includes("voe.")?s=yield nt(e):n.includes("streamtape.com")||n.includes("stape")?s=yield st(e):n.includes("dood")||n.includes("ds2play")?s=yield rt(e):n.includes("sendvid.com")?s=yield ot(e):n.includes("myvi.")||n.includes("mytv")?s=yield it(e):(n.includes("moonplayer")||n.includes("moon."))&&(s=yield at(e)),s!==e&&s.startsWith("http"))return p(m({},t),{url:s,isDirect:!0,headers:r})}catch(s){}return p(m({},t),{isDirect:!1})})}var ct="https://arm.haglund.dev/api/v2";var lt="https://v3-cinemeta.strem.io";function M(n){return a(this,arguments,function*(t,e={}){try{let s=new AbortController,r=setTimeout(()=>s.abort(),8e3),o=yield fetch(t,p(m({},e),{signal:s.signal}));return clearTimeout(r),o}catch(s){return console.error(`[ArmSync] Fetch failed: ${t}`,s.message),null}})}function q(t,e){return a(this,null,function*(){if(!t)return null;let n=yield M(`${ct}/themoviedb?id=${t}`);if(n){let s=yield n.json(),r=Array.isArray(s)?s[0]:s;if(r&&r.imdb)return r.imdb}return null})}function U(t,e,n){return a(this,null,function*(){var l;if(!t||e===0)return null;let s=yield M(`${lt}/meta/series/${t}.json`);if(!s)return null;let r=yield s.json();if(!((l=r==null?void 0:r.meta)!=null&&l.videos))return null;let i=r.meta.videos.filter(c=>c.season>0).sort((c,w)=>c.season-w.season||c.episode-w.episode).findIndex(c=>c.season==e&&c.episode==n);if(i!==-1){let c=i+1;return console.log(`[ArmSync] Resolved: S${e}E${n} -> Absolute ${c}`),c}return null})}var I="https://api.franime.fr/api",A=null;function mt(t,e){return a(this,null,function*(){try{let n=`https://www.themoviedb.org/${e==="movie"?"movie":"tv"}/${t}?language=en-US`,s=yield R(n),r=L.default.load(s),o=r('meta[property="og:title"]').attr("content")||r("h1").first().text()||r("h2").first().text();return o&&o.includes(" (")&&(o=o.split(" (")[0]),o&&o.includes(" - ")&&(o=o.split(" - ")[0]),o=o?o.trim():null,console.log(`[FRAnime] TMDB Title found: ${o}`),o}catch(n){return console.error(`[FRAnime] Failed to get title from TMDB: ${n.message}`),null}})}function ut(){return a(this,null,function*(){if(A)return A;try{return console.log("[FRAnime] Loading full anime list..."),A=yield E(`${I}/animes/`),console.log(`[FRAnime] Loaded ${A.length} animes.`),A}catch(t){return console.error(`[FRAnime] Failed to load anime list: ${t.message}`),[]}})}function ft(t,e){let n=o=>o.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[':!.,?]/g,"").replace(/\bthe\s+/g,"").replace(/\s+/g," ").trim(),s=n(e),r=t.find(o=>n(o.title)===s||n(o.titleO||"")===s);return r||(r=t.find(o=>n(o.title).includes(s)||n(o.titleO||"").includes(s))),r}function W(t,e,n,s){return a(this,null,function*(){let r=yield mt(t,e);if(!r)return[];let o=yield ut(),i=ft(o,r);if(!i)return console.warn(`[FRAnime] No match found for "${r}" in anime list.`),[];let l=null;try{let u=yield q(t,e);u&&(l=yield U(u,n,s))}catch(u){console.warn(`[FRAnime] ArmSync failed: ${u.message}`)}let c=[],w=n-1,j=s-1,x=i.saisons[w],g=x?x.episodes[j]:null;if(!g&&l&&i.saisons){let u=0;for(let h=0;h<i.saisons.length;h++){let y=i.saisons[h];if(y.episodes){for(let f=0;f<y.episodes.length;f++)if(u++,u===l){x=y,g=y.episodes[f],console.log(`[FRAnime] ArmSync match: Found absolute episode ${l} at S${h+1}E${f+1}`);break}}if(g)break}}if(!g)return console.warn(`[FRAnime] Episode S${n}E${s} (or Abs ${l}) not found for ${i.title}`),[];let N=["vo","vf"];for(let u of N){let h=g.lang[u];if(!h||!h.lecteurs)continue;let y=u==="vo"?"VOSTFR":"VF";for(let f=0;f<h.lecteurs.length;f++){let C=h.lecteurs[f],H=`${I}/anime/${i.id}/${i.saisons.indexOf(x)}/${x.episodes.indexOf(g)}/${u}/${f}`;try{let $=yield R(H,{headers:{Referer:"https://franime.fr/"}});if($&&$.startsWith("http")){let _=yield T({name:`FRAnime (${y})`,title:`${C} Player`,url:$,quality:"HD",headers:{Referer:"https://franime.fr/"}});c.push(_)}}catch($){console.error(`[FRAnime] Failed to fetch player ${f} for ${u}: ${$.message}`)}}}return c})}function ht(t,e,n,s){return a(this,null,function*(){console.log(`[FRAnime] Request: ${e} ${t} S${n}E${s}`);try{return yield W(t,e,n,s)}catch(r){return console.error("[FRAnime] Error:",r),[]}})}
