/**
 * franime - Built from src/franime/
 * Generated: 2026-02-25T17:10:18.123Z
 */
var _=Object.create;var A=Object.defineProperty,H=Object.defineProperties,O=Object.getOwnPropertyDescriptor,P=Object.getOwnPropertyDescriptors,B=Object.getOwnPropertyNames,S=Object.getOwnPropertySymbols,J=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var F=(t,e,n)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,f=(t,e)=>{for(var n in e||(e={}))k.call(e,n)&&F(t,n,e[n]);if(S)for(var n of S(e))K.call(e,n)&&F(t,n,e[n]);return t},y=(t,e)=>H(t,P(e));var z=(t,e)=>{for(var n in e)A(t,n,{get:e[n],enumerable:!0})},D=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of B(e))!k.call(t,s)&&s!==n&&A(t,s,{get:()=>e[s],enumerable:!(r=O(e,s))||r.enumerable});return t};var V=(t,e,n)=>(n=t!=null?_(J(t)):{},D(e||!t||!t.__esModule?A(n,"default",{value:t,enumerable:!0}):n,t)),G=t=>D(A({},"__esModule",{value:!0}),t);var u=(t,e,n)=>new Promise((r,s)=>{var a=l=>{try{m(n.next(l))}catch(o){s(o)}},i=l=>{try{m(n.throw(l))}catch(o){s(o)}},m=l=>l.done?r(l.value):Promise.resolve(l.value).then(a,i);m((n=n.apply(t,e)).next())});var ft={};z(ft,{getStreams:()=>mt});module.exports=G(ft);var Q={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0",Connection:"keep-alive"};function b(n){return u(this,arguments,function*(t,e={}){console.log(`[FRAnime] Fetching: ${t}`);let r=yield fetch(t,f({headers:f(f({},Q),e.headers)},e));if(!r.ok)throw new Error(`HTTP error ${r.status} for ${t}`);return yield r.text()})}function E(n){return u(this,arguments,function*(t,e={}){let r=yield b(t,e);try{return JSON.parse(r)}catch(s){throw console.error(`[FRAnime] Failed to parse JSON from ${t}`),s}})}var q=V(require("cheerio"));var X={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36"},Y=t=>{try{return typeof atob=="function"?atob(t):Buffer.from(t,"base64").toString("binary")}catch(e){return t}};function w(n){return u(this,arguments,function*(t,e={}){try{let r=yield fetch(t,y(f({},e),{headers:f(f({},X),e.headers),redirect:"follow"}));if(!r.ok)return null;let s=yield r.text();return{text:()=>Promise.resolve(s),ok:!0,url:r.url,headers:r.headers}}catch(r){return null}})}function M(t){try{if(!t.includes("p,a,c,k,e,d"))return t;let e=t.match(/}\s*\((.*)\)\s*$/);if(!e)return t;let n=e[1].match(/(".+"|\d+)/g);if(n.length<4)return t;let[r,s,a,i]=[n[0].replace(/^"|"$/g,""),parseInt(n[1]),parseInt(n[2]),n[3].replace(/^"|"$/g,"").split("|")],m=o=>(o<s?"":m(parseInt(o/s)))+((o=o%s)>35?String.fromCharCode(o+29):o.toString(36)),l={};for(;a--;)l[m(a)]=i[a]||m(a);return r.replace(/\b\w+\b/g,o=>l[o]||o)}catch(e){return t}}function Z(t){return u(this,null,function*(){try{let e=yield w(t,{headers:{Referer:"https://video.sibnet.ru/"}});if(!e)return{url:t};let n=yield e.text(),r=n.match(/src\s*:\s*["']([^"']+\.mp4)["']/)||n.match(/"url"\s*:\s*"([^"]+\.mp4)"/);if(r){let s=r[1];return s.startsWith("//")&&(s="https:"+s),{url:s,headers:{Referer:"https://video.sibnet.ru/"}}}}catch(e){}return{url:t}})}function tt(t){return u(this,null,function*(){try{let e=yield w(t,{headers:{Referer:"https://vidmoly.to/"}});if(!e)return{url:t};let n=yield e.text();n.includes("eval(function(p,a,c,k,e,d)")&&(n=M(n));let r=n.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/);if(r)return{url:r[1],headers:{Referer:"https://vidmoly.to/"}}}catch(e){}return{url:t}})}function et(t){return u(this,null,function*(){try{let e=yield w(t,{headers:{Referer:"https://uqload.com/"}});if(!e)return{url:t};let n=yield e.text(),r=n.match(/sources\s*:\s*\[["']([^"']+\.(?:mp4|m3u8))["']\]/)||n.match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/);if(r)return{url:r[1],headers:{Referer:"https://uqload.com/"}}}catch(e){}return{url:t}})}function nt(t){return u(this,null,function*(){try{let e=yield w(t);if(!e)return{url:t};let n=yield e.text(),r=n.match(/window\.location\.href\s*=\s*['"]([^'"]+)['"]/);if(r){let a=yield w(r[1]);a&&(n=yield a.text())}let s=n.match(/'hls'\s*:\s*'([^']+)'/)||n.match(/"hls"\s*:\s*"([^"]+)"/)||n.match(/https?:\/\/[^"']+\.m3u8[^"']*/);if(s){let a=s[1]||s[0];return a.includes("base64")&&(a=Y(a.split(",")[1]||a)),{url:a}}}catch(e){}return{url:t}})}function rt(t){return u(this,null,function*(){try{let e=yield w(t);if(!e)return{url:t};let r=(yield e.text()).match(/robotlink['"]\)\.innerHTML\s*=\s*['"]([^'"]+)['"]\s*\+\s*([^;]+)/);if(r){let s="https:"+r[1],a=r[2].split("+");for(let i of a){let m=i.match(/['"]([^'"]+)['"]/);if(m){let l=m[1],o=i.match(/substring\((\d+)\)/);o&&(l=l.substring(parseInt(o[1]))),s+=l}}return{url:s}}}catch(e){}return{url:t}})}function st(t){return u(this,null,function*(){var e;try{let n=((e=t.match(/https?:\/\/([^\/]+)/))==null?void 0:e[1])||"dood.to",r=yield w(t);if(!r)return{url:t};let s=yield r.text();s.includes("eval(function(p,a,c,k,e,d)")&&(s=M(s));let a=s.match(/\$\.get\(['"]\/pass_md5\/([^'"]+)['"]/);if(a){let i=a[1],m=`https://${n}/pass_md5/${i}`,l=yield fetch(m,{headers:{Referer:t}});if(l.ok){let o=yield l.text(),c=Math.random().toString(36).substring(2,12);return{url:o+c+"?token="+i+"&expiry="+Date.now()}}}}catch(n){}return{url:t}})}function at(t){return u(this,null,function*(){try{let e=yield w(t);if(!e)return{url:t};let r=(yield e.text()).match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8)[^"']*)["']/);if(r)return{url:r[1]}}catch(e){}return{url:t}})}function T(t){return u(this,null,function*(){let e=t.url,n=e.toLowerCase();if(n.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/))return y(f({},t),{isDirect:!0});try{let r=null;if(n.includes("sibnet.ru"))r=yield Z(e);else if(n.includes("vidmoly."))r=yield tt(e);else if(n.includes("uqload.")||n.includes("oneupload."))r=yield et(e);else if(n.includes("voe."))r=yield nt(e);else if(n.includes("streamtape.com")||n.includes("stape"))r=yield rt(e);else if(n.includes("dood")||n.includes("ds2play"))r=yield st(e);else if(n.includes("moonplayer")||n.includes("moon."))r=yield at(e);else{let s=yield w(e);if(s){let a=yield s.text(),i=a.match(/https?:\/\/[^"']+\.m3u8[^"']*/)||a.match(/https?:\/\/[^"']+\.mp4[^"']*/);i&&(r={url:i[0]})}}if(r&&r.url!==e&&r.url.startsWith("http"))return y(f({},t),{url:r.url,isDirect:!0,headers:f(f({},t.headers),r.headers||{}),originalUrl:e})}catch(r){}return y(f({},t),{isDirect:!1})})}var it="https://arm.haglund.dev/api/v2";var ot="https://v3-cinemeta.strem.io";function R(n){return u(this,arguments,function*(t,e={}){try{let r=new AbortController,s=setTimeout(()=>r.abort(),8e3),a=yield fetch(t,y(f({},e),{signal:r.signal}));return clearTimeout(s),a}catch(r){return console.error(`[ArmSync] Fetch failed: ${t}`,r.message),null}})}function U(t,e){return u(this,null,function*(){if(!t)return null;let n=yield R(`${it}/themoviedb?id=${t}`);if(n)try{let a=yield n.json(),i=Array.isArray(a)?a[0]:a;if(i&&i.imdb)return i.imdb}catch(a){}let r=`https://www.themoviedb.org/${e==="movie"?"movie":"tv"}/${t}`,s=yield R(r);if(s){let i=(yield s.text()).match(/imdb\.com\/title\/(tt\d+)/);if(i)return i[1]}return null})}function I(t,e,n){return u(this,null,function*(){var o;if(!t||e===0)return null;let r=yield R(`${ot}/meta/series/${t}.json`);if(!r)return null;let s=yield r.json();if(!((o=s==null?void 0:s.meta)!=null&&o.videos))return null;let a=s.meta.videos.filter(c=>c.season>0&&c.episode>0).sort((c,g)=>c.season-g.season||c.episode-g.episode),i=[],m=new Set;for(let c of a){let g=`${c.season}-${c.episode}`;m.has(g)||(m.add(g),i.push(c))}let l=i.findIndex(c=>c.season==e&&c.episode==n);if(l!==-1){let c=l+1;return console.log(`[ArmSync] Resolved: S${e}E${n} -> Absolute ${c}`),c}return null})}var L="https://api.franime.fr/api",v=null;function ct(t,e){return u(this,null,function*(){try{let n=`https://www.themoviedb.org/${e==="movie"?"movie":"tv"}/${t}?language=en-US`,r=yield b(n),s=q.default.load(r),a=s('meta[property="og:title"]').attr("content")||s("h1").first().text()||s("h2").first().text();return a&&a.includes(" (")&&(a=a.split(" (")[0]),a&&a.includes(" - ")&&(a=a.split(" - ")[0]),a=a?a.trim():null,console.log(`[FRAnime] TMDB Title found: ${a}`),a}catch(n){return console.error(`[FRAnime] Failed to get title from TMDB: ${n.message}`),null}})}function lt(){return u(this,null,function*(){if(v)return v;try{return console.log("[FRAnime] Loading full anime list..."),v=yield E(`${L}/animes/`),console.log(`[FRAnime] Loaded ${v.length} animes.`),v}catch(t){return console.error(`[FRAnime] Failed to load anime list: ${t.message}`),[]}})}function ut(t,e){let n=a=>a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[':!.,?]/g,"").replace(/\bthe\s+/g,"").replace(/\s+/g," ").trim(),r=n(e),s=t.find(a=>n(a.title)===r||n(a.titleO||"")===r);return s||(s=t.find(a=>n(a.title).includes(r)||n(a.titleO||"").includes(r))),s}function C(t,e,n,r){return u(this,null,function*(){let s=yield ct(t,e);if(!s)return[];let a=yield lt(),i=ut(a,s);if(!i)return console.warn(`[FRAnime] No match found for "${s}" in anime list.`),[];let m=null;try{let h=yield U(t,e);h&&(m=yield I(h,n,r))}catch(h){console.warn(`[FRAnime] ArmSync failed: ${h.message}`)}let l=[],o=null,c=null;if(m&&i.saisons){let h=0;for(let d=0;d<i.saisons.length;d++){let $=i.saisons[d];if($.episodes){for(let p=0;p<$.episodes.length;p++)if(h++,h===m){o=$,c=$.episodes[p],console.log(`[FRAnime] ArmSync: Matched Absolute ${m} at S${d+1}E${p+1}`);break}}if(c)break}}if(!c){let h=n-1,d=r-1;o=i.saisons[h],c=o?o.episodes[d]:null}if(!c)return console.warn(`[FRAnime] Episode S${n}E${r} not found for ${i.title}`),[];let g=["vo","vf"];for(let h of g){let d=c.lang[h];if(!d||!d.lecteurs)continue;let $=h==="vo"?"VOSTFR":"VF";for(let p=0;p<d.lecteurs.length;p++){let N=d.lecteurs[p],j=`${L}/anime/${i.id}/${i.saisons.indexOf(o)}/${o.episodes.indexOf(c)}/${h}/${p}`;try{let x=yield b(j,{headers:{Referer:"https://franime.fr/"}});if(x&&x.startsWith("http")){let W=yield T({name:`FRAnime (${$})`,title:`${N} Player`,url:x,quality:"HD",headers:{Referer:"https://franime.fr/"}});l.push(W)}}catch(x){console.error(`[FRAnime] Failed to fetch player ${p} for ${h}: ${x.message}`)}}}return l})}function mt(t,e,n,r){return u(this,null,function*(){console.log(`[FRAnime] Request: ${e} ${t} S${n}E${r}`);try{return yield C(t,e,n,r)}catch(s){return console.error("[FRAnime] Error:",s),[]}})}
