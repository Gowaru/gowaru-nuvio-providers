/**
 * franime - Built from src/franime/
 * Generated: 2026-02-25T16:19:28.023Z
 */
var z=Object.create;var A=Object.defineProperty,V=Object.defineProperties,J=Object.getOwnPropertyDescriptor,K=Object.getOwnPropertyDescriptors,G=Object.getOwnPropertyNames,C=Object.getOwnPropertySymbols,Q=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var F=(t,e,s)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,u=(t,e)=>{for(var s in e||(e={}))E.call(e,s)&&F(t,s,e[s]);if(C)for(var s of C(e))X.call(e,s)&&F(t,s,e[s]);return t},h=(t,e)=>V(t,K(e));var Y=(t,e)=>{for(var s in e)A(t,s,{get:e[s],enumerable:!0})},D=(t,e,s,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of G(e))!E.call(t,n)&&n!==s&&A(t,n,{get:()=>e[n],enumerable:!(r=J(e,n))||r.enumerable});return t};var Z=(t,e,s)=>(s=t!=null?z(Q(t)):{},D(e||!t||!t.__esModule?A(s,"default",{value:t,enumerable:!0}):s,t)),ee=t=>D(A({},"__esModule",{value:!0}),t);var m=(t,e,s)=>new Promise((r,n)=>{var o=i=>{try{a(s.next(i))}catch(c){n(c)}},l=i=>{try{a(s.throw(i))}catch(c){n(c)}},a=i=>i.done?r(i.value):Promise.resolve(i.value).then(o,l);a((s=s.apply(t,e)).next())});var ge={};Y(ge,{getStreams:()=>we});module.exports=ee(ge);var te={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0",Connection:"keep-alive"};function R(s){return m(this,arguments,function*(t,e={}){console.log(`[FRAnime] Fetching: ${t}`);let r=yield fetch(t,u({headers:u(u({},te),e.headers)},e));if(!r.ok)throw new Error(`HTTP error ${r.status} for ${t}`);return yield r.text()})}function M(s){return m(this,arguments,function*(t,e={}){let r=yield R(t,e);try{return JSON.parse(r)}catch(n){throw console.error(`[FRAnime] Failed to parse JSON from ${t}`),n}})}var N=Z(require("cheerio"));var T={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"};function y(s){return m(this,arguments,function*(t,e={}){try{let r=yield fetch(t,h(u({},e),{headers:u(u({},T),e.headers),redirect:"follow"}));if(!r.ok)return null;let n=yield r.text(),o={};r.headers&&r.headers.forEach((a,i)=>{o[i.toLowerCase()]=a});let l=n.match(/window\.location\.(?:replace|href)\s*\(['"]([^'"]+)['"]\)/i);if(l){let a=l[1];a.startsWith("/")&&(a=t.match(/https?:\/\/[^\/]+/)[0]+a);let i=o["set-cookie"]||"",c=yield fetch(a,h(u({},e),{headers:u(h(u({},T),{Referer:t,Cookie:i}),e.headers)}));if(c.ok){let v=yield c.text(),p={};return c.headers&&c.headers.forEach((w,S)=>p[S.toLowerCase()]=w),{text:()=>Promise.resolve(v),ok:!0,url:c.url,headers:u(u({},o),p)}}}return{text:()=>Promise.resolve(n),ok:!0,url:r.url,headers:o}}catch(r){return null}})}function d(t){if(!t)return"";let e=t["set-cookie"];return e?Array.isArray(e)?e.map(s=>s.split(";")[0]).join("; "):e.split(";")[0]:""}function I(t){try{if(!t.includes("p,a,c,k,e,d"))return t;let e=t.match(/}\s*\((.*)\)\s*$/);if(!e)return t;let s=e[1].match(/(".+"|\d+)/g);if(s.length<4)return t;let[r,n,o,l]=[s[0].replace(/^"|"$/g,""),parseInt(s[1]),parseInt(s[2]),s[3].replace(/^"|"$/g,"").split("|")],a=c=>(c<n?"":a(parseInt(c/n)))+((c=c%n)>35?String.fromCharCode(c+29):c.toString(36)),i={};for(;o--;)i[a(o)]=l[o]||a(o);return r.replace(/\b\w+\b/g,c=>i[c]||c)}catch(e){return t}}function se(s){return m(this,arguments,function*(t,e={}){try{let r=yield fetch(t,{method:"GET",headers:h(u({},e),{Range:"bytes=0-1"})});if(r.status===200||r.status===206){let n=r.headers.get("content-type")||"";return n.includes("video")||n.includes("mpegurl")||n.includes("application/octet-stream")}return!1}catch(r){return!1}})}function re(t){return m(this,null,function*(){try{let e=yield y(t,{headers:{Referer:"https://video.sibnet.ru/"}});if(!e)return{url:t};let s=yield e.text(),r=d(e.headers),n=s.match(/src\s*:\s*["']([^"']+\.mp4)["']/)||s.match(/"url"\s*:\s*"([^"]+\.mp4)"/)||s.match(/video_url\s*:\s*'([^']+)'/);if(n){let o=n[1];return o.startsWith("//")?o="https:"+o:o.startsWith("/")&&(o="https://video.sibnet.ru"+o),{url:o,headers:{Cookie:r}}}}catch(e){}return{url:t}})}function ne(t){return m(this,null,function*(){try{let e=yield y(t,{headers:{Referer:"https://vidmoly.to/"}});if(!e)return{url:t};let s=yield e.text(),r=d(e.headers);s.includes("eval(function(p,a,c,k,e,d)")&&(s=I(s));let n=s.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/)||s.match(/sources\s*:\s*\[\s*\{\s*file\s*:\s*["']([^"']+)["']/)||s.match(/["']?file["']?\s*:\s*["']([^"']+)["']/);if(n)return{url:n[1],headers:{Cookie:r}}}catch(e){}return{url:t}})}function oe(t){return m(this,null,function*(){try{let e=yield y(t,{headers:{Referer:"https://uqload.com/"}});if(!e)return{url:t};let s=yield e.text(),r=d(e.headers),n=s.match(/sources\s*:\s*\[["']([^"']+\.(?:mp4|m3u8))["']\]/)||s.match(/src\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/)||s.match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/)||s.match(/vurl\s*=\s*["']([^"']+)["']/);if(n)return{url:n[1],headers:{Cookie:r}}}catch(e){}return{url:t}})}function L(t){return m(this,null,function*(){try{let e=yield y(t);if(!e)return{url:t};let s=yield e.text(),r=d(e.headers),n=s.match(/window\.location\.href\s*=\s*['"]([^'"]+)['"]/);if(n)return L(n[1]);let o=s.match(/'hls'\s*:\s*'([^']+)'/)||s.match(/"hls"\s*:\s*"([^"]+)"/)||s.match(/file\s*:\s*['"]([^'"]+\.m3u8[^'"]*)['"]/);if(o){let a=o[1];if(a.includes("base64"))try{let i=a.split(",")[1]||a;a=atob(i)}catch(i){}return{url:a,headers:{Cookie:r}}}let l=s.match(/https?:\/\/[^"']+\.m3u8[^"']*/);if(l)return{url:l[0],headers:{Cookie:r}}}catch(e){}return{url:t}})}function ae(t){return m(this,null,function*(){try{let e=yield y(t);if(!e)return{url:t};let s=yield e.text(),r=d(e.headers),n=s.match(/document\.getElementById\(['"]robotlink['"]\)\.innerHTML\s*=\s*['"]([^'"]+)['"]\s*\+\s*(?:['"]([^'"]+)['"]|['"]([^'"]+)['"]\.substring\(\d+\))/);if(n){let a=n[1],i=n[2]||"";if(n[3]){let c=s.match(/substring\((\d+)\)/),v=c?parseInt(c[1]):0;i=n[3].substring(v)}return{url:"https:"+a+i,headers:{Cookie:r}}}let o=s.match(/id=['"]robotlink['"]>([^<]+)/);if(o)return{url:"https:"+o[1],headers:{Cookie:r}};let l=s.match(/get_video\?id=[^&'"]+/);if(l)return{url:"https://streamtape.com/"+l[0],headers:{Cookie:r}}}catch(e){}return{url:t}})}function ie(t){return m(this,null,function*(){try{let e=t.match(/https?:\/\/([^\/]+)/);if(!e)return{url:t};let s=e[1],r=yield y(t);if(!r)return{url:t};let n=yield r.text(),o=d(r.headers);n.includes("eval(function(p,a,c,k,e,d)")&&(n=I(n));let l=n.match(/\$\.get\(['"]\/pass_md5\/([^'"]+)['"]/);if(l){let a=l[1],i=`https://${s}/pass_md5/${a}`,c=yield fetch(i,{headers:{Referer:t,Cookie:o}});if(c.ok){let v=yield c.text(),p=d({"set-cookie":c.headers.get("set-cookie")}),w=[o,p].filter(Boolean).join("; ");return{url:v+"z762vpz?token="+a+"&expiry="+Date.now(),headers:{Cookie:w}}}}}catch(e){}return{url:t}})}function ce(t){return m(this,null,function*(){try{let e=yield y(t);if(!e)return{url:t};let s=yield e.text(),r=d(e.headers),n=s.match(/source\s*src=['"]([^'"]+\.mp4)['"]/)||s.match(/content=['"]([^'"]+\.mp4)['"]/)||s.match(/video_url\s*:\s*['"]([^'"]+)['"]/);if(n)return{url:n[1],headers:{Cookie:r}}}catch(e){}return{url:t}})}function le(t){return m(this,null,function*(){try{let e=yield y(t);if(!e)return{url:t};let s=yield e.text(),r=d(e.headers),n=s.match(/vurl=["']([^"']+)["']/)||s.match(/file\s*:\s*["']([^"']+)["']/)||s.match(/["']?url["']?\s*:\s*["']([^"']+)["']/);if(n){let o=n[1];return o.startsWith("//")&&(o="https:"+o),{url:o,headers:{Cookie:r}}}}catch(e){}return{url:t}})}function ue(t){return m(this,null,function*(){try{let e=yield y(t);if(!e)return{url:t};let s=yield e.text(),r=d(e.headers),n=s.match(/sources\s*:\s*\[\s*{\s*file\s*:\s*["']([^"']+)["']/)||s.match(/file\s*:\s*["']([^"']+\.mp4[^"']*)["']/);if(n)return{url:n[1],headers:{Cookie:r}}}catch(e){}return{url:t}})}function q(t){return m(this,null,function*(){let e=t.url,s=e.toLowerCase();if(s.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/))return h(u({},t),{isDirect:!0});try{let r={url:e,headers:u({},t.headers)};if(s.includes("sibnet.ru"))r=yield re(e),r.headers=h(u({},r.headers),{Referer:"https://video.sibnet.ru/"});else if(s.includes("vidmoly."))r=yield ne(e),r.headers=h(u({},r.headers),{Referer:"https://vidmoly.to/"});else if(s.includes("uqload.")||s.includes("oneupload."))r=yield oe(e),r.headers=h(u({},r.headers),{Referer:"https://uqload.com/"});else if(s.includes("voe."))r=yield L(e);else if(s.includes("streamtape.com")||s.includes("stape"))r=yield ae(e);else if(s.includes("dood")||s.includes("ds2play"))r=yield ie(e);else if(s.includes("sendvid.com"))r=yield ce(e);else if(s.includes("myvi.")||s.includes("mytv"))r=yield le(e);else if(s.includes("moonplayer")||s.includes("moon."))r=yield ue(e);else{let n=yield y(e);if(n){let o=yield n.text(),l=d(n.headers),a=o.match(/https?:\/\/[^"']+\.m3u8[^"']*/)||o.match(/https?:\/\/[^"']+\.mp4[^"']*/);a&&(r={url:a[0],headers:{Cookie:l}})}}if(r.url!==e&&r.url.startsWith("http"))return console.log("[Resolver] Successfully resolved: "+e.substring(0,30)+"..."),(yield se(r.url,u(u({},t.headers),r.headers)))?h(u({},t),{url:r.url,isDirect:!0,headers:u(u({},t.headers),r.headers),originalUrl:e}):(console.log("[Resolver] Stream validation failed for: "+r.url.substring(0,30)),h(u({},t),{isDirect:!1,error:"Link expired or invalid"}))}catch(r){console.error("[Resolver] Failed for "+e+":",r.message)}return h(u({},t),{isDirect:!1})})}var me="https://arm.haglund.dev/api/v2";var he="https://v3-cinemeta.strem.io";function U(s){return m(this,arguments,function*(t,e={}){try{let r=new AbortController,n=setTimeout(()=>r.abort(),8e3),o=yield fetch(t,h(u({},e),{signal:r.signal}));return clearTimeout(n),o}catch(r){return console.error(`[ArmSync] Fetch failed: ${t}`,r.message),null}})}function j(t,e){return m(this,null,function*(){if(!t)return null;let s=yield U(`${me}/themoviedb?id=${t}`);if(s){let r=yield s.json(),n=Array.isArray(r)?r[0]:r;if(n&&n.imdb)return n.imdb}return null})}function W(t,e,s){return m(this,null,function*(){var a;if(!t||e===0)return null;let r=yield U(`${he}/meta/series/${t}.json`);if(!r)return null;let n=yield r.json();if(!((a=n==null?void 0:n.meta)!=null&&a.videos))return null;let l=n.meta.videos.filter(i=>i.season>0).sort((i,c)=>i.season-c.season||i.episode-c.episode).findIndex(i=>i.season==e&&i.episode==s);if(l!==-1){let i=l+1;return console.log(`[ArmSync] Resolved: S${e}E${s} -> Absolute ${i}`),i}return null})}var _="https://api.franime.fr/api",b=null;function fe(t,e){return m(this,null,function*(){try{let s=`https://www.themoviedb.org/${e==="movie"?"movie":"tv"}/${t}?language=en-US`,r=yield R(s),n=N.default.load(r),o=n('meta[property="og:title"]').attr("content")||n("h1").first().text()||n("h2").first().text();return o&&o.includes(" (")&&(o=o.split(" (")[0]),o&&o.includes(" - ")&&(o=o.split(" - ")[0]),o=o?o.trim():null,console.log(`[FRAnime] TMDB Title found: ${o}`),o}catch(s){return console.error(`[FRAnime] Failed to get title from TMDB: ${s.message}`),null}})}function de(){return m(this,null,function*(){if(b)return b;try{return console.log("[FRAnime] Loading full anime list..."),b=yield M(`${_}/animes/`),console.log(`[FRAnime] Loaded ${b.length} animes.`),b}catch(t){return console.error(`[FRAnime] Failed to load anime list: ${t.message}`),[]}})}function pe(t,e){let s=o=>o.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[':!.,?]/g,"").replace(/\bthe\s+/g,"").replace(/\s+/g," ").trim(),r=s(e),n=t.find(o=>s(o.title)===r||s(o.titleO||"")===r);return n||(n=t.find(o=>s(o.title).includes(r)||s(o.titleO||"").includes(r))),n}function H(t,e,s,r){return m(this,null,function*(){let n=yield fe(t,e);if(!n)return[];let o=yield de(),l=pe(o,n);if(!l)return console.warn(`[FRAnime] No match found for "${n}" in anime list.`),[];let a=null;try{let f=yield j(t,e);f&&(a=yield W(f,s,r))}catch(f){console.warn(`[FRAnime] ArmSync failed: ${f.message}`)}let i=[],c=s-1,v=r-1,p=l.saisons[c],w=p?p.episodes[v]:null;if(!w&&a&&l.saisons){let f=0;for(let x=0;x<l.saisons.length;x++){let k=l.saisons[x];if(k.episodes){for(let g=0;g<k.episodes.length;g++)if(f++,f===a){p=k,w=k.episodes[g],console.log(`[FRAnime] ArmSync match: Found absolute episode ${a} at S${x+1}E${g+1}`);break}}if(w)break}}if(!w)return console.warn(`[FRAnime] Episode S${s}E${r} (or Abs ${a}) not found for ${l.title}`),[];let S=["vo","vf"];for(let f of S){let x=w.lang[f];if(!x||!x.lecteurs)continue;let k=f==="vo"?"VOSTFR":"VF";for(let g=0;g<x.lecteurs.length;g++){let P=x.lecteurs[g],B=`${_}/anime/${l.id}/${l.saisons.indexOf(p)}/${p.episodes.indexOf(w)}/${f}/${g}`;try{let $=yield R(B,{headers:{Referer:"https://franime.fr/"}});if($&&$.startsWith("http")){let O=yield q({name:`FRAnime (${k})`,title:`${P} Player`,url:$,quality:"HD",headers:{Referer:"https://franime.fr/"}});i.push(O)}}catch($){console.error(`[FRAnime] Failed to fetch player ${g} for ${f}: ${$.message}`)}}}return i})}function we(t,e,s,r){return m(this,null,function*(){console.log(`[FRAnime] Request: ${e} ${t} S${s}E${r}`);try{return yield H(t,e,s,r)}catch(n){return console.error("[FRAnime] Error:",n),[]}})}
