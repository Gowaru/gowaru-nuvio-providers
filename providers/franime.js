/**
 * franime - Built from src/franime/
 * Generated: 2026-02-25T11:06:32.938Z
 */
var z=Object.create;var A=Object.defineProperty,B=Object.defineProperties,J=Object.getOwnPropertyDescriptor,K=Object.getOwnPropertyDescriptors,G=Object.getOwnPropertyNames,q=Object.getOwnPropertySymbols,Q=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var k=(e,s,t)=>s in e?A(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,h=(e,s)=>{for(var t in s||(s={}))U.call(s,t)&&k(e,t,s[t]);if(q)for(var t of q(s))X.call(s,t)&&k(e,t,s[t]);return e},v=(e,s)=>B(e,K(s));var Y=(e,s)=>{for(var t in s)A(e,t,{get:s[t],enumerable:!0})},L=(e,s,t,n)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of G(s))!U.call(e,i)&&i!==t&&A(e,i,{get:()=>s[i],enumerable:!(n=J(s,i))||n.enumerable});return e};var Z=(e,s,t)=>(t=e!=null?z(Q(e)):{},L(s||!e||!e.__esModule?A(t,"default",{value:e,enumerable:!0}):t,e)),ee=e=>L(A({},"__esModule",{value:!0}),e);var a=(e,s,t)=>new Promise((n,i)=>{var r=l=>{try{c(t.next(l))}catch(y){i(y)}},o=l=>{try{c(t.throw(l))}catch(y){i(y)}},c=l=>l.done?n(l.value):Promise.resolve(l.value).then(r,o);c((t=t.apply(e,s)).next())});var ge={};Y(ge,{getStreams:()=>we});module.exports=ee(ge);var te={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0",Connection:"keep-alive"};function E(t){return a(this,arguments,function*(e,s={}){console.log(`[FRAnime] Fetching: ${e}`);let n=yield fetch(e,h({headers:h(h({},te),s.headers)},s));if(!n.ok)throw new Error(`HTTP error ${n.status} for ${e}`);return yield n.text()})}function C(t){return a(this,arguments,function*(e,s={}){let n=yield E(e,s);try{return JSON.parse(n)}catch(i){throw console.error(`[FRAnime] Failed to parse JSON from ${e}`),i}})}var P=Z(require("cheerio"));var se={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7"};function g(t){return a(this,arguments,function*(e,s={}){try{let n=new AbortController,i=setTimeout(()=>n.abort(),12e3),r=yield fetch(e,v(h({},s),{headers:h(h({},se),s.headers),signal:n.signal}));return clearTimeout(i),r}catch(n){return console.error(`[Resolver] Fetch failed for ${e}: ${n.message}`),null}})}function ne(e){return a(this,null,function*(){let s=yield g(e,{headers:{Referer:"https://video.sibnet.ru/"}});if(!s)return e;let t=yield s.text(),n=t.match(/"url"\s*:\s*"([^"]+\.mp4)"/)||t.match(/src\s*:\s*"([^"]+\.mp4)"/)||t.match(/player\.setVideo\(\s*\{\s*"url"\s*:\s*"([^"]+)"/);if(n){let i=n[1];return i.startsWith("//")?i=`https:${i}`:i.startsWith("/")&&(i=`https://video.sibnet.ru${i}`),i}return e})}function M(e){return a(this,null,function*(){let s=yield g(e,{headers:{Referer:"https://vidmoly.to/"}});if(!s)return e;let t=yield s.text(),n=t.match(/file\s*:\s*"([^"]+\.m3u8)"/)||t.match(/file\s*:\s*"([^"]+\.mp4)"/)||t.match(/sources\s*:\s*\[\s*\{\s*file\s*:\s*"([^"]+)"/);return n?n[1]:e})}function ie(e){return a(this,null,function*(){let s=yield g(e,{headers:{Referer:"https://uqload.com/"}});if(!s)return e;let t=yield s.text(),n=t.match(/sources\s*:\s*\["([^"]+\.(?:mp4|m3u8))"\]/)||t.match(/src\s*:\s*"([^"]+\.(?:mp4|m3u8))"/)||t.match(/file\s*:\s*"([^"]+\.(?:mp4|m3u8))"/);return n?n[1]:e})}function re(e){return a(this,null,function*(){let s=yield g(e);if(!s)return e;let t=yield s.text(),n=t.match(/'hls'\s*:\s*'([^']+)'/)||t.match(/"hls"\s*:\s*"([^"]+)"/)||t.match(/window\.location\.href\s*=\s*'([^']+)'/);if(n){let i=n[1];if(i.includes("base64"))try{let r=i.split(",")[1]||i;typeof atob=="function"&&(i=atob(r))}catch(r){}return i}return e})}function ae(e){return a(this,null,function*(){let s=yield g(e);if(!s)return e;let t=yield s.text(),n=t.match(/sources\s*:\s*\[\s*\{\s*"file"\s*:\s*"([^"]+)"/i)||t.match(/file\s*:\s*"([^"]+)"/i)||t.match(/src\s*:\s*"([^"]+\.m3u8)"/i);return n?n[1]:e})}function oe(e){return a(this,null,function*(){let s=yield g(e);if(!s)return e;let t=yield s.text(),n=t.match(/file\s*:\s*"([^"]+)"/i)||t.match(/source\s*:\s*"([^"]+)"/i)||t.match(/video\s+src="([^"]+)"/i);return n?n[1]:e})}function ce(e){return a(this,null,function*(){let s=yield g(e);if(!s)return e;let t=yield s.text(),n=t.match(/file\s*:\s*"([^"]+)"/i)||t.match(/src\s*:\s*"([^"]+\.(?:mp4|m3u8|mkv))"/i);return n?n[1]:e})}function le(e){return a(this,null,function*(){let s=yield g(e);if(!s)return e;let t=yield s.text(),n=t.match(/robotlink\.innerHTML\s*=\s*'([^']+)'\s*\+\s*'([^']+)'/);if(n)return`https:${n[1]}${n[2].substring(3)}`;let i=t.match(/id="robotlink">([^<]+)/);return i?`https:${i[1]}`:e})}function me(e){return a(this,null,function*(){let s=yield g(e);if(!s)return e;let t=yield s.text(),n=t.match(/source\s+src="([^"]+\.mp4)"/i)||t.match(/video_source\s*:\s*"([^"]+)"/);return n?n[1]:e})}function fe(e){return a(this,null,function*(){let s="https://dood.to",t=yield g(e,{headers:{Referer:s}});if(!t)return e;let n=yield t.text(),i=n.match(/\$.get\('\/pass_md5\/([^']+)'/);if(i){let o=`${s}/pass_md5/${i[1]}`,c=yield g(o,{headers:{Referer:e}});if(c)return`${yield c.text()}z72899?token=${i[1]}&expiry=${Date.now()}`}let r=n.match(/window\.open\('([^']+)'\)/);return r?r[1]:e})}function I(e){return a(this,null,function*(){let s=e.url,t=s.toLowerCase();if(t.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/))return v(h({},e),{isDirect:!0});try{let n=s,i=h({},e.headers);if(t.includes("sibnet.ru")?(n=yield ne(s),i.Referer="https://video.sibnet.ru/"):t.includes("vidmoly.")?(n=yield M(s),i.Referer="https://vidmoly.to/"):t.includes("uqload.")?(n=yield ie(s),i.Referer="https://uqload.com/"):t.includes("voe.sx")||t.includes("christopheruntilpoint")?n=yield re(s):t.includes("moonplayer")||t.includes("moonembed")?n=yield ae(s):t.includes("mytv")||t.includes("mycloud")||t.includes("mclls.net")?(n=yield oe(s),i.Referer="https://mycloud.cc/"):t.includes("fhd")||t.includes("fhd1")?n=yield ce(s):t.includes("upstream.")?n=yield M(s):t.includes("vido.")||t.includes("vidlo.")?n=yield M(s):t.includes("streamtape.com")?n=yield le(s):t.includes("sendvid.com")?n=yield me(s):(t.includes("dood")||t.includes("ds2play")||t.includes("viddood"))&&(n=yield fe(s)),n!==s&&n.startsWith("http"))return console.log(`[Resolver] Success: ${s.substring(0,30)}... -> ${n.substring(0,30)}...`),v(h({},e),{url:n,isDirect:!0,headers:i,originalUrl:s})}catch(n){console.error(`[Resolver] Failed for ${s}:`,n)}return v(h({},e),{isDirect:!1})})}var W="https://arm.haglund.dev/api/v2",N="https://api.jikan.moe/v4",ue="https://v3-cinemeta.strem.io";function b(t){return a(this,arguments,function*(e,s={}){try{let n=new AbortController,i=setTimeout(()=>n.abort(),8e3),r=yield fetch(e,v(h({},s),{signal:n.signal}));return clearTimeout(i),r}catch(n){return console.error(`[ArmSync] Fetch failed: ${e}`,n.message),null}})}function _(e,s){return a(this,null,function*(){if(!e)return null;let t=yield b(`${W}/themoviedb?id=${e}`);if(t){let n=yield t.json(),i=Array.isArray(n)?n[0]:n;if(i&&i.imdb)return i.imdb}return null})}function j(e,s,t){return a(this,null,function*(){var c,l,y;if(!e)return null;let n=s===0||s===void 0?"movie":"series",i=yield b(`${ue}/meta/${n}/${e}.json`);if(!i)return null;let r=yield i.json();if(n==="movie")return((l=(c=r==null?void 0:r.meta)==null?void 0:c.released)==null?void 0:l.split("T")[0])||null;if(!((y=r==null?void 0:r.meta)!=null&&y.videos))return null;let o=r.meta.videos.find(w=>w.season==s&&w.episode==t);return o&&o.released?o.released.split("T")[0]:null})}function H(e,s){return a(this,null,function*(){var r,o,c,l;if(!e||!s)return null;let t=yield b(`${W}/imdb?id=${e}`);if(!t)return null;let n=yield t.json();if(!Array.isArray(n))return null;let i=new Date(s);for(let y of n){let w=y.myanimelist;if(!w)continue;let $=yield b(`${N}/anime/${w}`);if(!$)continue;let m=(r=yield $.json())==null?void 0:r.data;if(!m)continue;let F=(o=m.aired)!=null&&o.from?new Date(m.aired.from):null,f=(c=m.aired)!=null&&c.to?new Date(m.aired.to):null;if(F){let u=new Date(F);u.setDate(u.getDate()-2);let d=f?new Date(f):new Date;if(d.setDate(d.getDate()+2),i>=u&&i<=d){if(m.type==="Movie"||m.episodes===1)return{malId:w,absoluteEpisode:1,type:m.type};let p=yield b(`${N}/anime/${w}/episodes`);if(p){let S=(l=yield p.json())==null?void 0:l.data;if(Array.isArray(S)){let D=S.find(x=>{if(!x.aired)return!1;let T=new Date(x.aired);return Math.abs(i-T)/(1e3*60*60*24)<=2});if(D)return{malId:w,absoluteEpisode:D.mal_id,title:m.title,animeType:m.type}}}return{malId:w,absoluteEpisode:null,potentialMatch:!0}}}}return null})}var O="https://api.franime.fr/api",R=null;function de(e,s){return a(this,null,function*(){try{let t=`https://www.themoviedb.org/${s==="movie"?"movie":"tv"}/${e}?language=en-US`,n=yield E(t),i=P.default.load(n),r=i('meta[property="og:title"]').attr("content")||i("h1").first().text()||i("h2").first().text();return r&&r.includes(" (")&&(r=r.split(" (")[0]),r&&r.includes(" - ")&&(r=r.split(" - ")[0]),r=r?r.trim():null,console.log(`[FRAnime] TMDB Title found: ${r}`),r}catch(t){return console.error(`[FRAnime] Failed to get title from TMDB: ${t.message}`),null}})}function he(){return a(this,null,function*(){if(R)return R;try{return console.log("[FRAnime] Loading full anime list..."),R=yield C(`${O}/animes/`),console.log(`[FRAnime] Loaded ${R.length} animes.`),R}catch(e){return console.error(`[FRAnime] Failed to load anime list: ${e.message}`),[]}})}function pe(e,s){let t=r=>r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[':!.,?]/g,"").replace(/\bthe\s+/g,"").replace(/\s+/g," ").trim(),n=t(s),i=e.find(r=>t(r.title)===n||t(r.titleO||"")===n);return i||(i=e.find(r=>t(r.title).includes(n)||t(r.titleO||"").includes(n))),i}function V(e,s,t,n){return a(this,null,function*(){let i=yield de(e,s);if(!i)return[];let r=yield he(),o=pe(r,i);if(!o)return console.warn(`[FRAnime] No match found for "${i}" in anime list.`),[];let c=null;try{let f=yield _(e,s);if(f){let u=yield j(f,t,n);if(u){let d=yield H(f,u);d&&d.absoluteEpisode&&(console.log(`[FRAnime] ArmSync: S${t}E${n} -> Absolute ${d.absoluteEpisode}`),c=d.absoluteEpisode)}}}catch(f){console.warn(`[FRAnime] ArmSync failed: ${f.message}`)}let l=[],y=t-1,w=n-1,$=o.saisons[y],m=$?$.episodes[w]:null;if(!m&&c&&o.saisons){let f=0;for(let u=0;u<o.saisons.length;u++){let d=o.saisons[u];if(d.episodes){for(let p=0;p<d.episodes.length;p++)if(f++,f===c){$=d,m=d.episodes[p],console.log(`[FRAnime] ArmSync match: Found absolute episode ${c} at S${u+1}E${p+1}`);break}}if(m)break}}if(!m)return console.warn(`[FRAnime] Episode S${t}E${n} (or Abs ${c}) not found for ${o.title}`),[];let F=["vo","vf"];for(let f of F){let u=m.lang[f];if(!u||!u.lecteurs)continue;let d=f==="vo"?"VOSTFR":"VF";for(let p=0;p<u.lecteurs.length;p++){let S=u.lecteurs[p],D=`${O}/anime/${o.id}/${o.saisons.indexOf($)}/${$.episodes.indexOf(m)}/${f}/${p}`;try{let x=yield E(D,{headers:{Referer:"https://franime.fr/"}});if(x&&x.startsWith("http")){let T=yield I({name:`FRAnime (${d})`,title:`${S} Player`,url:x,quality:"HD",headers:{Referer:"https://franime.fr/"}});l.push(T)}}catch(x){console.error(`[FRAnime] Failed to fetch player ${p} for ${f}: ${x.message}`)}}}return l})}function we(e,s,t,n){return a(this,null,function*(){console.log(`[FRAnime] Request: ${s} ${e} S${t}E${n}`);try{return yield V(e,s,t,n)}catch(i){return console.error("[FRAnime] Error:",i),[]}})}
