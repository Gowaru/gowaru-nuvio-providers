/**
 * animesultra - Built from src/animesultra/
 * Generated: 2026-02-27T23:53:39.846Z
 */
var Y=Object.create;var _=Object.defineProperty,Z=Object.defineProperties,Q=Object.getOwnPropertyDescriptor,tt=Object.getOwnPropertyDescriptors,et=Object.getOwnPropertyNames,W=Object.getOwnPropertySymbols,st=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty,rt=Object.prototype.propertyIsEnumerable;var H=(t,r,e)=>r in t?_(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,h=(t,r)=>{for(var e in r||(r={}))N.call(r,e)&&H(t,e,r[e]);if(W)for(var e of W(r))rt.call(r,e)&&H(t,e,r[e]);return t},x=(t,r)=>Z(t,tt(r));var nt=(t,r,e,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of et(r))!N.call(t,n)&&n!==e&&_(t,n,{get:()=>r[n],enumerable:!(s=Q(r,n))||s.enumerable});return t};var at=(t,r,e)=>(e=t!=null?Y(st(t)):{},nt(r||!t||!t.__esModule?_(e,"default",{value:t,enumerable:!0}):e,t));var f=(t,r,e)=>new Promise((s,n)=>{var a=c=>{try{l(e.next(c))}catch(u){n(u)}},o=c=>{try{l(e.throw(c))}catch(u){n(u)}},l=c=>c.done?s(c.value):Promise.resolve(c.value).then(a,o);l((e=e.apply(t,r)).next())});var it={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0",Connection:"keep-alive"};function P(e){return f(this,arguments,function*(t,r={}){console.log(`[AnimesUltra] Fetching: ${t}`);let s=yield fetch(t,h({headers:h(h({},it),r.headers)},r));if(!s.ok)throw new Error(`HTTP error ${s.status} for ${t}`);return yield s.text()})}var D=at(require("cheerio-without-node-native"));var ot={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/145.0.0.0 Safari/537.36"},z=t=>{try{return typeof atob=="function"?atob(t):Buffer.from(t,"base64").toString("binary")}catch(r){return t}};function y(e){return f(this,arguments,function*(t,r={}){let s,n;try{s=new AbortController,n=setTimeout(()=>s.abort(),1e4);let a=yield fetch(t,x(h({},r),{headers:h(h({},ot),r.headers),redirect:"follow",signal:s.signal}));if(clearTimeout(n),!a.ok)return null;let o=yield a.text();return{text:()=>Promise.resolve(o),ok:!0,url:a.url,headers:a.headers}}catch(a){return n&&clearTimeout(n),null}})}function S(t){try{if(!t.includes("p,a,c,k,e,d"))return t;let r=new RegExp("eval\\s*\\(\\s*function\\s*\\(\\s*p\\s*,\\s*a\\s*,\\s*c\\s*,\\s*k\\s*,\\s*e\\s*,\\s*d\\s*\\).*?\\}\\s*\\((.*?)\\)\\s*\\)","gs"),e=t,s;for(;(s=r.exec(t))!==null;)try{let a=s[1].match(new RegExp("^'(.*?)',\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*'(.*?)'\\.split\\('\\|'\\)","s"));if(!a)continue;let o=a[1].replace(/\\'/g,"'"),l=parseInt(a[2]),c=parseInt(a[3]),u=a[4].split("|"),i=d=>(d<l?"":i(parseInt(d/l)))+((d=d%l)>35?String.fromCharCode(d+29):d.toString(36)),m={};for(;c--;)m[i(c)]=u[c]||i(c);let p=o.replace(/\b\w+\b/g,d=>m[d]||d);e=e.replace(s[0],p)}catch(n){}return e}catch(r){return t}}function ct(t){return f(this,null,function*(){try{let r=yield y(t,{headers:{Referer:"https://video.sibnet.ru/"}});if(!r)return{url:t};let e=yield r.text(),s=e.match(/file\s*:\s*["']([^"']*\.mp4[^"']*)['"]/i)||e.match(/src\s*:\s*["']([^"']*\.mp4[^"']*)['"]/i)||e.match(/["']((?:https?:)?\/\/[^"'\s]+\.mp4[^"'\s]*)["']/i);if(s){let n=s[1];return n.startsWith("//")?n="https:"+n:n.startsWith("/")&&(n="https://video.sibnet.ru"+n),{url:n,headers:{Referer:"https://video.sibnet.ru/"}}}}catch(r){}return{url:t}})}function lt(t){return f(this,null,function*(){try{let r=t.replace(/vidmoly\.(net|to|ru|is)/,"vidmoly.me"),e={Referer:"https://vidmoly.me/",Origin:"https://vidmoly.me"},s=yield y(r,{headers:e});if(!s)return{url:t};let n=yield s.text(),a=n.match(/window\.location\.replace\(['"]([^'"]+)['"]\)/)||n.match(/window\.location\.href\s*=\s*['"]([^'"]+)['"]/);a&&a[1]!==r&&(s=yield y(a[1],{headers:e}),s&&(n=yield s.text())),n.includes("eval(function(p,a,c,k,e,d)")&&(n=S(n));let o=n.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/i)||n.match(/["'](https?:\/\/[^"']+\.(?:m3u8|mp4)[^"']*)["']/i);if(o)return{url:o[1],headers:{Referer:"https://vidmoly.me/"}}}catch(r){}return{url:t}})}function ut(t){return f(this,null,function*(){let r=t.replace(/^https?:\/\/[^/]+/,""),e=["uqload.is","uqload.co","uqload.com","uqload.io","uqloads.xyz","uqload.to"],s="https://uqload.is/";for(let n of e)try{let a=`https://${n}${r}`,o=yield y(a,{headers:{Referer:s}});if(!o)continue;let l=yield o.text(),c=l.match(/sources\s*:\s*\[["']([^"']+\.(?:mp4|m3u8))["']\]/)||l.match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/);if(c)return{url:c[1],headers:{Referer:s}}}catch(a){}return{url:t}})}function mt(t){return f(this,null,function*(){try{let r=yield y(t);if(!r)return{url:t};let e=yield r.text(),s=e.match(/window\.location\.href\s*=\s*['"]([^'"]+)['"]/);if(s){let a=yield y(s[1]);a&&(e=yield a.text())}let n=e.match(/'hls'\s*:\s*'([^']+)'/)||e.match(/"hls"\s*:\s*"([^"]+)"/)||e.match(/https?:\/\/[^"']+\.m3u8[^"']*/);if(n){let a=n[1]||n[0];return a.includes("base64")&&(a=z(a.split(",")[1]||a)),{url:a,headers:{Referer:t}}}}catch(r){}return{url:t}})}function ft(t){return f(this,null,function*(){try{let r=yield y(t);if(!r)return{url:t};let e=yield r.text();e.includes("p,a,c,k,e,d")&&(e=S(e));let s=e.match(/robotlink['"]\)\.innerHTML\s*=\s*['"]([^'"]+)['"]\s*\+\s*([^;]+)/);if(s){let n="https:"+s[1],a=s[2].split("+");for(let o of a){let l=o.match(/['"]([^'"]+)['"]/);if(l){let c=l[1],u=o.match(/substring\((\d+)\)/);u&&(c=c.substring(parseInt(u[1]))),n+=c}}return{url:n,headers:{Referer:"https://streamtape.com/"}}}}catch(r){}return{url:t}})}function ht(t){return f(this,null,function*(){try{let r=t.includes("/embed/")?t:t.replace(/sendvid\.com\/([a-z0-9]+)/i,"sendvid.com/embed/$1"),e=yield y(r,{headers:{Referer:"https://sendvid.com/"}});if(!e)return{url:t};let s=yield e.text(),n=s.match(/video_source\s*:\s*["']([^"']+\.mp4[^"']*)["|']/)||s.match(/source\s+src=["']([^"']+\.mp4[^"']*)["|']/)||s.match(/<source[^>]+src=["']([^"']+\.(?:mp4|m3u8)[^"']*)["']/)||s.match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8)[^"']*)["|']/)||s.match(/["'](https?:\/\/[^"']+\.mp4[^"']*)["']/);if(n)return{url:n[1],headers:{Referer:"https://sendvid.com/"}}}catch(r){}return{url:t}})}function dt(t){return f(this,null,function*(){try{let r=yield y(t);if(!r)return{url:t};let e=yield r.text();e.includes("p,a,c,k,e,d")&&(e=S(e));let s=e.match(/sources\s*:\s*\[["']([^"']+\.(?:m3u8|mp4)[^"']*)["']\]/)||e.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/);if(s){let n=s[1];return n.includes("base64")&&(n=z(n.split(",")[1]||n)),{url:n,headers:{Referer:t}}}}catch(r){}return{url:t}})}function pt(t){return f(this,null,function*(){try{let r=yield y(t);if(!r)return{url:t};let s=(yield r.text()).match(/["'](https?:\/\/[^"']+\.m3u8[^"']*)["']/);if(s)return{url:s[1],headers:{Referer:t}}}catch(r){}return{url:t}})}function wt(t){return f(this,null,function*(){var r;try{let e=((r=t.match(/https?:\/\/([^\/]+)/))==null?void 0:r[1])||"dood.to",s=yield y(t);if(!s)return{url:t};let n=yield s.text();n.includes("eval(function(p,a,c,k,e,d)")&&(n=S(n));let a=n.match(/\$\.get\(['"]\/pass_md5\/([^'"]+)['"]/);if(a){let o=a[1],l=`https://${e}/pass_md5/${o}`,c=yield fetch(l,{headers:{Referer:t}});if(c.ok){let u=yield c.text(),i=Math.random().toString(36).substring(2,12);return{url:u+i+"?token="+o+"&expiry="+Date.now(),headers:{Referer:`https://${e}/`}}}}}catch(e){}return{url:t}})}function yt(t){return f(this,null,function*(){try{let r=yield y(t,{headers:{Referer:"https://www.myvi.ru/"}});if(!r)return{url:t};let e=yield r.text();e.includes("eval(function(p,a,c,k,e,d)")&&(e=S(e));let s=e.match(/["'](?:file|src|url|stream_url)["']\s*:\s*["']([^"']+\.(?:mp4|m3u8)[^"']*)["']/)||e.match(/["'](https?:\/\/[^"']+\.(?:mp4|m3u8)[^"']*)["']/)||e.match(/source\s+src=["']([^"']+\.(?:mp4|m3u8)[^"']*)/);if(s)return{url:s[1],headers:{Referer:"https://www.myvi.ru/"}};let n=t.match(/\/(?:embed\/|watch\/|video\/)([a-zA-Z0-9_-]+)/);if(n){let a=`https://www.myvi.ru/api/video/${n[1]}`,o=yield y(a,{headers:{Referer:t}});if(o){let c=(yield o.text()).match(/["'](?:url|src|file)["']\s*:\s*["']([^"']+\.(?:mp4|m3u8)[^"']*)["']/);if(c)return{url:c[1],headers:{Referer:"https://www.myvi.ru/"}}}}}catch(r){}return{url:t}})}function gt(t){return f(this,null,function*(){try{let r=yield y(t);if(!r)return{url:t};let s=(yield r.text()).match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8)[^"']*)["']/);if(s)return{url:s[1],headers:{Referer:t}}}catch(r){}return{url:t}})}function I(t,r=0){return f(this,null,function*(){var n;if(r>3)return x(h({},t),{isDirect:!1});let e=t.url,s=e.toLowerCase();if(!e||e.includes("google-analytics")||e.includes("doubleclick"))return null;if(s.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/)&&!s.includes("html"))return x(h({},t),{isDirect:!0});try{let a=null;if(s.includes("sibnet.ru")?a=yield ct(e):s.includes("vidmoly.")?a=yield lt(e):s.includes("uqload.")||s.includes("oneupload.")?a=yield ut(e):s.includes("voe.")?a=yield mt(e):s.includes("streamtape.com")||s.includes("stape")?a=yield ft(e):s.includes("dood")||s.includes("ds2play")?a=yield wt(e):s.includes("moonplayer")||s.includes("moon.")?a=yield gt(e):s.includes("sendvid.")?a=yield ht(e):s.includes("myvi.")||s.includes("mytv.")?a=yield yt(e):s.includes("luluvid.")||s.includes("lulu.")?a=yield dt(e):(s.includes("hgcloud.")||s.includes("savefiles."))&&(a=yield pt(e)),a&&a.url!==e)return x(h({},t),{url:a.url,headers:h(h({},t.headers),a.headers||{}),isDirect:!0,originalUrl:e});if(!a||a.url===e){let o=yield y(e,{headers:t.headers});if(o){let l=yield o.text();l.includes("p,a,c,k,e,d")&&(l=S(l));let c=l.match(/https?:\/\/[^"']+\.m3u8[^"']*/)||l.match(/https?:\/\/[^"']+\.mp4[^"']*/)||l.match(/file\s*:\s*["']([^"']+)["']/);if(c){let u=c[1]||c[0];u.startsWith("//")&&(u="https:"+u);let i=u.match(/\.(css|js|html|php|jpg|png|gif|svg)(\?.*)?$/i);u.startsWith("http")&&!u.includes(vt)&&!i&&(a={url:u})}if(!a){let u=l.match(/<iframe\s+[^>]*src=["']([^"']+)["']/i);if(u){let i=u[1];if(i.startsWith("//")&&(i="https:"+i),i.startsWith("/")){let m=(n=e.match(/^https?:\/\/[^\/]+/))==null?void 0:n[0];m&&(i=m+i)}if(i.startsWith("http")&&i!==e)return console.log(`[Resolver] Peeling: Found nested iframe -> ${i}`),yield I(x(h({},t),{url:i}),r+1)}}}}if(a&&a.url!==e&&a.url.startsWith("http"))return x(h({},t),{url:a.url,headers:h(h({},t.headers),a.headers||{}),isDirect:!0,originalUrl:e})}catch(a){}return x(h({},t),{isDirect:!1})})}var vt="googletagmanager";var xt="https://arm.haglund.dev/api/v2";var $t="https://v3-cinemeta.strem.io";function L(e){return f(this,arguments,function*(t,r={}){try{let s=new AbortController,n=setTimeout(()=>s.abort(),8e3),a=yield fetch(t,x(h({},r),{signal:s.signal}));return clearTimeout(n),a}catch(s){return console.error(`[ArmSync] Fetch failed: ${t}`,s.message),null}})}function V(t,r){return f(this,null,function*(){if(!t)return null;let e=yield L(`${xt}/themoviedb?id=${t}`);if(e)try{let a=yield e.json(),o=Array.isArray(a)?a[0]:a;if(o&&o.imdb)return o.imdb}catch(a){}let s=`https://www.themoviedb.org/${r==="movie"?"movie":"tv"}/${t}`,n=yield L(s);if(n){let o=(yield n.text()).match(/imdb\.com\/title\/(tt\d+)/);if(o)return o[1]}return null})}function B(t,r,e){return f(this,null,function*(){var u;if(!t||r===0)return null;let s=yield L(`${$t}/meta/series/${t}.json`);if(!s)return null;let n=yield s.json();if(!((u=n==null?void 0:n.meta)!=null&&u.videos))return null;let a=n.meta.videos.filter(i=>i.season>0&&i.episode>0).sort((i,m)=>i.season-m.season||i.episode-m.episode),o=[],l=new Set;for(let i of a){let m=`${i.season}-${i.episode}`;l.has(m)||(l.add(m),o.push(i))}let c=o.findIndex(i=>i.season==r&&i.episode==e);if(c!==-1){let i=c+1;return console.log(`[ArmSync] Resolved: S${r}E${e} -> Absolute ${i}`),i}return null})}var O="8265bd1679663a7ea12ac168da84d2e8",J="https://api.themoviedb.org/3";function K(t){return f(this,null,function*(){try{let r=new AbortController,e=setTimeout(()=>r.abort(),8e3),s=yield fetch(t,{headers:{"User-Agent":"Mozilla/5.0",Accept:"application/json"},signal:r.signal});return clearTimeout(e),s.ok?s:null}catch(r){return null}})}function G(t,r){return f(this,null,function*(){var n,a,o,l,c,u;let e=r==="movie"?"movie":"tv",s=[];try{let i=`${J}/${e}/${t}?api_key=${O}&language=en-US`,m=yield K(i);if(m){let $=yield m.json(),w=(n=e==="movie"?$.title:$.name)==null?void 0:n.trim(),g=(a=e==="movie"?$.original_title:$.original_name)==null?void 0:a.trim();w&&s.push(w),g&&g!==w&&/^[\x00-\x7F\u00C0-\u024F\s]+$/.test(g)&&s.push(g)}let p=`${J}/${e}/${t}/translations?api_key=${O}`,d=yield K(p);if(d){let w=((yield d.json()).translations||[]).find(U=>U.iso_639_1==="fr"),g=((l=(o=w==null?void 0:w.data)==null?void 0:o.name)==null?void 0:l.trim())||((u=(c=w==null?void 0:w.data)==null?void 0:c.title)==null?void 0:u.trim());g&&!s.includes(g)&&s.push(g)}}catch(i){console.error(`[Metadata] TMDB API error: ${i.message}`)}return console.log(`[Metadata] Titles for ${t}: ${s.join(" | ")}`),s})}var E="https://animesultra.org";function bt(t){return f(this,null,function*(){try{let r=[],e=new Set,s=(l,c)=>{l&&l.length>5&&c&&!e.has(l)&&(e.add(l),r.push({title:c,url:l.startsWith("http")?l:E+l}))},n=`${E}/index.php?do=search&subaction=search&story=${encodeURIComponent(t)}`,a=yield P(n,{headers:{"User-Agent":"Mozilla/5.0"}}),o=D.default.load(a);return o(".film-poster").each((l,c)=>{let u=o(c).find("a").attr("href"),i=o(c).find("a").attr("title")||o(c).attr("title");s(u,i)}),r.length===0&&o("a").each((l,c)=>{let u=o(c).attr("href"),i=o(c).attr("title")||o(c).text().trim();u&&u.includes(".html")&&u.includes("-")&&i&&i.toLowerCase().includes(t.toLowerCase())&&s(u,i)}),r}catch(r){return console.error(`[AnimesUltra] Search error: ${r.message}`),[]}})}function X(t,r,e,s){return f(this,null,function*(){let n=yield G(t,r);if(n.length===0)return[];let a=[...n].sort((i,m)=>{let p=/[^\x00-\x7F]/.test(i)?-1:/[àâéèêëîïôùûüç'L']/i.test(i)?0:1,d=/[^\x00-\x7F]/.test(m)?-1:/[àâéèêëîïôùûüç'L']/i.test(m)?0:1;return p-d}),o=[s];try{let i=yield V(t,r);if(i){let m=yield B(i,e,s);m&&m!==s&&o.push(m)}}catch(i){console.warn(`[AnimesUltra] ArmSync failed: ${i.message}`)}let l=[];for(let i of a)if(l=yield bt(i),l&&l.length>0)break;if(!l||l.length===0)return[];let c=[];for(let i of l){if(!i.url)continue;let m="VOSTFR";i.title.toLowerCase().includes("vf")&&(m="VF");try{let p=i.url.match(/\/(\d+)-/);if(!p){console.warn(`[AnimesUltra] Could not find newsId in URL: ${i.url}`);continue}let d=p[1],g=(yield(yield fetch(`${E}/engine/ajax/full-story.php?newsId=${d}`,{headers:{"User-Agent":"Mozilla/5.0","X-Requested-With":"XMLHttpRequest"}})).json()).html;if(!g)continue;let U=D.default.load(g),C=[];if(U(".ep-item").each((j,T)=>{let k=U(T).attr("data-number");if(k&&o.map(b=>parseInt(b,10)).includes(parseInt(k,10))){let b=U(T).attr("href");b&&C.push(b)}}),C.length===0){console.warn(`[AnimesUltra] Episodes ${o.join(",")} not found for ${i.title}`);continue}for(let j of C){let k=yield(yield fetch(j,{headers:{"User-Agent":"Mozilla/5.0"}})).text(),b=D.default.load(k),q=[];b(".server-item").each((A,M)=>{let v=b(M).attr("data-server-id");v&&q.push(v)});for(let A of q){let M=U(`#content_player_${A}`);if(M.length>0){let v=M.text().trim()||M.find("iframe").attr("src");if(v&&(v.startsWith("http")||/^[0-9]+$/.test(v))){/^[0-9]+$/.test(v)&&(v=`https://video.sibnet.ru/shell.php?videoid=${v}`);let R="Serveur",F=b(`.server-item[data-server-id="${A}"]`).text().trim();F?R=F:A.toLowerCase().includes("sen")?R="Sendvid":A.toLowerCase().includes("my")?R="Mytv":A.toLowerCase().includes("vidc")?R="VidCDN":A.toLowerCase()==="20"||v.includes("sibnet.ru")?R="Sibnet":R=`Srv_${A}`,c.push({name:`AnimesUltra (${m})`,title:`${R} - ${m}`,url:v,quality:"HD",headers:{Referer:E}})}}}}}catch(p){console.error(`[AnimesUltra] Extract error: ${p.message}`)}}let u=[];for(let i of c){let m=yield I(i);m&&m.isDirect&&u.push(m)}return console.log(`[AnimesUltra] Total valid streams found: ${u.length}`),u.sort((i,m)=>{let p=w=>w&&(w.toUpperCase().includes("VF")||w.toUpperCase().includes("FRENCH")),d=p(i.name)||p(i.title),$=p(m.name)||p(m.title);return d&&!$?-1:!d&&$?1:0}),u})}function At(t,r,e,s){return f(this,null,function*(){try{return console.log(`[AnimesUltra] Request: ${r} ${t} S${e}E${s}`),yield X(t,r,e,s)}catch(n){return console.error(`[AnimesUltra] Error: ${n.message}`),[]}})}module.exports={getStreams:At};
