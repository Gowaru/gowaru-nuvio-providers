/**
 * voiranime - Built from src/voiranime/
 * Generated: 2026-02-25T16:30:00.233Z
 */
var _=Object.create;var S=Object.defineProperty,z=Object.defineProperties,B=Object.getOwnPropertyDescriptor,K=Object.getOwnPropertyDescriptors,J=Object.getOwnPropertyNames,U=Object.getOwnPropertySymbols,G=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var C=(t,e,r)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,m=(t,e)=>{for(var r in e||(e={}))I.call(e,r)&&C(t,r,e[r]);if(U)for(var r of U(e))O.call(e,r)&&C(t,r,e[r]);return t},$=(t,e)=>z(t,K(e));var Q=(t,e)=>{for(var r in e)S(t,r,{get:e[r],enumerable:!0})},j=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of J(e))!I.call(t,s)&&s!==r&&S(t,s,{get:()=>e[s],enumerable:!(n=B(e,s))||n.enumerable});return t};var X=(t,e,r)=>(r=t!=null?_(G(t)):{},j(e||!t||!t.__esModule?S(r,"default",{value:t,enumerable:!0}):r,t)),Y=t=>j(S({},"__esModule",{value:!0}),t);var u=(t,e,r)=>new Promise((n,s)=>{var o=i=>{try{a(r.next(i))}catch(l){s(l)}},c=i=>{try{a(r.throw(i))}catch(l){s(l)}},a=i=>i.done?n(i.value):Promise.resolve(i.value).then(o,c);a((r=r.apply(t,e)).next())});var mt={};Q(mt,{getStreams:()=>ut});module.exports=Y(mt);var Z={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0",Connection:"keep-alive"};function x(r){return u(this,arguments,function*(t,e={}){console.log(`[VoirAnime] Fetching: ${t}`);let n=yield fetch(t,m({headers:m(m({},Z),e.headers)},e));if(!n.ok)throw new Error(`HTTP error ${n.status} for ${t}`);return yield n.text()})}var k=X(require("cheerio"));var tt={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36"},et=t=>{try{return typeof atob=="function"?atob(t):Buffer.from(t,"base64").toString("binary")}catch(e){return t}};function b(r){return u(this,arguments,function*(t,e={}){try{let n=yield fetch(t,$(m({},e),{headers:m(m({},tt),e.headers)}));if(!n.ok)return null;let s=yield n.text(),o=n.headers.get("set-cookie")||"";return{text:()=>Promise.resolve(s),ok:!0,url:n.url,headers:{"set-cookie":o}}}catch(n){return null}})}function H(t){try{if(!t.includes("p,a,c,k,e,d"))return t;let e=t.match(/}\s*\((.*)\)\s*$/);if(!e)return t;let r=e[1].match(/(".+"|\d+)/g);if(r.length<4)return t;let[n,s,o,c]=[r[0].replace(/^"|"$/g,""),parseInt(r[1]),parseInt(r[2]),r[3].replace(/^"|"$/g,"").split("|")],a=l=>(l<s?"":a(parseInt(l/s)))+((l=l%s)>35?String.fromCharCode(l+29):l.toString(36)),i={};for(;o--;)i[a(o)]=c[o]||a(o);return n.replace(/\b\w+\b/g,l=>i[l]||l)}catch(e){return t}}function rt(t){return u(this,null,function*(){try{let e=yield b(t,{headers:{Referer:"https://video.sibnet.ru/"}});if(!e)return{url:t};let r=yield e.text(),n=r.match(/src\s*:\s*["']([^"']+\.mp4)["']/)||r.match(/"url"\s*:\s*"([^"]+\.mp4)"/);if(n){let s=n[1];return s.startsWith("//")&&(s="https:"+s),{url:s,headers:{Referer:"https://video.sibnet.ru/"}}}}catch(e){}return{url:t}})}function nt(t){return u(this,null,function*(){try{let e=yield b(t,{headers:{Referer:"https://vidmoly.to/"}});if(!e)return{url:t};let r=yield e.text();r.includes("eval(function(p,a,c,k,e,d)")&&(r=H(r));let n=r.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/);if(n)return{url:n[1],headers:{Referer:"https://vidmoly.to/"}}}catch(e){}return{url:t}})}function L(t){return u(this,null,function*(){try{let e=yield b(t);if(!e)return{url:t};let r=yield e.text(),n=r.match(/window\.location\.href\s*=\s*['"]([^'"]+)['"]/);if(n)return L(n[1]);let s=r.match(/'hls'\s*:\s*'([^']+)'/)||r.match(/file\s*:\s*['"]([^'"]+\.m3u8[^'"]*)['"]/);if(s){let o=s[1];return o.includes("base64")&&(o=et(o.split(",")[1]||o)),{url:o}}}catch(e){}return{url:t}})}function st(t){return u(this,null,function*(){try{let e=yield b(t);if(!e)return{url:t};let r=yield e.text(),n=r.match(/document\.getElementById\(['"]robotlink['"]\)\.innerHTML\s*=\s*['"]([^'"]+)['"]\s*\+\s*(?:['"]([^'"]+)['"]|['"]([^'"]+)['"]\.substring\(\d+\))/);if(n){let s=n[1],o=n[2]||"";if(n[3]){let c=r.match(/substring\((\d+)\)/);o=n[3].substring(c?parseInt(c[1]):0)}return{url:"https:"+s+o}}}catch(e){}return{url:t}})}function ot(t){return u(this,null,function*(){var e;try{let r=(e=t.match(/https?:\/\/([^\/]+)/))==null?void 0:e[1],n=yield b(t);if(!n||!r)return{url:t};let s=yield n.text();s.includes("eval(function(p,a,c,k,e,d)")&&(s=H(s));let o=s.match(/\$\.get\(['"]\/pass_md5\/([^'"]+)['"]/);if(o){let c=o[1],a=yield fetch(`https://${r}/pass_md5/${c}`,{headers:{Referer:t}});if(a.ok)return{url:(yield a.text())+"z762vpz?token="+c+"&expiry="+Date.now()}}}catch(r){}return{url:t}})}function M(t){return u(this,null,function*(){let e=t.url,r=e.toLowerCase();if(r.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/))return $(m({},t),{isDirect:!0});try{let n={url:e};if(r.includes("sibnet.ru"))n=yield rt(e);else if(r.includes("vidmoly."))n=yield nt(e);else if(r.includes("voe."))n=yield L(e);else if(r.includes("streamtape.com")||r.includes("stape"))n=yield st(e);else if(r.includes("dood")||r.includes("ds2play"))n=yield ot(e);else{let s=yield b(e);if(s){let o=yield s.text(),c=o.match(/https?:\/\/[^"']+\.m3u8[^"']*/)||o.match(/https?:\/\/[^"']+\.mp4[^"']*/);c&&(n={url:c[0]})}}if(n.url!==e&&n.url.startsWith("http"))return $(m({},t),{url:n.url,isDirect:!0,headers:m(m({},t.headers),n.headers||{}),originalUrl:e})}catch(n){}return $(m({},t),{isDirect:!1})})}var it="https://arm.haglund.dev/api/v2";var at="https://v3-cinemeta.strem.io";function P(r){return u(this,arguments,function*(t,e={}){try{let n=new AbortController,s=setTimeout(()=>n.abort(),8e3),o=yield fetch(t,$(m({},e),{signal:n.signal}));return clearTimeout(s),o}catch(n){return console.error(`[ArmSync] Fetch failed: ${t}`,n.message),null}})}function q(t,e){return u(this,null,function*(){if(!t)return null;let r=yield P(`${it}/themoviedb?id=${t}`);if(r){let n=yield r.json(),s=Array.isArray(n)?n[0]:n;if(s&&s.imdb)return s.imdb}return null})}function F(t,e,r){return u(this,null,function*(){var a;if(!t||e===0)return null;let n=yield P(`${at}/meta/series/${t}.json`);if(!n)return null;let s=yield n.json();if(!((a=s==null?void 0:s.meta)!=null&&a.videos))return null;let c=s.meta.videos.filter(i=>i.season>0).sort((i,l)=>i.season-l.season||i.episode-l.episode).findIndex(i=>i.season==e&&i.episode==r);if(c!==-1){let i=c+1;return console.log(`[ArmSync] Resolved: S${e}E${r} -> Absolute ${i}`),i}return null})}var D="https://v6.voiranime.com";function ct(t,e){return u(this,null,function*(){try{let r=`https://www.themoviedb.org/${e==="movie"?"movie":"tv"}/${t}?language=en-US`,n=yield x(r),s=k.default.load(n),o=s('meta[property="og:title"]').attr("content")||s("h1").first().text()||s("h2").first().text();return o&&o.includes(" (")&&(o=o.split(" (")[0]),o&&o.includes(" - ")&&(o=o.split(" - ")[0]),o=o?o.trim():null,console.log(`[VoirAnime] TMDB Title found: ${o}`),o}catch(r){return console.error(`[VoirAnime] Failed to get title from TMDB: ${r.message}`),null}})}function V(t){return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[':!.,?]/g,"").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function lt(t){return u(this,null,function*(){let e=[V(t),V(t.replace(/'s/gi,"")),V(t.replace(/'s/gi,"s"))],r=[];e.forEach(s=>{s.startsWith("the-")?r.push(s.substring(4)):r.push("the-"+s)});let n=[...new Set([...e,...r])];console.log(`[VoirAnime] Probing slugs: ${n.join(", ")}`);for(let s of n){let o=`${D}/anime/${s}/`;try{return yield x(o,{method:"HEAD"}),console.log(`[VoirAnime] Predicted slug found: ${s}`),o}catch(c){}}try{let s=`${D}/?s=${encodeURIComponent(t)}`,o=yield x(s),c=k.default.load(o),a=[];c(".post-title a").each((w,f)=>{a.push({title:c(f).text().trim(),url:c(f).attr("href")})});let i=w=>w.toLowerCase().replace(/[':!.,?]/g,"").replace(/\bthe\s+/g,"").replace(/\s+/g," ").trim(),l=i(t);console.log(`[VoirAnime] Search results: ${a.length}`);let d=a.find(w=>i(w.title)===l);return d||(d=a.find(w=>{let f=i(w.title);return f.includes(l)&&!f.includes("film")&&!f.includes("log")&&!f.includes("kai")})),d||(d=a[0]),d?(console.log(`[VoirAnime] Selected from search: ${d.title} -> ${d.url}`),d.url):null}catch(s){return console.error(`[VoirAnime] Search error: ${s.message}`),null}})}function N(t,e,r,n){return u(this,null,function*(){let s=yield ct(t,e);if(!s)return[];let o=[n];try{let a=yield q(t,e);if(a){let i=yield F(a,r,n);i&&o.push(i)}}catch(a){console.warn(`[VoirAnime] ArmSync failed: ${a.message}`)}let c=yield lt(s);if(!c)return[];try{let a=yield x(c),i=k.default.load(a),l=n.toString(),d=["","0","00","000"],w=[];for(let g of o){let h=g.toString();d.forEach(p=>w.push((p+h).slice(-Math.max(h.length,p.length))))}let f=null;if(i(".listing-chapters a, .list-chapter a, .wp-manga-chapter a").each((g,h)=>{let p=i(h).text().trim(),v=i(h).attr("href");for(let A of w){let y=new RegExp(`(?:[^0-9]|^)${A}(?:[^0-9]|$)`);if(y.test(p)||y.test(v))return f=v,!1}}),!f)return[];console.log(`[VoirAnime] Episode URL: ${f}`);let W=yield x(f),E=k.default.load(W),R=[],T=[];if(E('[name="host"] option, .host-select option').each((g,h)=>{let p=E(h).val();p&&p!=="Choisir un lecteur"&&T.push(p)}),T.length===0){let g=E('iframe[src*="embed"], iframe[src*="e/"]').first().attr("src");if(g){let h=yield M({name:"VoirAnime",title:"Default Player",quality:"HD",url:g,headers:{Referer:D}});R.push(h)}}else for(let g of T)try{let h=`${f}${f.includes("?")?"&":"?"}host=${encodeURIComponent(g)}`,p=yield x(h),v=p.match(/<iframe\s+.*?src="(https?:\/\/[^"]+)".*?><\/iframe>/i),A=v?v[1]:null;if(!A){let y=p.match(/https?:\/\/[^"']+\/(?:embed|e)\/[^"']+/);y&&!y[0].includes("voiranime.com")&&(A=y[0])}if(A){let y=yield M({name:`VoirAnime (${g})`,title:`${g} Player`,url:A,quality:"HD",headers:{Referer:D}});R.push(y)}}catch(h){}return R}catch(a){return console.error(`[VoirAnime] Extraction error: ${a.message}`),[]}})}function ut(t,e,r,n){return u(this,null,function*(){console.log(`[VoirAnime] Request: ${e} ${t} S${r}E${n}`);try{return yield N(t,e,r,n)}catch(s){return console.error("[VoirAnime] Error:",s),[]}})}
