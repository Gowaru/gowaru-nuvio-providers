/**
 * voiranime - Built from src/voiranime/
 * Generated: 2026-02-25T17:10:18.148Z
 */
var W=Object.create;var S=Object.defineProperty,_=Object.defineProperties,z=Object.getOwnPropertyDescriptor,K=Object.getOwnPropertyDescriptors,B=Object.getOwnPropertyNames,C=Object.getOwnPropertySymbols,J=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var q=(t,e,r)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,h=(t,e)=>{for(var r in e||(e={}))j.call(e,r)&&q(t,r,e[r]);if(C)for(var r of C(e))G.call(e,r)&&q(t,r,e[r]);return t},x=(t,e)=>_(t,K(e));var O=(t,e)=>{for(var r in e)S(t,r,{get:e[r],enumerable:!0})},H=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of B(e))!j.call(t,s)&&s!==r&&S(t,s,{get:()=>e[s],enumerable:!(n=z(e,s))||n.enumerable});return t};var Q=(t,e,r)=>(r=t!=null?W(J(t)):{},H(e||!t||!t.__esModule?S(r,"default",{value:t,enumerable:!0}):r,t)),X=t=>H(S({},"__esModule",{value:!0}),t);var m=(t,e,r)=>new Promise((n,s)=>{var o=a=>{try{c(r.next(a))}catch(u){s(u)}},i=a=>{try{c(r.throw(a))}catch(u){s(u)}},c=a=>a.done?n(a.value):Promise.resolve(a.value).then(o,i);c((r=r.apply(t,e)).next())});var ht={};O(ht,{getStreams:()=>ft});module.exports=X(ht);var Y={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7","Cache-Control":"max-age=0",Connection:"keep-alive"};function v(r){return m(this,arguments,function*(t,e={}){console.log(`[VoirAnime] Fetching: ${t}`);let n=yield fetch(t,h({headers:h(h({},Y),e.headers)},e));if(!n.ok)throw new Error(`HTTP error ${n.status} for ${t}`);return yield n.text()})}var R=Q(require("cheerio"));var Z={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36"},tt=t=>{try{return typeof atob=="function"?atob(t):Buffer.from(t,"base64").toString("binary")}catch(e){return t}};function y(r){return m(this,arguments,function*(t,e={}){try{let n=yield fetch(t,x(h({},e),{headers:h(h({},Z),e.headers),redirect:"follow"}));if(!n.ok)return null;let s=yield n.text();return{text:()=>Promise.resolve(s),ok:!0,url:n.url,headers:n.headers}}catch(n){return null}})}function I(t){try{if(!t.includes("p,a,c,k,e,d"))return t;let e=t.match(/}\s*\((.*)\)\s*$/);if(!e)return t;let r=e[1].match(/(".+"|\d+)/g);if(r.length<4)return t;let[n,s,o,i]=[r[0].replace(/^"|"$/g,""),parseInt(r[1]),parseInt(r[2]),r[3].replace(/^"|"$/g,"").split("|")],c=u=>(u<s?"":c(parseInt(u/s)))+((u=u%s)>35?String.fromCharCode(u+29):u.toString(36)),a={};for(;o--;)a[c(o)]=i[o]||c(o);return n.replace(/\b\w+\b/g,u=>a[u]||u)}catch(e){return t}}function et(t){return m(this,null,function*(){try{let e=yield y(t,{headers:{Referer:"https://video.sibnet.ru/"}});if(!e)return{url:t};let r=yield e.text(),n=r.match(/src\s*:\s*["']([^"']+\.mp4)["']/)||r.match(/"url"\s*:\s*"([^"]+\.mp4)"/);if(n){let s=n[1];return s.startsWith("//")&&(s="https:"+s),{url:s,headers:{Referer:"https://video.sibnet.ru/"}}}}catch(e){}return{url:t}})}function rt(t){return m(this,null,function*(){try{let e=yield y(t,{headers:{Referer:"https://vidmoly.to/"}});if(!e)return{url:t};let r=yield e.text();r.includes("eval(function(p,a,c,k,e,d)")&&(r=I(r));let n=r.match(/file\s*:\s*["']([^"']+\.(?:m3u8|mp4)[^"']*)["']/);if(n)return{url:n[1],headers:{Referer:"https://vidmoly.to/"}}}catch(e){}return{url:t}})}function nt(t){return m(this,null,function*(){try{let e=yield y(t,{headers:{Referer:"https://uqload.com/"}});if(!e)return{url:t};let r=yield e.text(),n=r.match(/sources\s*:\s*\[["']([^"']+\.(?:mp4|m3u8))["']\]/)||r.match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8))["']/);if(n)return{url:n[1],headers:{Referer:"https://uqload.com/"}}}catch(e){}return{url:t}})}function st(t){return m(this,null,function*(){try{let e=yield y(t);if(!e)return{url:t};let r=yield e.text(),n=r.match(/window\.location\.href\s*=\s*['"]([^'"]+)['"]/);if(n){let o=yield y(n[1]);o&&(r=yield o.text())}let s=r.match(/'hls'\s*:\s*'([^']+)'/)||r.match(/"hls"\s*:\s*"([^"]+)"/)||r.match(/https?:\/\/[^"']+\.m3u8[^"']*/);if(s){let o=s[1]||s[0];return o.includes("base64")&&(o=tt(o.split(",")[1]||o)),{url:o}}}catch(e){}return{url:t}})}function ot(t){return m(this,null,function*(){try{let e=yield y(t);if(!e)return{url:t};let n=(yield e.text()).match(/robotlink['"]\)\.innerHTML\s*=\s*['"]([^'"]+)['"]\s*\+\s*([^;]+)/);if(n){let s="https:"+n[1],o=n[2].split("+");for(let i of o){let c=i.match(/['"]([^'"]+)['"]/);if(c){let a=c[1],u=i.match(/substring\((\d+)\)/);u&&(a=a.substring(parseInt(u[1]))),s+=a}}return{url:s}}}catch(e){}return{url:t}})}function at(t){return m(this,null,function*(){var e;try{let r=((e=t.match(/https?:\/\/([^\/]+)/))==null?void 0:e[1])||"dood.to",n=yield y(t);if(!n)return{url:t};let s=yield n.text();s.includes("eval(function(p,a,c,k,e,d)")&&(s=I(s));let o=s.match(/\$\.get\(['"]\/pass_md5\/([^'"]+)['"]/);if(o){let i=o[1],c=`https://${r}/pass_md5/${i}`,a=yield fetch(c,{headers:{Referer:t}});if(a.ok){let u=yield a.text(),l=Math.random().toString(36).substring(2,12);return{url:u+l+"?token="+i+"&expiry="+Date.now()}}}}catch(r){}return{url:t}})}function it(t){return m(this,null,function*(){try{let e=yield y(t);if(!e)return{url:t};let n=(yield e.text()).match(/file\s*:\s*["']([^"']+\.(?:mp4|m3u8)[^"']*)["']/);if(n)return{url:n[1]}}catch(e){}return{url:t}})}function U(t){return m(this,null,function*(){let e=t.url,r=e.toLowerCase();if(r.match(/\.(mp4|m3u8|mkv|webm)(\?.*)?$/))return x(h({},t),{isDirect:!0});try{let n=null;if(r.includes("sibnet.ru"))n=yield et(e);else if(r.includes("vidmoly."))n=yield rt(e);else if(r.includes("uqload.")||r.includes("oneupload."))n=yield nt(e);else if(r.includes("voe."))n=yield st(e);else if(r.includes("streamtape.com")||r.includes("stape"))n=yield ot(e);else if(r.includes("dood")||r.includes("ds2play"))n=yield at(e);else if(r.includes("moonplayer")||r.includes("moon."))n=yield it(e);else{let s=yield y(e);if(s){let o=yield s.text(),i=o.match(/https?:\/\/[^"']+\.m3u8[^"']*/)||o.match(/https?:\/\/[^"']+\.mp4[^"']*/);i&&(n={url:i[0]})}}if(n&&n.url!==e&&n.url.startsWith("http"))return x(h({},t),{url:n.url,isDirect:!0,headers:h(h({},t.headers),n.headers||{}),originalUrl:e})}catch(n){}return x(h({},t),{isDirect:!1})})}var ct="https://arm.haglund.dev/api/v2";var lt="https://v3-cinemeta.strem.io";function T(r){return m(this,arguments,function*(t,e={}){try{let n=new AbortController,s=setTimeout(()=>n.abort(),8e3),o=yield fetch(t,x(h({},e),{signal:n.signal}));return clearTimeout(s),o}catch(n){return console.error(`[ArmSync] Fetch failed: ${t}`,n.message),null}})}function L(t,e){return m(this,null,function*(){if(!t)return null;let r=yield T(`${ct}/themoviedb?id=${t}`);if(r)try{let o=yield r.json(),i=Array.isArray(o)?o[0]:o;if(i&&i.imdb)return i.imdb}catch(o){}let n=`https://www.themoviedb.org/${e==="movie"?"movie":"tv"}/${t}`,s=yield T(n);if(s){let i=(yield s.text()).match(/imdb\.com\/title\/(tt\d+)/);if(i)return i[1]}return null})}function P(t,e,r){return m(this,null,function*(){var u;if(!t||e===0)return null;let n=yield T(`${lt}/meta/series/${t}.json`);if(!n)return null;let s=yield n.json();if(!((u=s==null?void 0:s.meta)!=null&&u.videos))return null;let o=s.meta.videos.filter(l=>l.season>0&&l.episode>0).sort((l,f)=>l.season-f.season||l.episode-f.episode),i=[],c=new Set;for(let l of o){let f=`${l.season}-${l.episode}`;c.has(f)||(c.add(f),i.push(l))}let a=i.findIndex(l=>l.season==e&&l.episode==r);if(a!==-1){let l=a+1;return console.log(`[ArmSync] Resolved: S${e}E${r} -> Absolute ${l}`),l}return null})}var D="https://v6.voiranime.com";function ut(t,e){return m(this,null,function*(){try{let r=`https://www.themoviedb.org/${e==="movie"?"movie":"tv"}/${t}?language=en-US`,n=yield v(r),s=R.default.load(n),o=s('meta[property="og:title"]').attr("content")||s("h1").first().text()||s("h2").first().text();return o&&o.includes(" (")&&(o=o.split(" (")[0]),o&&o.includes(" - ")&&(o=o.split(" - ")[0]),o=o?o.trim():null,console.log(`[VoirAnime] TMDB Title found: ${o}`),o}catch(r){return console.error(`[VoirAnime] Failed to get title from TMDB: ${r.message}`),null}})}function V(t){return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[':!.,?]/g,"").replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function mt(t){return m(this,null,function*(){let e=[V(t),V(t.replace(/'s/gi,"")),V(t.replace(/'s/gi,"s"))],r=[];e.forEach(s=>{s.startsWith("the-")?r.push(s.substring(4)):r.push("the-"+s)});let n=[...new Set([...e,...r])];console.log(`[VoirAnime] Probing slugs: ${n.join(", ")}`);for(let s of n){let o=`${D}/anime/${s}/`;try{return yield v(o,{method:"HEAD"}),console.log(`[VoirAnime] Predicted slug found: ${s}`),o}catch(i){}}try{let s=`${D}/?s=${encodeURIComponent(t)}`,o=yield v(s),i=R.default.load(o),c=[];i(".post-title a").each((f,p)=>{c.push({title:i(p).text().trim(),url:i(p).attr("href")})});let a=f=>f.toLowerCase().replace(/[':!.,?]/g,"").replace(/\bthe\s+/g,"").replace(/\s+/g," ").trim(),u=a(t);console.log(`[VoirAnime] Search results: ${c.length}`);let l=c.find(f=>a(f.title)===u);return l||(l=c.find(f=>{let p=a(f.title);return p.includes(u)&&!p.includes("film")&&!p.includes("log")&&!p.includes("kai")})),l||(l=c[0]),l?(console.log(`[VoirAnime] Selected from search: ${l.title} -> ${l.url}`),l.url):null}catch(s){return console.error(`[VoirAnime] Search error: ${s.message}`),null}})}function F(t,e,r,n){return m(this,null,function*(){let s=yield ut(t,e);if(!s)return[];let o=[n];try{let c=yield L(t,e);if(c){let a=yield P(c,r,n);a&&o.push(a)}}catch(c){console.warn(`[VoirAnime] ArmSync failed: ${c.message}`)}let i=yield mt(s);if(!i)return[];try{let c=yield v(i),a=R.default.load(c),u=n.toString(),l=["","0","00","000"],f=[];for(let g of o){let d=g.toString();l.forEach(w=>f.push((w+d).slice(-Math.max(d.length,w.length))))}let p=null;if(a(".listing-chapters a, .list-chapter a, .wp-manga-chapter a").each((g,d)=>{let w=a(d).text().trim(),b=a(d).attr("href");for(let A of f){let $=new RegExp(`(?:[^0-9]|^)${A}(?:[^0-9]|$)`);if($.test(w)||$.test(b))return p=b,!1}}),!p)return[];console.log(`[VoirAnime] Episode URL: ${p}`);let N=yield v(p),E=R.default.load(N),k=[],M=[];if(E('[name="host"] option, .host-select option').each((g,d)=>{let w=E(d).val();w&&w!=="Choisir un lecteur"&&M.push(w)}),M.length===0){let g=E('iframe[src*="embed"], iframe[src*="e/"]').first().attr("src");if(g){let d=yield U({name:"VoirAnime",title:"Default Player",quality:"HD",url:g,headers:{Referer:D}});k.push(d)}}else for(let g of M)try{let d=`${p}${p.includes("?")?"&":"?"}host=${encodeURIComponent(g)}`,w=yield v(d),b=w.match(/<iframe\s+.*?src="(https?:\/\/[^"]+)".*?><\/iframe>/i),A=b?b[1]:null;if(!A){let $=w.match(/https?:\/\/[^"']+\/(?:embed|e)\/[^"']+/);$&&!$[0].includes("voiranime.com")&&(A=$[0])}if(A){let $=yield U({name:`VoirAnime (${g})`,title:`${g} Player`,url:A,quality:"HD",headers:{Referer:D}});k.push($)}}catch(d){}return k}catch(c){return console.error(`[VoirAnime] Extraction error: ${c.message}`),[]}})}function ft(t,e,r,n){return m(this,null,function*(){console.log(`[VoirAnime] Request: ${e} ${t} S${r}E${n}`);try{return yield F(t,e,r,n)}catch(s){return console.error("[VoirAnime] Error:",s),[]}})}
